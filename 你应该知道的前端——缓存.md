## web缓存

web缓存是可以通过自动保存常见文档副本的HTTP设备。当web请求抵达缓存时，如果本地有已经缓存的副本，就可以从本地存储设备而不是原始服务器中提取这个文档。

### 1.为什么需要缓存

* 冗余的数据传输

  有很多客户端访问一个流行的原始服务器页面时，服务器会多次传输同一份文档，每次传送给一个客户端时，一些相同的字节会在网络中一遍遍的传输。这些冗余的数据传输会耗尽昂贵的网络带宽。而通过缓存我们可以保留第一家服务器响应的副本，后继请求就可以由缓存的副本来应对。

* 带宽瓶颈

  缓存还可以缓解网络的瓶颈问题。很多网络会为本地网络客户端提供的带宽比为远程服务器提供的带宽要多。客户端会以路径上最慢的网速访问服务器。如果客户端从一个快速局域网的缓存中得到一份副本，那么缓存就可以提高性能——尤其是要传输比较大的文件的时候。

* 瞬间拥塞

  缓存在破坏瞬间拥塞时显得非常重要。突发事件（比如爆炸性新闻，批量E-mail公告，或者某个名人事件）是很多人几乎同时去访问一个web文档时，就会出现瞬间拥塞。由此造成的过多流量峰值可能会使网络和web服务器发生灾难性的崩溃。

* 距离时延

  即使带宽不是问题，距离也可能成为问题。每台网络路由器都会增加因特网流量的时延，即使客户端和服务器之间没有太多路由器，光速本身也会造成时延变长。将缓存放在附近的机房里可以将文件传输距离从数千英里缩短为数十米。

### 2.缓存的命中和未命中

但是缓存无法保存世界上每份文档的副本，这样就会分成两种情况：

* 可以用已有的副本为某些到达缓存的请求提供服务，这被称之为缓存命中。

  ![缓存命中的图示](https://user-gold-cdn.xitu.io/2018/4/25/162fcfaa771243b4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

* 其他一些到达缓存的骑牛可能会由于没有副本可用，而被转发给原始服务器，这被称之为缓存未命中。

  ![缓存未命中的图示](https://user-gold-cdn.xitu.io/2018/4/25/162fcfab46a3b1c3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### 3.新鲜度检测规则

HTTP通过缓存服务器文档的副本保留一段时间。在这段时间里，都认为文档是新鲜的，缓存可以在不联系服务器的情况下，直接提供该文档。我们称之为强缓存命中，此时浏览器会返回200状态码（from cache）

![强缓存命中的情况](https://user-gold-cdn.xitu.io/2018/4/25/162fcfaa771243b4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

但一旦已经缓存副本停留的时间太长了，超过了文档的新鲜度限值，就认为文档过期了。

![文档过期](https://user-gold-cdn.xitu.io/2018/4/25/162fcfaa7726cf25?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

再提供此文档之前，魂村需要与服务器进行验证，查看文档是否发生了变化。我们称之为协商缓存。

![协商缓存](https://user-gold-cdn.xitu.io/2018/4/25/162fcfaa770151bc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

* 再验证命中：如果服务器对象没有被修改，服务器会向客户端发送一个小的HTTP 304 Not Modified响应
* 再验证未命中：如果服务器对象与已经缓存副本不同，服务器向客户端发送一个普通的带有完整内容的HTTP 200 OK响应
* 对象被删除：如果服务器对象已经被删除了，服务器就响应一个404 Not Found响应，缓存也会将其副本删除

### 4.强缓存原理

