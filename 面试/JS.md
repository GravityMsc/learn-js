## ä¸€ã€é˜²æŠ–å’ŒèŠ‚æµ

**ç›¸åŒ**ï¼šåœ¨ä¸å½±å“å®¢æˆ·ä½“éªŒçš„å‰æä¸‹ï¼Œå°†é¢‘ç¹çš„å›è°ƒå‡½æ•°ï¼Œè¿›è¡Œæ¬¡æ•°ç¼©å‡ï¼Œé¿å…å¤§é‡è®¡ç®—å¯¼è‡´çš„é¡µé¢å¡é¡¿ã€‚

**ä¸åŒ**ï¼šé˜²æŠ–æ˜¯å°†å¤šæ¬¡æ‰§è¡Œå˜ä¸ºæœ€åä¸€æ¬¡æ‰§è¡Œï¼ŒèŠ‚æµæ˜¯å°†å¤šæ¬¡æ‰§è¡Œå˜ä¸ºåœ¨è§„å®šæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡ã€‚



### é˜²æŠ–

**å®šä¹‰ï¼š**

æŒ‡è§¦å‘äº‹ä»¶ååœ¨**è§„å®šæ—¶é—´å†…**å›è°ƒå‡½æ•°**åªèƒ½æ‰§è¡Œä¸€æ¬¡**ï¼Œå¦‚æœåœ¨è§„å®šæ—¶é—´å†…**åˆ**è§¦å‘äº†è¯¥æ¡ä»¶ï¼Œåˆ™ä¼šé‡æ–°å¼€å§‹ç®—è§„å®šæ—¶é—´ã€‚

ç½‘ä¸Šæœ‰è¿™ä¸ªæ¯”å–»ï¼šå‡½æ•°é˜²æŠ–å°±æ˜¯æ³•å¸ˆé‡Šæ”¾æŠ€èƒ½çš„æ—¶å€™è¦è¯»æ¡ï¼ŒæŠ€èƒ½è¯»æ¡æ²¡å®Œæˆå†é‡Šæ”¾æŠ€èƒ½å°±ä¼šåˆ·æ–°æŠ€èƒ½ï¼Œé‡æ–°è¿›è¡Œè¯»æ¡ã€‚

å››ä¸ªå­—æ€»ç»“å°±æ˜¯ï¼š**å»¶æ—¶æ‰§è¡Œ**

**åº”ç”¨åœºæ™¯ï¼š**

ä¸¤ä¸ªæ¡ä»¶ï¼š

1. å¦‚æœå®¢æˆ·è¿ç»­çš„æ“ä½œä¼šå¯¼è‡´é¢‘ç¹çš„äº‹ä»¶å›è°ƒï¼ˆå¯èƒ½å¼•èµ·é¡µé¢å¡é¡¿ï¼‰ã€‚
2. å®¢æˆ·åªå…³å¿ƒâ€œæœ€åä¸€æ¬¡â€æ“ä½œï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºåœæ­¢è¿ç»­æ“ä½œåï¼‰æ‰€è¿”å›çš„ç»“æœã€‚

ä¾‹å¦‚ï¼š

* è¾“å…¥æœç´¢è”æƒ³ï¼Œç”¨æˆ·åœ¨ä¸æ–­è¾“å…¥å€¼æ—¶ï¼Œç”¨é˜²æŠ–æ¥èŠ‚çº¦è¯·æ±‚èµ„æºã€‚
* æŒ‰é’®ç‚¹å‡»ï¼šæ”¶è—ï¼Œç‚¹èµï¼Œå¿ƒæ ‡ç­‰ã€‚

**åŸç†ï¼š**

é€šè¿‡å®šæ—¶å™¨å°†å›è°ƒå‡½æ•°è¿›è¡Œå»¶æ—¶ï¼Œå¦‚æœåœ¨è§„å®šæ—¶é—´å†…ç»§ç»­å›è°ƒï¼Œå‘ç°å­˜åœ¨ä¹‹å‰çš„å®šæ—¶å™¨ï¼Œåˆ™å°†è¯¥å®šæ—¶å™¨æ¸…é™¤ï¼Œå¹¶é‡æ–°è®¾ç½®å®šæ—¶å™¨ï¼Œè¿™é‡Œæœ‰ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯åé¢æ‰€æœ‰çš„å›è°ƒå‡½æ•°éƒ½è¦èƒ½è®¿é—®åˆ°ä¹‹å‰è®¾ç½®çš„å®šæ—¶å™¨ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°é—­åŒ…ã€‚

**ä¸¤ç§ç‰ˆæœ¬ï¼š**

é˜²æŠ–åˆ†ä¸ºä¸¤ç§ï¼š

* éç«‹å³æ‰§è¡Œç‰ˆï¼šäº‹ä»¶è§¦å‘->å»¶æ—¶->æ‰§è¡Œå›è°ƒå‡½æ•°ï¼›å¦‚æœåœ¨å»¶æ—¶ä¸­ï¼Œç»§ç»­è§¦å‘äº‹ä»¶ï¼Œåˆ™ä¼šé‡æ–°è¿›è¡Œå»¶æ—¶ï¼Œåœ¨å»¶æ—¶ç»“æŸåæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å¸¸è§çš„ä¾‹å­ï¼šå°±æ˜¯inputæœç´¢æ¡†ï¼Œå®¢æˆ·è¾“å®Œè¿‡ä¸€ä¼šå°±ä¼šè‡ªåŠ¨æœç´¢ã€‚
* ç«‹å³æ‰§è¡Œç‰ˆï¼šäº‹ä»¶è§¦å‘->æ‰§è¡Œå›è°ƒå‡½æ•°->å»¶æ—¶ï¼›å¦‚æœåœ¨å»¶æ—¶ä¸­ï¼Œç»§ç»­è§¦å‘äº‹ä»¶ï¼Œåˆ™ä¼šé‡æ–°è¿›è¡Œå»¶æ—¶ï¼Œåœ¨å»¶æ—¶ç»“æŸåï¼Œå¹¶ä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¸¸è§ä¾‹å­ï¼šå°±æ˜¯å¯¹äºæŒ‰é’®é˜²æ­¢ç‚¹å‡»ï¼Œä¾‹å¦‚ç‚¹èµï¼Œå¿ƒæ ‡ï¼Œæ”¶è—ç­‰æœ‰ç«‹å³åé¦ˆçš„æŒ‰é’®ã€‚

**å®ç°ä»£ç åŠæ€è·¯ï¼š**

```javascript
//éç«‹å³æ‰§è¡Œç‰ˆ:
//é¦–å…ˆå‡†å¤‡æˆ‘ä»¬è¦ä½¿ç”¨çš„å›è°ƒå‡½æ•°
function shotCat (content) {
  console.log('shotCatå‡ºå“,å¿…å±ç²¾å“!å¿…é¡»ç‚¹èµ!(æ»‘ç¨½)')
}

//ç„¶åå‡†å¤‡åŒ…è£…å‡½æ•°:
//1,ä¿å­˜å®šæ—¶å™¨æ ‡è¯† 
//2,è¿”å›é—­åŒ…å‡½æ•°: 1)å¯¹å®šæ—¶å™¨çš„åˆ¤æ–­æ¸…é™¤;2)ä¸€èˆ¬è¿˜éœ€è¦ä¿å­˜å‡½æ•°çš„å‚æ•°(ä¸€èˆ¬å°±æ˜¯äº‹ä»¶è¿”å›çš„å¯¹è±¡)å’Œä¸Šä¸‹æ–‡(å®šæ—¶å™¨å­˜åœ¨thiséšå¼ä¸¢å¤±,è¯¦æƒ…å¯ä»¥çœ‹æˆ‘ä¸çŸ¥é“çš„jsä¸Š)
//æœ€åè¡¥å……ä¸€å¥,è¿™é‡Œä¸å»ºè®®é€šè¿‡å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡æ¥æ›¿ä»£é—­åŒ…ä¿å­˜å®šæ—¶å™¨æ ‡è¯†.
function debounce(fun, delay = 500) {
//let timer = null ä¿å­˜å®šæ—¶å™¨
    return function (args) {
        let that = this
        let _args = args
		//è¿™é‡Œå¯¹å®šæ—¶å™¨çš„è®¾ç½®æœ‰ä¸¤ç§æ–¹æ³•,ç¬¬ä¸€ç§å°±æ˜¯å°†å®šæ—¶å™¨ä¿å­˜åœ¨å‡½æ•°(å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡)çš„å±æ€§ä¸Š,
		//è¿™ç§å†™æ³•,å¾ˆç®€ä¾¿,ä½†ä¸æ˜¯å¾ˆå¸¸ç”¨
        clearTimeout(fun.timer)
        fun.timer = setTimeout(function () {
            fun.call(that, _args)
        }, delay)
		//å¦å¤–ä¸€ç§å†™æ³•å°±æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„
		//if (timer) clearTimeout(timer);     ç›¸æ¯”ä¸Šé¢çš„æ–¹æ³•,è¿™é‡Œå¤šä¸€ä¸ªåˆ¤æ–­
		//timer = setTimeout(function () {
        //    fun.call(that, _args)
        //}, delay)
    }
}
 //æ¥ç€ç”¨å˜é‡ä¿å­˜ä¿å­˜ debounce è¿”å›çš„å¸¦æœ‰å»¶æ—¶åŠŸèƒ½çš„å‡½æ•°
let debounceShotCat = debounce(shotCat, 500)  

//æœ€åæ·»åŠ äº‹ä»¶ç›‘å¬ å›è°ƒdebounceShotCat å¹¶ä¼ å…¥äº‹ä»¶è¿”å›çš„å¯¹è±¡
let input = document.getElementById('debounce')
input.addEventListener('keyup', function (e) {
        debounceShotCat(e.target.value)
})



//å¸¦æœ‰ç«‹å³æ‰§è¡Œé€‰é¡¹çš„é˜²æŠ–å‡½æ•°:
//æ€è·¯å’Œä¸Šé¢çš„å¤§è‡´ç›¸åŒ,å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œ,åˆ™å®šæ—¶å™¨ä¸­ä¸å†åŒ…å«å›è°ƒå‡½æ•°,è€Œæ˜¯åœ¨å›è°ƒå‡½æ•°æ‰§è¡Œå,ä»…èµ·åˆ°å»¶æ—¶å’Œé‡ç½®å®šæ—¶å™¨æ ‡è¯†çš„ä½œç”¨
function debounce(fun, delay = 500,immediate = true) {
    let timer = null //ä¿å­˜å®šæ—¶å™¨
    return function (args) {
        let that = this
        let _args = args
		if (timer) clearTimeout(timer);  //ä¸ç®¡æ˜¯å¦ç«‹å³æ‰§è¡Œéƒ½éœ€è¦é¦–å…ˆæ¸…ç©ºå®šæ—¶å™¨
        if (immediate) {
		    if ( !timer) fun.apply(that, _args)  //å¦‚æœå®šæ—¶å™¨ä¸å­˜åœ¨,åˆ™è¯´æ˜å»¶æ—¶å·²è¿‡,å¯ä»¥ç«‹å³æ‰§è¡Œå‡½æ•°
			//ä¸ç®¡ä¸Šä¸€ä¸ªå»¶æ—¶æ˜¯å¦å®Œæˆ,éƒ½éœ€è¦é‡ç½®å®šæ—¶å™¨
            timer = setTimeout(function(){
                timer = null; //åˆ°æ—¶é—´å,å®šæ—¶å™¨è‡ªåŠ¨è®¾ä¸ºnull,ä¸ä»…æ–¹ä¾¿åˆ¤æ–­å®šæ—¶å™¨çŠ¶æ€è¿˜èƒ½é¿å…å†…å­˜æ³„éœ²
            }, delay)
        }
        else {
		//å¦‚æœæ˜¯éç«‹å³æ‰§è¡Œç‰ˆ,åˆ™é‡æ–°è®¾å®šå®šæ—¶å™¨,å¹¶å°†å›è°ƒå‡½æ•°æ”¾å…¥å…¶ä¸­
            timer = setTimeout(function(){
                fun.call(that, _args)
            }, delay);
        }
    }
}
```

### èŠ‚æµ

**å®šä¹‰ï¼š**

å½“æŒç»­è§¦å‘äº‹ä»¶æ—¶ï¼Œåœ¨è§„å®šæ—¶é—´æ®µå†…åªèƒ½è°ƒç”¨ä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚å¦‚æœåœ¨è§„å®šæ—¶é—´å†…**åˆ**è§¦å‘äº†è¯¥äº‹ä»¶ï¼Œ**åˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼Œä¹Ÿä¸ä¼šé‡ç½®å®šæ—¶å™¨**ã€‚

**ä¸é˜²æŠ–æ¯”è¾ƒï¼š**

é˜²æŠ–æ˜¯å°†å¤šæ¬¡æ‰§è¡Œå˜ä¸ºæœ€åä¸€æ¬¡æ‰§è¡Œï¼ŒèŠ‚æµæ˜¯å°†å¤šæ¬¡æ‰§è¡Œå˜ä¸ºåœ¨è§„å®šæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸€èˆ¬**ä¸ä¼šé‡ç½®å®šæ—¶å™¨**ï¼Œå³ä¸ä¼šif(timer) clearTimeout(timer); ï¼ˆ**æ—¶é—´æˆ³+å®šæ—¶å™¨ç‰ˆé™¤å¤–**ï¼‰

**åº”ç”¨åœºæ™¯ï¼š**

ä¸¤ä¸ªæ¡ä»¶ï¼š

1. å®¢æˆ·è¿ç»­é¢‘ç¹åœ°è§¦å‘äº‹ä»¶ã€‚
2. å®¢æˆ·ä¸å†åªå…³å¿ƒâ€œæœ€åä¸€æ¬¡â€æ“ä½œåçš„ç»“æœåé¦ˆï¼Œè€Œæ˜¯åœ¨æ“ä½œè¿‡ç¨‹ä¸­æŒç»­çš„åé¦ˆã€‚

ä¾‹å¦‚ï¼š

* é¼ æ ‡ä¸æ–­ç‚¹å‡»è§¦å‘ï¼Œç‚¹å‡»äº‹ä»¶åœ¨è§„å®šæ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡ï¼ˆå•ä½æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡ï¼‰ã€‚
* ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ¯”å¦‚æ˜¯å¦æ»‘åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šï¼Œç”¨throttleæ¥åˆ¤æ–­ã€‚

**æ³¨æ„ï¼š**ä½•ä¸ºè¿ç»­é¢‘ç¹åœ°è§¦å‘äº‹ä»¶ï¼Œå°±æ˜¯**äº‹ä»¶è§¦å‘çš„æ—¶é—´é—´éš”è‡³å°‘æ˜¯è¦æ¯”è§„å®šçš„æ—¶é—´è¦çŸ­**ã€‚

**åŸç†ï¼š**

èŠ‚æµæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š

1. æ—¶é—´æˆ³æ–¹å¼ï¼šé€šè¿‡é—­åŒ…ä¿å­˜ä¸Šä¸€æ¬¡çš„æ—¶é—´æˆ³ï¼Œç„¶åä¸äº‹ä»¶è§¦å‘çš„æ—¶é—´æˆ³æ¯”è¾ƒï¼Œå¦‚æœå¤§äºè§„å®šæ—¶é—´ï¼Œåˆ™æ‰§è¡Œå›è°ƒï¼Œå¦åˆ™å°±ä»€ä¹ˆéƒ½ä¸å¤„ç†ã€‚

   ç‰¹ç‚¹ï¼š**ä¸€èˆ¬ç¬¬ä¸€æ¬¡ä¼šç«‹å³æ‰§è¡Œ**ï¼Œä¹‹åè¿ç»­é¢‘ç¹åœ°è§¦å‘äº‹ä»¶ï¼Œä¹Ÿæ˜¯è¶…è¿‡äº†è§„å®šæ—¶é—´æ‰ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚æœ€åä¸€æ¬¡è§¦å‘äº‹ä»¶ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œï¼ˆè¯´æ˜ï¼šå¦‚æœä½ æœ€åä¸€æ¬¡è§¦å‘æ—¶é—´å¤§äºè§„å®šæ—¶é—´ï¼Œè¿™æ ·å°±ç®—ä¸ä¸Šè¿ç»­é¢‘ç¹è§¦å‘äº†ï¼‰ã€‚

2. å®šæ—¶å™¨æ–¹å¼ï¼šåŸç†ä¸é˜²æŠ–ç±»ä¼¼ï¼Œé€šè¿‡é—­åŒ…ä¿å­˜ä¸Šä¸€æ¬¡å®šæ—¶å™¨çŠ¶æ€ï¼Œç„¶åäº‹ä»¶è§¦å‘æ—¶ï¼Œå¦‚æœå®šæ—¶å™¨ä¸ºnullï¼ˆå³ä»£è¡¨æ­¤æ—¶é—´éš”å·²ç»å¤§äºè§„å®šæ—¶é—´ï¼‰ï¼Œåˆ™è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œåˆ°æ—¶é—´åæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¹¶å°†å®šæ—¶å™¨ç½®ä¸ºnullã€‚

   ç‰¹ç‚¹ï¼š**å½“ç¬¬ä¸€æ¬¡è§¦å‘äº‹ä»¶æ—¶ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œåˆ°äº†è§„å®šæ—¶é—´åæ‰ä¼šæ‰§è¡Œã€‚**ä¹‹åè¿ç»­é¢‘ç¹åœ°è§¦å‘äº‹ä»¶ï¼Œä¹Ÿæ˜¯åˆ°äº†è§„å®šæ—¶é—´æ‰ä¼šæ‰§è¡Œä¸€æ¬¡ï¼ˆå› ä¸ºå®šæ—¶å™¨ï¼‰ã€‚å½“æœ€åä¸€æ¬¡åœæ­¢è§¦å‘åï¼Œç”±äºå®šæ—¶å™¨çš„å»¶æ—¶ï¼Œè¿˜ä¼šæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ï¼ˆé‚£ä¹Ÿæ˜¯ä¸Šä¸€æ¬¡æˆåŠŸè§¦å‘æ‰§è¡Œçš„å›è°ƒï¼Œè€Œä¸æ˜¯ä½ æœ€åä¸€æ¬¡è§¦å‘äº§ç”Ÿçš„ï¼‰ã€‚**ä¸€å¥è¯æ€»ç»“å°±æ˜¯å»¶æ—¶å›è°ƒï¼Œä½ èƒ½çœ‹åˆ°çš„å›è°ƒéƒ½æ˜¯ä¸Šæ¬¡æˆåŠŸè§¦å‘äº§ç”Ÿçš„ï¼Œè€Œä¸æ˜¯ä½ æ­¤åˆ»è§¦å‘äº§ç”Ÿçš„**ã€‚

**è¯´æ˜ï¼š**è¿™ä¸¤è€…æœ€å¤§çš„åŒºåˆ«ï¼šæ—¶é—´æˆ³ç‰ˆçš„å‡½æ•°è§¦å‘æ˜¯åœ¨è§„å®šæ—¶é—´å¼€å§‹çš„æ—¶å€™ï¼Œè€Œå®šæ—¶å™¨ç‰ˆçš„å‡½æ•°è§¦å‘æ˜¯åœ¨è§„å®šæ—¶é—´ç»“æŸçš„æ—¶å€™ã€‚

**å®ç°ä»£ç åŠæ€è·¯ï¼š**

```javascript
//æ—¶é—´æˆ³ç‰ˆï¼š
//è¿™é‡ŒfunæŒ‡çš„å°±æ˜¯å›è°ƒå‡½æ•°,æˆ‘å°±ä¸å†™å‡ºæ¥äº†
function throttle(fun, delay = 500) {
    let previous = 0;  //è®°å½•ä¸Šä¸€æ¬¡è§¦å‘çš„æ—¶é—´æˆ³.è¿™é‡Œåˆå§‹è®¾ä¸º0,æ˜¯ä¸ºäº†ç¡®ä¿ç¬¬ä¸€æ¬¡è§¦å‘äº§ç”Ÿå›è°ƒ
    return function(args) {
        let now = Date.now(); //è®°å½•æ­¤åˆ»è§¦å‘æ—¶çš„æ—¶é—´æˆ³
        let that = this;
        let _args = args;
        if (now - previous > delay) {  //å¦‚æœæ—¶é—´å·®å¤§äºè§„å®šæ—¶é—´,åˆ™è§¦å‘
            fun.apply(that, _args);
            previous = now;
        }
    }
}


//å®šæ—¶å™¨ç‰ˆ:
function throttle(fun, delay = 500) {
    let timer;
    return function(args) {
        let that = this;
        let _args = args;
        if (!timer) {  //å¦‚æœå®šæ—¶å™¨ä¸å­˜åœ¨,åˆ™è®¾ç½®æ–°çš„å®šæ—¶å™¨,åˆ°æ—¶å,æ‰æ‰§è¡Œå›è°ƒ,å¹¶å°†å®šæ—¶å™¨è®¾ä¸ºnull
            timer = setTimeout(function(){
                timer = null;
                fun.apply(that, _args)
            }, delay)
        }

    }
}




//æ—¶é—´æˆ³+å®šæ—¶å™¨ç‰ˆ: å®ç°ç¬¬ä¸€æ¬¡è§¦å‘å¯ä»¥ç«‹å³å“åº”,ç»“æŸè§¦å‘åä¹Ÿèƒ½æœ‰å“åº” (è¯¥ç‰ˆæ‰æ˜¯æœ€ç¬¦åˆå®é™…å·¥ä½œéœ€æ±‚)
//è¯¥ç‰ˆä¸»ä½“æ€è·¯è¿˜æ˜¯æ—¶é—´æˆ³ç‰ˆ,å®šæ—¶å™¨çš„ä½œç”¨ä»…ä»…æ˜¯æ‰§è¡Œæœ€åä¸€æ¬¡å›è°ƒ
function throttle(fun, delay = 500) {
     let timer = null;
     let previous = 0;
     return function(args) {
             let now = Date.now();
             let remaining = delay - (now - previous); //è·ç¦»è§„å®šæ—¶é—´,è¿˜å‰©å¤šå°‘æ—¶é—´
             let that = this;
             let _args = args;
             clearTimeout(timer);  //æ¸…é™¤ä¹‹å‰è®¾ç½®çš„å®šæ—¶å™¨
              if (remaining <= 0) {
                    fun.apply(that, _args);
                    previous = Date.now();
              } else {
                    timer = setTimeout(function(){
                    fun.apply(that, _args)
            }, remaining); //å› ä¸ºä¸Šé¢æ·»åŠ çš„clearTimeout.å®é™…è¿™ä¸ªå®šæ—¶å™¨åªæœ‰æœ€åä¸€æ¬¡æ‰ä¼šæ‰§è¡Œ
              }
      }
}
```

## äºŒã€JSåƒåœ¾å›æ”¶æœºåˆ¶ç­–ç•¥

### æ ‡è®°æ¸…é™¤ç®—æ³•

JavaScriptä¸­æœ€å¸¸ç”¨çš„åƒåœ¾æ”¶é›†æ–¹å¼æ˜¯æ ‡è®°æ¸…é™¤ï¼ˆmark-and-sweepï¼‰ã€‚

è¿™ä¸ªç®—æ³•æŠŠâ€œå¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦â€ç®€åŒ–å®šä¹‰ä¸ºâ€œå¯¹è±¡æ˜¯å¦å¯ä»¥è·å¾—â€ã€‚

è¯¥ç®—æ³•å‡å®šè®¾ç½®ä¸€ä¸ªå«åšæ ¹ï¼ˆrootï¼‰çš„å¯¹è±¡ï¼ˆåœ¨JavaScripté‡Œï¼Œæ ¹æ˜¯å…¨å±€å¯¹è±¡ï¼‰ã€‚åƒåœ¾å›æ”¶å™¨å°†å®šæœŸä»æ ¹å¼€å§‹æ‰«æå†…å­˜ä¸­çš„å¯¹è±¡ã€‚å‡¡æ˜¯èƒ½ä»æ ¹éƒ¨åˆ°è¾¾çš„å¯¹è±¡ï¼Œéƒ½æ˜¯è¿˜éœ€è¦ä½¿ç”¨çš„ã€‚é‚£äº›æ— æ³•ç”±æ ¹éƒ¨è§¦å‘è§¦åŠåˆ°çš„å¯¹è±¡è¢«æ ‡è®°ä¸ºä¸å†ä½¿ç”¨ï¼Œç¨åè¿›è¡Œå›æ”¶ã€‚

æ­¤ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯æ ‡è®°é˜¶æ®µï¼ˆmarkï¼‰ï¼Œä¸€ä¸ªæ˜¯æ¸…é™¤é˜¶æ®µï¼ˆsweepï¼‰ã€‚

1. æ ‡è®°é˜¶æ®µï¼Œåƒåœ¾å›æ”¶å™¨ä¼šä»æ ¹å¯¹è±¡å¼€å§‹éå†ã€‚æ¯ä¸€ä¸ªå¯ä»¥ä»æ ¹å¯¹è±¡è®¿é—®åˆ°çš„å¯¹è±¡éƒ½ä¼šè¢«æ·»åŠ ä¸€ä¸ªæ ‡è¯†ï¼Œäºæ˜¯è¿™ä¸ªå¯¹è±¡å°±è¢«æ ‡è¯†ä¸ºå¯è¾¾åˆ°å¯¹è±¡ã€‚
2. æ¸…é™¤é˜¶æ®µï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§éå†ï¼Œå¦‚æœå‘ç°æœ‰å¯¹è±¡æ²¡æœ‰è¢«æ ‡è¯†ä¸ºå¯è¾¾åˆ°å¯¹è±¡ï¼Œé‚£ä¹ˆä¹…å°†æ­¤é˜¶æ®µå ç”¨çš„å†…å­˜å›æ”¶ï¼Œå¹¶ä¸”å°†åŸæ¥æ ‡è®°ä¸ºå¯è¾¾åˆ°å¯¹è±¡çš„æ ‡è¯†æ¸…é™¤ï¼Œä»¥ä¾¿è¿›è¡Œä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ“ä½œã€‚

![æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶ç¤ºæ„å›¾](https://user-gold-cdn.xitu.io/2019/2/22/169158136a253bc3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

åœ¨æ ‡è®°é˜¶æ®µï¼Œä»æ ¹å¯¹è±¡1å¯ä»¥è®¿é—®åˆ°Bï¼Œä»Båˆå¯ä»¥è®¿é—®åˆ°Eï¼Œé‚£ä¹ˆBå’ŒEéƒ½æ˜¯å¯åˆ°è¾¾å¯¹è±¡ï¼ŒåŒæ ·çš„é“ç†ï¼ŒFã€Gã€Jå’ŒKéƒ½æ˜¯å¯åˆ°è¾¾å¯¹è±¡ã€‚

åœ¨å›æ”¶é˜¶æ®µï¼Œæ‰€æœ‰æœªæ ‡è®°ä¸ºå¯åˆ°è¾¾çš„å¯¹è±¡éƒ½ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚

**ä½•æ—¶å¼€å§‹åƒåœ¾å›æ”¶ï¼Ÿ**

é€šå¸¸æ¥è¯´ï¼Œåœ¨ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•æ—¶ï¼Œæœªå¼•ç”¨å¯¹è±¡å¹¶ä¸ä¼šè¢«ç«‹å³å›æ”¶ã€‚å–è€Œä»£ä¹‹çš„åšæ³•æ˜¯ï¼Œåƒåœ¾å¯¹è±¡å°†ä¸€ç›´ç´¯ç§¯åˆ°å†…å­˜è€—å°½ä¸ºæ­¢ã€‚å½“å†…å­˜è€—å°½æ—¶ï¼Œç¨‹åºå°†ä¼šè¢«æŒ‚èµ·ï¼Œåƒåœ¾å›æ”¶å¼€å§‹æ‰§è¡Œã€‚

è¡¥å……: ä»2012å¹´èµ·ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½ä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤åƒåœ¾å›æ”¶ç®—æ³•ã€‚æ‰€æœ‰å¯¹JavaScriptåƒåœ¾å›æ”¶ç®—æ³•çš„æ”¹è¿›éƒ½æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ”¹è¿›ï¼Œå¹¶æ²¡æœ‰æ”¹è¿›æ ‡è®°-æ¸…é™¤ç®—æ³•æœ¬èº«å’Œå®ƒå¯¹â€œå¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦â€çš„ç®€åŒ–å®šä¹‰ã€‚

**æ ‡è®°æ¸…é™¤ç®—æ³•ç¼ºé™·**

* é‚£äº›æ— æ³•ä»æ ¹å¯¹è±¡æŸ¥è¯¢åˆ°çš„å¯¹è±¡éƒ½å°†è¢«æ¸…é™¤
* åƒåœ¾æ”¶é›†åæœ‰å¯èƒ½ä¼šé€ æˆå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œåƒä¸Šé¢çš„å›¾ç‰‡æ‰€ç¤ºï¼Œåƒåœ¾æ”¶é›†åå†…å­˜ä¸­å­˜åœ¨ä¸‰ä¸ªå†…å­˜ç¢ç‰‡ï¼Œå‡è®¾ä¸€ä¸ªæ–¹æ ¼ä»£è¡¨1ä¸ªå•ä½çš„å†…å­˜ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¯¹è±¡éœ€è¦å ç”¨3ä¸ªå†…å­˜å•ä½çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å†…å­˜åˆ†é…å™¨ä¸€ç›´å¤„äºæš‚åœçŠ¶æ€ï¼Œè€Œåƒåœ¾æ”¶é›†å™¨ä¸€ç›´åœ¨å°è¯•è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œç›´åˆ°å†…å­˜æº¢å‡ºã€‚

### å¼•ç”¨è®¡æ•°ç®—æ³•

è¿™æ˜¯æœ€åˆçº§çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œç°åœ¨å·²ç»æ²¡æœ‰æµè§ˆå™¨ä¼šç”¨è¿™ç§ç®—æ³•ã€‚

æ­¤ç®—æ³•æŠŠâ€œå¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦â€ç®€åŒ–å®šä¹‰ä¸ºâ€œå¯¹è±¡æ²¡æœ‰å…¶ä»–å¯¹è±¡å¼•ç”¨åˆ°å®ƒâ€ã€‚å¦‚æœæ²¡å“Ÿå¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡ï¼ˆé›¶å¼•ç”¨ï¼‰ï¼Œå¯¹è±¡å°†è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚

å¼•ç”¨è®¡æ•°çš„å«ä¹‰æ˜¯è·Ÿè¸ªè®°å½•æ¯ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹å€¼èµ‹ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯1ã€‚å¦‚æœåŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œåˆ™è¯¥å€¼çš„å¼•ç”¨æ¬¡æ•°åŠ 1ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå–å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å‡1ã€‚å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜æˆ0æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŠæ³•å†è®¿é—®è¿™ä¸ªå€¼äº†ï¼Œå› è€Œå°±å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç©ºé—´å›æ”¶å›æ¥ã€‚è¿™æ ·ï¼Œå½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾é‚£äº›å¼•ç”¨æ¬¡æ•°ä¸ºé›¶çš„å€¼æ‰€å ç”¨çš„å†…å­˜ã€‚

**å¼•ç”¨è®¡æ•°ç¼ºé™·**

è¯¥ç®—æ³•æœ‰ä¸ªé™åˆ¶ï¼šæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡è¢«åˆ›å»ºï¼Œå¹¶äº’ç›¸å¼•ç”¨ï¼Œå½¢æˆäº†ä¸€ä¸ªå¾ªç¯ã€‚å®ƒä»¬è¢«è°ƒç”¨ä¹‹åä¼šç¦»å¼€å‡½æ•°ä½œç”¨åŸŸï¼Œæ‰€ä»¥å®ƒä»¬å·²ç»æ²¡æœ‰ç”¨äº†ï¼Œå¯ä»¥è¢«å›æ”¶äº†ã€‚ç„¶è€Œï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•è€ƒè™‘åˆ°å®ƒä»¬äº’ç›¸éƒ½æœ‰è‡³å°‘ä¸€æ¬¡å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¸ä¼šè¢«å›æ”¶ã€‚

### Chrome V8 åƒåœ¾å›æ”¶ç®—æ³•

Chrome æµè§ˆå™¨æ‰€ä½¿ç”¨çš„ V8 å¼•æ“å°±æ˜¯é‡‡ç”¨çš„åˆ†ä»£å›æ”¶ç­–ç•¥ã€‚è¿™ä¸ªå’Œ Java å›æ”¶ç­–ç•¥æ€æƒ³æ˜¯ä¸€è‡´çš„ã€‚ç›®çš„æ˜¯é€šè¿‡åŒºåˆ†ã€Œä¸´æ—¶ã€ä¸ã€ŒæŒä¹…ã€å¯¹è±¡ï¼›å¤šå›æ”¶ã€Œä¸´æ—¶å¯¹è±¡åŒºã€ï¼ˆ**æ–°ç”Ÿä»£**younggenerationï¼‰ï¼Œå°‘å›æ”¶ã€ŒæŒä¹…å¯¹è±¡åŒºã€ï¼ˆ**è€ç”Ÿä»£** tenured generationï¼‰ï¼Œå‡å°‘æ¯æ¬¡éœ€éå†çš„å¯¹è±¡ï¼Œä»è€Œå‡å°‘æ¯æ¬¡GCçš„è€—æ—¶ã€‚

####V8çš„å†…å­˜é™åˆ¶

åœ¨nodeä¸­JavaScriptèƒ½ä½¿ç”¨çš„å†…å­˜æ˜¯æœ‰é™åˆ¶çš„ã€‚

> 1. 64ä½ç³»ç»Ÿä¸‹çº¦ä¸º1.4GBã€‚
> 2. 32ä½ç³»ç»Ÿä¸‹çº¦ä¸º0.7GBã€‚

å¯¹åº”åˆ°åˆ†ä»£å†…å­˜ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ã€‚

> 1. 32ä½ç³»ç»Ÿæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º16MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º700MBã€‚
> 2. 64ä½ç³»ç»Ÿä¸‹ï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º32MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º1.4GBã€‚

æ–°ç”Ÿä»£å¹³å‡åˆ†æˆä¸¤å—ç›¸ç­‰çš„å†…å­˜ç©ºé—´ï¼Œå«åšsemispaceï¼Œæ¯å—å†…å­˜å¤§å°8MBï¼ˆ32ä½ï¼‰æˆ–16MBï¼ˆ64ä½ï¼‰ã€‚

è¿™ä¸ªé™åˆ¶åœ¨nodeå¯åŠ¨çš„æ—¶å€™å¯ä»¥é€šè¿‡ä¼ é€’--max-old-space-size å’Œ --max-new-space-sizeæ¥è°ƒæ•´ï¼Œå¦‚ï¼š

```bash
node --max-old-space-size=1700 app.js //å•ä½ä¸ºMB
node --max-new-space-size=1024 app.js //å•ä½ä¸ºMB
```

ä¸Šè¿°å‚æ•°åœ¨V8åˆå§‹åŒ–æ—¶ç”Ÿæ•ˆï¼Œä¸€æ—¦ç”Ÿæ•ˆå°±ä¸èƒ½å†åŠ¨æ€æ”¹å˜ã€‚

**å†…å­˜é™åˆ¶çš„åŸå› **

è‡³äºV8ä¸ºä½•è¦é™åˆ¶å †çš„å¤§å°ï¼Œè¡¨å±‚åŸå› ï¼šV8æœ€åˆä¸ºæµè§ˆå™¨è€Œè®¾è®¡ï¼Œä¸å¤ªå¯èƒ½é‡åˆ°ç”¨å¤§é‡å†…å­˜çš„åœºæ™¯ã€‚æ·±å±‚åŸå› ï¼šV8çš„åƒåœ¾å›æ”¶æœºåˆ¶çš„é™åˆ¶ã€‚å®˜æ–¹è¯´æ³•ï¼Œä»¥1.5GBçš„åƒåœ¾å›æ”¶å †å†…å­˜ä¸ºä¾‹ï¼ŒV8åšä¸€æ¬¡å°çš„åƒåœ¾å›æ”¶éœ€è¦50æ¯«ç§’ä»¥ä¸Šï¼Œåšä¸€æ¬¡éå¢é‡å¼çš„åƒåœ¾å›æ”¶ç”šè‡³è¦1ç§’ä»¥ä¸Šã€‚è¿™æ˜¯åƒåœ¾å›æ”¶ä¸­å¼•èµ·JSçº¿ç¨‹æš‚åœæ‰§è¡Œçš„æ—¶é—´ï¼Œåœ¨è¿™æ ·æ—¶é—´èŠ±é”€ä¸‹ï¼Œåº”ç”¨çš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›éƒ½ä¼šç›´çº¿ä¸‹é™ã€‚

####V8çš„åˆ†ä»£å›æ”¶ï¼ˆGeneration GCï¼‰

V8åƒåœ¾å›æ”¶ç­–ç•¥ä¸»è¦åŸºäºåˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ç°ä»£çš„åƒåœ¾å›æ”¶ç®—æ³•ä¸­æŒ‰å¯¹è±¡çš„å­˜æ´»æ—¶é—´å°†å†…å­˜çš„åƒåœ¾å›æ”¶è¿›è¡Œä¸åŒçš„åˆ†ä»£ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸åŒåˆ†ä»£çš„å†…å­˜æ–½ä»¥æ›´é«˜æ•ˆçš„ç®—æ³•ã€‚

**V8çš„å†…å­˜åˆ†ä»£**

åœ¨V8ä¸­ï¼Œä¸»è¦å°†å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ï¼Œ**æ–°ç”Ÿä»£å†…å­˜ å­˜å‚¨çš„ä¸ºå­˜æ´»æ—¶é—´è¾ƒçŸ­çš„å¯¹è±¡**ï¼Œ**è€ç”Ÿä»£å†…å­˜ å­˜å‚¨çš„ä¸ºå­˜æ´»æ—¶é—´è¾ƒé•¿æˆ–å¸¸é©»å†…å­˜çš„å¯¹è±¡**ï¼Œå¦‚ä¸‹å›¾ï¼š

![V8å¯¹è±¡å†…å­˜è¿›è¡Œå¯¹è±¡åˆ†ä»£](https://user-gold-cdn.xitu.io/2019/2/19/16904df8de47c353?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

**V8å †çš„æ•´ä½“å¤§å°å°±æ˜¯æ–°ç”Ÿä»£æ‰€ç”¨å†…å­˜ç©ºé—´åŠ ä¸Šè€ç”Ÿä»£çš„å†…å­˜ç©ºé—´ã€‚**

#### V8æ–°ç”Ÿä»£ç®—æ³•ï¼ˆScavengeï¼‰:

åœ¨åˆ†ä»£åŸºç¡€ä¸Šï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ä¸»è¦é€šè¿‡Scavengeç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åœ¨Scavengeçš„å…·ä½“å®ç°ä¸­ï¼Œä¸»è¦é‡‡ç”¨äº†Cheneyç®—æ³•

Cheneyç®—æ³•æ˜¯ä¸€ç§é‡‡ç”¨å¤åˆ¶çš„æ–¹å¼å®ç°çš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å®ƒå°†å †å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œæ¯ä¸€éƒ¨åˆ†ç©ºé—´ç§°ä¸ºsemispaceã€‚åœ¨è¿™ä¸¤ä¸ªsemispaceç©ºé—´ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå¤„äºä½¿ç”¨ä¸­ï¼Œå¦ä¸€ä¸ªå¤„äºé—²ç½®çŠ¶æ€ã€‚**å¤„äºä½¿ç”¨çŠ¶æ€çš„semispaceç©ºé—´ç§°ä¸ºFromç©ºé—´ï¼Œå¤„äºé—²ç½®çŠ¶æ€çš„ç©ºé—´ç§°ä¸ºToç©ºé—´ã€‚**

å½“æˆ‘ä»¬åˆ†é…å¯¹è±¡æ—¶ï¼Œå…ˆæ˜¯åœ¨Fromç©ºé—´ä¸­è¿›è¡Œåˆ†é…ã€‚å½“å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¼šæ£€æŸ¥Fromç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›å­˜æ´»å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°Toç©ºé—´ä¸­ï¼Œè€Œ(Fromç©ºé—´å†…çš„)éå­˜æ´»å¯¹è±¡å ç”¨çš„ç©ºé—´å°†ä¼šè¢«é‡Šæ”¾ã€‚å®Œæˆå¤åˆ¶åï¼ŒFromç©ºé—´å’ŒToç©ºé—´çš„è§’è‰²å‘ç”Ÿå¯¹æ¢(**å³ä»¥å‰çš„Fromç©ºé—´é‡Šæ”¾åå˜ä¸ºTo;Toç©ºé—´åœ¨å¤åˆ¶å­˜æ´»çš„å¯¹è±¡å,å˜ä¸ºFromç©ºé—´**)ã€‚ç®€è€Œè¨€ä¹‹ï¼Œåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œå°±æ˜¯é€šè¿‡å°†å­˜æ´»å¯¹è±¡åœ¨ä¸¤ä¸ªsemispaceç©ºé—´ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚

**Scavengeçš„ç¼ºç‚¹:**
 **åªèƒ½ä½¿ç”¨å †å†…å­˜ä¸­çš„ä¸€åŠ**ï¼Œè¿™æ˜¯ç”±åˆ’åˆ†ç©ºé—´å’Œå¤åˆ¶æœºåˆ¶æ‰€å†³å®šçš„ã€‚

**Scavengeçš„ä¼˜ç‚¹:**
 Scavengeç”±äºåªå¤åˆ¶å­˜æ´»çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹äºç”Ÿå‘½å‘¨æœŸçŸ­çš„åœºæ™¯å­˜æ´»å¯¹è±¡åªå å°‘éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒ**åœ¨æ—¶é—´æ•ˆç‡ä¸Šæœ‰ä¼˜å¼‚çš„è¡¨ç°ã€‚** **Scavengeæ˜¯å…¸å‹çš„ç‰ºç‰²ç©ºé—´æ¢å–æ—¶é—´çš„ç®—æ³•ï¼Œ** æ‰€ä»¥æ— æ³•å¤§è§„æ¨¡åœ°åº”ç”¨åˆ°æ‰€æœ‰çš„åƒåœ¾å›æ”¶ä¸­ã€‚ä½†å¯ä»¥å‘ç°ï¼ŒScavengeéå¸¸é€‚åˆåº”ç”¨åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå› ä¸ºæ–°ç”Ÿä»£ä¸­å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­ï¼Œæ°æ°é€‚åˆè¿™ä¸ªç®—æ³•ã€‚

**æ™‹å‡:**	
 å®é™…ä½¿ç”¨çš„å †å†…å­˜æ˜¯æ–°ç”Ÿä»£çš„ä¸¤ä¸ªsemispaceç©ºé—´å¤§å°å’Œè€ç”Ÿä»£æ‰€ç”¨å†…å­˜å¤§å°ä¹‹å’Œã€‚å½“ä¸€ä¸ªå¯¹è±¡ç»è¿‡å¤šæ¬¡å¤åˆ¶ä¾ç„¶å­˜æ´»æ—¶ï¼Œå®ƒå°†ä¼šè¢«è®¤ä¸ºæ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚è¿™ç§è¾ƒé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡éšåä¼šè¢«ç§»åŠ¨åˆ°è€ç”Ÿä»£ä¸­ï¼Œé‡‡ç”¨æ–°çš„ç®—æ³•è¿›è¡Œç®¡ç†ã€‚**å¯¹è±¡ä»æ–°ç”Ÿä»£ä¸­ç§»åŠ¨åˆ°è€ç”Ÿä»£ä¸­çš„è¿‡ç¨‹ç§°ä¸ºæ™‹å‡ã€‚**

åœ¨å•çº¯çš„Scavengeè¿‡ç¨‹ä¸­ï¼ŒFromç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´ä¸­å»ï¼Œç„¶åå¯¹Fromç©ºé—´å’ŒToç©ºé—´è¿›è¡Œè§’è‰²å¯¹æ¢ï¼ˆåˆç§°ç¿»è½¬ï¼‰ã€‚ä½†åœ¨åˆ†ä»£å¼åƒåœ¾å›æ”¶å‰æä¸‹ï¼Œ**Fromç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡åœ¨å¤åˆ¶åˆ°Toç©ºé—´ä¹‹å‰éœ€è¦è¿›è¡Œæ£€æŸ¥ã€‚åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œéœ€è¦å°†å­˜æ´»å‘¨æœŸé•¿çš„å¯¹è±¡ç§»åŠ¨åˆ°è€ç”Ÿä»£ä¸­ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå¯¹è±¡æ™‹å‡ã€‚**

**æ™‹å‡æ¡ä»¶:**
 å¯¹è±¡æ™‹å‡çš„æ¡ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡æ˜¯å¦ç»å†è¿‡Scavengeå›æ”¶ï¼Œä¸€ä¸ªæ˜¯Toç©ºé—´çš„å†…å­˜å ç”¨æ¯”è¶…è¿‡25%é™åˆ¶ã€‚

**è®¾ç½®25%è¿™ä¸ªé™åˆ¶å€¼çš„åŸå› :**
 å½“è¿™æ¬¡Scavengeå›æ”¶å®Œæˆåï¼Œè¿™ä¸ªToç©ºé—´å°†å˜æˆFromç©ºé—´ï¼Œæ¥ä¸‹æ¥çš„å†…å­˜åˆ†é…å°†åœ¨è¿™ä¸ªç©ºé—´ä¸­è¿›è¡Œã€‚**å¦‚æœå æ¯”è¿‡é«˜ï¼Œä¼šå½±å“åç»­çš„å†…å­˜åˆ†é…ã€‚** å¯¹è±¡æ™‹å‡åï¼Œå°†ä¼šåœ¨è€ç”Ÿä»£ç©ºé—´ä¸­ä½œä¸ºå­˜æ´»å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡æ¥å¯¹å¾…ï¼Œæ¥å—æ–°çš„å›æ”¶ç®—æ³•å¤„ç†ã€‚

![V8 åƒåœ¾å›æ”¶æ–°ç”Ÿä»£ç®—æ³•](https://user-gold-cdn.xitu.io/2019/2/19/16904ebc54c74a12?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

#### V8è€ç”Ÿä»£ç®—æ³•ï¼ˆMark-Sweep && Mark-Compactï¼‰:

> å¯¹äºè€ç”Ÿä»£ä¸­çš„å¯¹è±¡ï¼Œç”±äºå­˜æ´»å¯¹è±¡å è¾ƒå¤§æ¯”é‡ï¼Œå†é‡‡ç”¨Scavengeçš„æ–¹å¼ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä¸€ä¸ªæ˜¯å­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå¤åˆ¶å­˜æ´»å¯¹è±¡çš„æ•ˆç‡å°†ä¼šå¾ˆä½ï¼›å¦ä¸€ä¸ªé—®é¢˜ä¾ç„¶æ˜¯æµªè´¹ä¸€åŠç©ºé—´çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼ŒV8åœ¨è€ç”Ÿä»£ä¸­ä¸»è¦é‡‡ç”¨Mark-Sweepå’ŒMark-Compactç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚

**Mark-Sweep:**
 Mark-Sweepæ˜¯æ ‡è®°æ¸…é™¤çš„æ„æ€ï¼Œå®ƒåˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µã€‚ä¸Scavengeç›¸æ¯”ï¼ŒMark-Sweepå¹¶ä¸å°†å†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºä¸¤åŠï¼Œæ‰€ä»¥**ä¸å­˜åœ¨æµªè´¹ä¸€åŠç©ºé—´çš„è¡Œä¸º**ã€‚ä¸Scavengeå¤åˆ¶æ´»ç€çš„å¯¹è±¡ä¸åŒï¼Œ**Mark-Sweepåœ¨æ ‡è®°é˜¶æ®µéå†å †ä¸­æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µä¸­ï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚** å¯ä»¥çœ‹å‡ºï¼Œ**Scavengeä¸­åªå¤åˆ¶æ´»ç€çš„å¯¹è±¡ï¼Œè€ŒMark-Sweepåªæ¸…ç†æ­»äº¡å¯¹è±¡ã€‚** æ´»å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åªå è¾ƒå°éƒ¨åˆ†ï¼Œæ­»å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­åªå è¾ƒå°éƒ¨åˆ†ï¼Œè¿™æ˜¯ä¸¤ç§å›æ”¶æ–¹å¼èƒ½é«˜æ•ˆå¤„ç†çš„åŸå› ã€‚

ä¸‹å›¾ä¸ºMark-Sweepåœ¨è€ç”Ÿä»£ç©ºé—´ä¸­æ ‡è®°çš„ç¤ºæ„å›¾ï¼Œé»‘è‰²éƒ¨åˆ†æ ‡è®°ä¸ºæ­»äº¡å¯¹è±¡

![è€ç”Ÿä»£](https://user-gold-cdn.xitu.io/2019/2/19/16904ed3e993dca1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

**Mark-Sweepæœ€å¤§çš„é—®é¢˜:**
 åœ¨è¿›è¡Œä¸€æ¬¡æ ‡è®°æ¸…é™¤å›æ”¶åï¼Œå†…å­˜ç©ºé—´ä¼šå‡ºç°ä¸è¿ç»­çš„çŠ¶æ€ã€‚è¿™ç§å†…å­˜ç¢ç‰‡ä¼šå¯¹åç»­çš„å†…å­˜åˆ†é…é€ æˆé—®é¢˜ï¼Œå› ä¸ºå¾ˆå¯èƒ½å‡ºç°**éœ€è¦åˆ†é…ä¸€ä¸ªå¤§å¯¹è±¡çš„æƒ…å†µï¼Œè¿™æ—¶æ‰€æœ‰çš„ç¢ç‰‡ç©ºé—´éƒ½æ— æ³•å®Œæˆæ­¤æ¬¡åˆ†é…ï¼Œå°±ä¼šæå‰è§¦å‘åƒåœ¾å›æ”¶ï¼Œè€Œè¿™æ¬¡å›æ”¶æ˜¯ä¸å¿…è¦çš„ã€‚(æ³¨æ„ç†è§£è¿™å¥è¯,ä¸è¦æŠŠå†…å­˜æƒ³è±¡æˆæ¶²ä½“.è€Œæ˜¯å›ºä½“,å°±åƒä¸€ä¸ªä¸ªæ•£ä¹±æ’åˆ—çš„éº»å°†,éœ€è¦è¿›è¡Œæ’åºå¤„ç†--å³åé¢è¦è®²çš„ Mark-Compact)**

**Mark-Compact:**
 ä¸ºäº†è§£å†³Mark-Sweepçš„å†…å­˜ç¢ç‰‡é—®é¢˜ï¼ŒMark-Compactè¢«æå‡ºæ¥ã€‚Mark-Compactæ˜¯æ ‡è®°æ•´ç†çš„æ„æ€ï¼Œæ˜¯åœ¨Mark-Sweepçš„åŸºç¡€ä¸Šæ¼”å˜è€Œæ¥çš„ã€‚å®ƒä»¬çš„å·®åˆ«åœ¨äºå¯¹è±¡åœ¨æ ‡è®°ä¸ºæ­»äº¡åï¼Œ**åœ¨æ•´ç†çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ´»ç€çš„å¯¹è±¡å¾€ä¸€ç«¯ç§»åŠ¨ï¼Œç§»åŠ¨å®Œæˆåï¼Œç›´æ¥æ¸…ç†æ‰è¾¹ç•Œå¤–çš„å†…å­˜ã€‚** ä¸‹å›¾ä¸ºMark-Compactå®Œæˆæ ‡è®°å¹¶ç§»åŠ¨å­˜æ´»å¯¹è±¡åçš„ç¤ºæ„å›¾ï¼Œç™½è‰²æ ¼å­ä¸ºå­˜æ´»å¯¹è±¡ï¼Œæ·±è‰²æ ¼å­ä¸ºæ­»äº¡å¯¹è±¡ï¼Œæµ…è‰²æ ¼å­ä¸ºå­˜æ´»å¯¹è±¡ç§»åŠ¨åç•™ä¸‹çš„ç©ºæ´ã€‚

![è€ç”Ÿä»£å¯¹è±¡æ¸…é™¤å’Œæ•´ç†](https://user-gold-cdn.xitu.io/2019/2/19/16904ed8d55fb20a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

**å®Œæˆç§»åŠ¨åï¼Œå°±å¯ä»¥ç›´æ¥æ¸…é™¤æœ€å³è¾¹çš„å­˜æ´»å¯¹è±¡åé¢çš„å†…å­˜åŒºåŸŸå®Œæˆå›æ”¶ã€‚**

**Mark-Sweepã€Mark-Compactã€Scavengeä¸‰ç§ä¸»è¦åƒåœ¾å›æ”¶ç®—æ³•çš„ç®€å•å¯¹æ¯”**

| å›æ”¶ç®—æ³•     | Mark-Sweep   | Mark-Compact | Scavenge           |
| ------------ | ------------ | ------------ | ------------------ |
| é€Ÿåº¦         | ä¸­ç­‰         | æœ€æ…¢         | æœ€å¿«               |
| ç©ºé—´å¼€é”€     | å°‘ï¼ˆæœ‰ç¢ç‰‡ï¼‰ | å°‘ï¼ˆæ— ç¢ç‰‡ï¼‰ | åŒå€ç©ºé—´ï¼ˆæ— ç¢ç‰‡ï¼‰ |
| æ˜¯å¦ç§»åŠ¨å¯¹è±¡ | å¦           | æ˜¯           | æ˜¯                 |

ä»è¡¨æ ¼ä¸Šçœ‹ï¼ŒMark-Sweepå’ŒMark-Compactä¹‹é—´ï¼Œç”±äºMark-Compactéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œé€Ÿåº¦ä¸å¯èƒ½å¾ˆå¿«ï¼Œæ‰€ä»¥åœ¨å–èˆä¸Šï¼ŒV8ä¸»è¦ä½¿ç”¨Mark-Sweepï¼Œ**åœ¨ç©ºé—´ä¸è¶³ä»¥å¯¹ä»æ–°ç”Ÿä»£ä¸­æ™‹å‡è¿‡æ¥çš„å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶æ‰ä½¿ç”¨Mark-Compactã€‚**

#### å¢é‡å¼æ ‡è®°å›æ”¶(Incremental Marking):

ä¸ºäº†é¿å…å‡ºç°jsåº”ç”¨é€»è¾‘ä¸åƒåœ¾å›æ”¶å™¨çœ‹åˆ°çš„ä¸ä¸€è‡´çš„æƒ…å†µï¼Œ**åƒåœ¾å›æ”¶çš„3ç§åŸºæœ¬ç®—æ³•éƒ½éœ€è¦å°†åº”ç”¨é€»è¾‘æš‚åœä¸‹æ¥**ï¼Œå¾…æ‰§è¡Œå®Œåƒåœ¾å›æ”¶åå†æ¢å¤æ‰§è¡Œåº”ç”¨é€»è¾‘ï¼Œè¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºâ€œå…¨åœé¡¿â€ï¼ˆstop-the-worldï¼‰ã€‚åœ¨V8çš„åˆ†ä»£å¼åƒåœ¾å›æ”¶ä¸­ï¼Œä¸€æ¬¡å°åƒåœ¾å›æ”¶åªæ”¶é›†æ–°ç”Ÿä»£ï¼Œç”±äºæ–°ç”Ÿä»£é»˜è®¤é…ç½®å¾—è¾ƒå°ï¼Œä¸”å…¶ä¸­å­˜æ´»å¯¹è±¡é€šå¸¸è¾ƒå°‘ï¼Œæ‰€ä»¥å³ä¾¿å®ƒæ˜¯å…¨åœé¡¿çš„å½±å“ä¹Ÿä¸å¤§ã€‚ä½†V8çš„è€ç”Ÿä»£é€šå¸¸é…ç½®å¾—è¾ƒå¤§ï¼Œä¸”å­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå…¨å †åƒåœ¾å›æ”¶ï¼ˆfullåƒåœ¾å›æ”¶ï¼‰çš„æ ‡è®°ã€æ¸…ç†ã€æ•´ç†ç­‰åŠ¨ä½œé€ æˆçš„åœé¡¿å°±ä¼šæ¯”è¾ƒå¯æ€•ï¼Œéœ€è¦è®¾æ³•æ”¹å–„(PS: è‹¥V8çš„å †å†…å­˜ä¸º1.5GBï¼ŒV8åšä¸€æ¬¡å°çš„åƒåœ¾å›æ”¶éœ€è¦50msä»¥ä¸Šï¼Œåšä¸€æ¬¡éå¢é‡å¼çš„åƒåœ¾å›æ”¶ç”šè‡³è¦1ç§’ä»¥ä¸Šã€‚)ã€‚

ä¸ºäº†é™ä½å…¨å †åƒåœ¾å›æ”¶å¸¦æ¥çš„åœé¡¿æ—¶é—´ï¼ŒV8å…ˆä»æ ‡è®°é˜¶æ®µå…¥æ‰‹ï¼Œå°†åŸæœ¬è¦ä¸€å£æ°”åœé¡¿å®Œæˆçš„åŠ¨ä½œæ”¹ä¸ºå¢é‡æ ‡è®°ï¼ˆincremental markingï¼‰ï¼Œä¹Ÿå°±æ˜¯**æ‹†åˆ†ä¸ºè®¸å¤šå°â€œæ­¥è¿›â€ï¼Œæ¯åšå®Œä¸€â€œæ­¥è¿›â€å°±è®©jsåº”ç”¨é€»è¾‘æ‰§è¡Œä¸€å°ä¼šï¼Œåƒåœ¾å›æ”¶ä¸åº”ç”¨é€»è¾‘äº¤æ›¿æ‰§è¡Œç›´åˆ°æ ‡è®°é˜¶æ®µå®Œæˆã€‚**

V8åœ¨ç»è¿‡å¢é‡æ ‡è®°çš„æ”¹è¿›åï¼Œåƒåœ¾å›æ”¶çš„æœ€å¤§åœé¡¿æ—¶é—´å¯ä»¥å‡å°‘åˆ°åŸæœ¬çš„1/6å·¦å³ã€‚

V8åç»­è¿˜å¼•å…¥äº†å»¶è¿Ÿæ¸…ç†ï¼ˆlazy sweepingï¼‰ä¸å¢é‡å¼æ•´ç†ï¼ˆincremental compactionï¼‰ï¼Œè®©æ¸…ç†ä¸æ•´ç†åŠ¨ä½œä¹Ÿå˜æˆå¢é‡å¼çš„ã€‚åŒæ—¶è¿˜è®¡åˆ’å¼•å…¥å¹¶è¡Œæ ‡è®°ä¸å¹¶è¡Œæ¸…ç†ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨å¤šæ ¸æ€§èƒ½é™ä½æ¯æ¬¡åœé¡¿çš„æ—¶é—´ã€‚

### å‡å°‘åƒåœ¾å’Œå›æ”¶å¯¹æ€§èƒ½çš„å½±å“:

ä¸»è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹:

- è®©åƒåœ¾å›æ”¶å°½é‡å°‘åœ°è¿›è¡Œï¼Œå°¤å…¶æ˜¯å…¨å †åƒåœ¾å›æ”¶ã€‚è¿™éƒ¨åˆ†æˆ‘ä»¬åŸºæœ¬ä¸Šå¸®ä¸äº†ä»€ä¹ˆå¿™,ä¸»è¦é v8è‡ªå·±çš„ä¼˜åŒ–æœºåˆ¶.
- é¿å…å†…å­˜æ³„éœ²,è®©å†…å­˜åŠæ—¶å¾—åˆ°é‡Šæ”¾. è¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„.å…·ä½“å¯ä»¥æŸ¥çœ‹,æœ¬ç³»åˆ—çš„å†…å­˜æ³„éœ²ç« èŠ‚,æœ‰è¶…è¯¦ç»†è®²è§£.

##ä¸‰ã€MVCå’ŒMVVMçš„åŒºåˆ«

MVCï¼ŒMVPå’ŒMVVMéƒ½æ˜¯å¸¸è§çš„è½¯ä»¶æ¶æ„è®¾è®¡æ¨¡å¼ï¼ˆArchitectural Patternï¼‰ï¼Œå®ƒé€šè¿‡åˆ†ç¦»å…³æ³¨ç‚¹æ¥æ”¹è¿›ä»£ç çš„ç»„ç»‡æ–¹å¼ã€‚ä¸åŒäºè®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼Œåªæ˜¯ä¸ºäº†è§£å†³ä¸€ç±»é—®é¢˜è€Œæ€»ç»“å‡ºçš„æŠ½è±¡æ–¹æ³•ï¼Œä¸€ç§æ¶æ„æ¨¡å¼å¾€å¾€ä½¿ç”¨äº†å¤šç§è®¾è®¡æ¨¡å¼ã€‚

è¦äº†è§£MVCã€MVPå’ŒMVVMï¼Œå°±è¦çŸ¥é“å®ƒä»¬çš„ç›¸åŒç‚¹å’Œä¸åŒç‚¹ã€‚ä¸åŒéƒ¨åˆ†æ˜¯C(Controller)ã€P(Presenter)ã€VM(View-Model)ï¼Œè€Œç›¸åŒçš„éƒ¨åˆ†åˆ™æ˜¯MV(Model-View)ã€‚

###MVCæ¨¡å¼

**MVCæ¨¡å¼ï¼ˆModelâ€“viewâ€“controllerï¼‰:**
 æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼ŒæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ï¼šæ¨¡å‹ï¼ˆModelï¼‰ã€è§†å›¾ï¼ˆViewï¼‰å’Œæ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚

- æ¨¡å‹ï¼ˆModelï¼‰ - Modelå±‚ç”¨äºå°è£…å’Œåº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„æ•°æ®ä»¥åŠå¯¹æ•°æ®çš„å¤„ç†æ–¹æ³•ã€‚ä¸€æ—¦æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ¨¡å‹å°†é€šçŸ¥æœ‰å…³çš„è§†å›¾ã€‚
- è§†å›¾ï¼ˆViewï¼‰ - Viewä½œä¸ºè§†å›¾å±‚ï¼Œä¸»è¦è´Ÿè´£æ•°æ®çš„å±•ç¤º,å¹¶ä¸”å“åº”ç”¨æˆ·æ“ä½œ.
- æ§åˆ¶å™¨ï¼ˆControllerï¼‰- æ§åˆ¶å™¨æ˜¯æ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„çº½å¸¦ï¼Œæ¥æ”¶Viewä¼ æ¥çš„ç”¨æˆ·äº‹ä»¶å¹¶ä¸”ä¼ é€’ç»™Modelï¼ŒåŒæ—¶åˆ©ç”¨ä»Modelä¼ æ¥çš„æœ€æ–°æ¨¡å‹æ§åˆ¶æ›´æ–°View.



![img](https://user-gold-cdn.xitu.io/2019/2/21/169102cbc41f9719?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

####**æ•°æ®å…³ç³»:**

- View æ¥å—ç”¨æˆ·äº¤äº’è¯·æ±‚
- View å°†è¯·æ±‚è½¬äº¤ç»™Controller
- Controller æ“ä½œModelè¿›è¡Œæ•°æ®æ›´æ–°
- æ•°æ®æ›´æ–°ä¹‹åï¼ŒModelé€šçŸ¥Viewæ›´æ–°æ•°æ®å˜åŒ–.**PS:** è¿˜æœ‰ä¸€ç§æ˜¯Viewä½œä¸ºObserverç›‘å¬Modelä¸­çš„ä»»æ„æ›´æ–°ï¼Œä¸€æ—¦æœ‰æ›´æ–°äº‹ä»¶å‘å‡ºï¼ŒViewä¼šè‡ªåŠ¨è§¦å‘æ›´æ–°ä»¥å±•ç¤ºæœ€æ–°çš„ModelçŠ¶æ€.è¿™ç§æ–¹å¼æå‡äº†æ•´ä½“æ•ˆç‡ï¼Œç®€åŒ–äº†Controllerçš„åŠŸèƒ½ï¼Œä¸è¿‡ä¹Ÿå¯¼è‡´äº†Viewä¸Modelä¹‹é—´çš„ç´§è€¦åˆã€‚
- View æ›´æ–°å˜åŒ–æ•°æ®

**æ–¹å¼:**

æ‰€æœ‰æ–¹å¼éƒ½æ˜¯å•å‘é€šä¿¡

####**ç»“æ„å®ç°:**

- View ï¼šä½¿ç”¨ ç»„åˆ(Composite)æ¨¡å¼
- Viewå’ŒControllerï¼šä½¿ç”¨ ç­–ç•¥(Strategy)æ¨¡å¼
- Modelå’Œ Viewï¼šä½¿ç”¨ è§‚å¯Ÿè€…(Observer)æ¨¡å¼åŒæ­¥ä¿¡æ¯

####**ç¼ºç‚¹:**

- **Viewå±‚è¿‡é‡:** Viewå¼ºä¾èµ–äºModelçš„,å¹¶ä¸”å¯ä»¥ç›´æ¥è®¿é—®Model.æ‰€ä»¥ä¸å¯é¿å…çš„Viewè¿˜è¦åŒ…æ‹¬ä¸€äº›ä¸šåŠ¡é€»è¾‘.å¯¼è‡´viewè¿‡é‡,åæœŸä¿®æ”¹æ¯”è¾ƒå›°éš¾,ä¸”å¤ç”¨ç¨‹åº¦ä½.
- **Viewå±‚ä¸Controllerå±‚ä¹Ÿæ˜¯è€¦åˆç´§å¯†:** Viewä¸Controllerè™½ç„¶çœ‹ä¼¼æ˜¯ç›¸äº’åˆ†ç¦»ï¼Œä½†å´æ˜¯è”ç³»ç´§å¯†.ç»å¸¸Viewå’ŒControllerä¸€ä¸€å¯¹åº”çš„ï¼Œæ†ç»‘èµ·æ¥ä½œä¸ºä¸€ä¸ªç»„ä»¶ä½¿ç”¨.è§£è€¦ç¨‹åº¦ä¸è¶³.

###MVVMæ¨¡å¼

MVVMæ˜¯Model-View-ViewModelçš„ç®€å†™ã€‚ç”±Microsoftæå‡ºï¼Œå¹¶ç»ç”±Martin Fowlerå¸ƒé“ä¼ æ’­ã€‚åœ¨ MVVM ä¸­ï¼Œä¸éœ€è¦Presenteræ‰‹åŠ¨åœ°åŒæ­¥Viewå’ŒModel.View æ˜¯é€šè¿‡æ•°æ®é©±åŠ¨çš„ï¼ŒModelä¸€æ—¦æ”¹å˜å°±ä¼šç›¸åº”çš„åˆ·æ–°å¯¹åº”çš„ Viewï¼ŒView å¦‚æœæ”¹å˜ï¼Œä¹Ÿä¼šæ”¹å˜å¯¹åº”çš„Modelã€‚è¿™ç§æ–¹å¼å°±å¯ä»¥åœ¨ä¸šåŠ¡å¤„ç†ä¸­åªå…³å¿ƒæ•°æ®çš„æµè½¬ï¼Œè€Œæ— éœ€ç›´æ¥å’Œé¡µé¢æ‰“äº¤é“ã€‚ViewModel åªå…³å¿ƒæ•°æ®å’Œä¸šåŠ¡çš„å¤„ç†ï¼Œä¸å…³å¿ƒ View å¦‚ä½•å¤„ç†æ•°æ®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒView å’Œ Model éƒ½å¯ä»¥ç‹¬ç«‹å‡ºæ¥ï¼Œä»»ä½•ä¸€æ–¹æ”¹å˜äº†ä¹Ÿä¸ä¸€å®šéœ€è¦æ”¹å˜å¦ä¸€æ–¹ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¸€äº›å¯å¤ç”¨çš„é€»è¾‘æ”¾åœ¨ä¸€ä¸ª ViewModel ä¸­ï¼Œè®©å¤šä¸ª View å¤ç”¨è¿™ä¸ª ViewModelã€‚

- Model - Modelå±‚ä»…ä»…å…³æ³¨æ•°æ®æœ¬èº«ï¼Œä¸å…³å¿ƒä»»ä½•è¡Œä¸ºï¼ˆæ ¼å¼åŒ–æ•°æ®ç”±Viewè´Ÿè´£ï¼‰ï¼Œè¿™é‡Œå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªç±»ä¼¼jsonçš„æ•°æ®å¯¹è±¡ã€‚
- View - MVVMä¸­çš„Viewé€šè¿‡ä½¿ç”¨æ¨¡æ¿è¯­æ³•æ¥å£°æ˜å¼çš„å°†æ•°æ®æ¸²æŸ“è¿›DOMï¼Œå½“ViewModelå¯¹Modelè¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ•°æ®ç»‘å®šæ›´æ–°åˆ°Viewã€‚
- ViewModel - ç±»ä¼¼ä¸Presenter. ViewModelä¼šå¯¹View å±‚çš„å£°æ˜è¿›è¡Œå¤„ç†.å½“ ViewModel ä¸­æ•°æ®å˜åŒ–ï¼ŒView å±‚ä¼šè¿›è¡Œæ›´æ–°;å¦‚æœæ˜¯åŒå‘ç»‘å®š,ä¸€æ—¦Viewå¯¹ç»‘å®šçš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œåˆ™ViewModel ä¸­çš„æ•°æ®ä¹Ÿä¼šè¿›è¡Œè‡ªåŠ¨æ›´æ–°.



![img](https://user-gold-cdn.xitu.io/2019/2/21/169102df8742a9cf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

####**æ•°æ®å…³ç³»:**

- View æ¥æ”¶ç”¨æˆ·äº¤äº’è¯·æ±‚
- View å°†è¯·æ±‚è½¬äº¤ç»™ViewModel
- ViewModel æ“ä½œModelæ•°æ®æ›´æ–°
- Model æ›´æ–°å®Œæ•°æ®ï¼Œé€šçŸ¥ViewModelæ•°æ®å‘ç”Ÿå˜åŒ–
- ViewModel æ›´æ–°Viewæ•°æ®

**æ–¹å¼:**

åŒå‘ç»‘å®šã€‚View/Modelçš„å˜åŠ¨ï¼Œè‡ªåŠ¨åæ˜ åœ¨ ViewModelï¼Œåä¹‹äº¦ç„¶ã€‚

####**å®ç°æ•°æ®ç»‘å®šçš„æ–¹å¼ï¼š**

- æ•°æ®åŠ«æŒ (Vue)
- å‘å¸ƒ-è®¢é˜…æ¨¡å¼ (Knockoutã€Backbone)
- è„å€¼æ£€æŸ¥ (æ—§ç‰ˆAngular)

**ä½¿ç”¨:**

- å¯ä»¥å…¼å®¹ä½ å½“ä¸‹ä½¿ç”¨çš„ MVC/MVP æ¡†æ¶ã€‚
- å¢åŠ ä½ çš„åº”ç”¨çš„å¯æµ‹è¯•æ€§ã€‚
- é…åˆä¸€ä¸ªç»‘å®šæœºåˆ¶æ•ˆæœæœ€å¥½ã€‚

####**MVVMä¼˜ç‚¹:**

MVVMæ¨¡å¼å’ŒMVCæ¨¡å¼ä¸€æ ·ï¼Œä¸»è¦ç›®çš„æ˜¯åˆ†ç¦»è§†å›¾ï¼ˆViewï¼‰å’Œæ¨¡å‹ï¼ˆModelï¼‰ï¼Œæœ‰å‡ å¤§ä¼˜ç‚¹:

- 1,ä½è€¦åˆã€‚Viewå¯ä»¥ç‹¬ç«‹äºModelå˜åŒ–å’Œä¿®æ”¹ï¼Œä¸€ä¸ªViewModelå¯ä»¥ç»‘å®šåˆ°ä¸åŒçš„â€Viewâ€ä¸Šï¼Œå½“Viewå˜åŒ–çš„æ—¶å€™Modelå¯ä»¥ä¸å˜ï¼Œå½“Modelå˜åŒ–çš„æ—¶å€™Viewä¹Ÿå¯ä»¥ä¸å˜ã€‚
- 2,å¯é‡ç”¨æ€§ã€‚ä½ å¯ä»¥æŠŠä¸€äº›è§†å›¾é€»è¾‘æ”¾åœ¨ä¸€ä¸ªViewModelé‡Œé¢ï¼Œè®©å¾ˆå¤šviewé‡ç”¨è¿™æ®µè§†å›¾é€»è¾‘ã€‚
- 3, ç‹¬ç«‹å¼€å‘ã€‚å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„å¼€å‘ï¼ˆViewModelï¼‰ï¼Œè®¾è®¡äººå‘˜å¯ä»¥ä¸“æ³¨äºé¡µé¢è®¾è®¡ï¼Œç”Ÿæˆxmlä»£ç ã€‚
- 4, å¯æµ‹è¯•ã€‚ç•Œé¢ç´ æ¥æ˜¯æ¯”è¾ƒéš¾äºæµ‹è¯•çš„ï¼Œè€Œç°åœ¨æµ‹è¯•å¯ä»¥é’ˆå¯¹ViewModelæ¥å†™ã€‚

####**MVVMç¼ºç‚¹:**

- ç±»ä¼šå¢å¤šï¼ŒViewModelä¼šè¶ŠåŠ åºå¤§ï¼Œè°ƒç”¨çš„å¤æ‚åº¦å¢åŠ ã€‚

## å››ã€thisçš„ç”¨æ³•

å…³äºthisæ˜¯é¢è¯•å’Œæ—¥å¸¸å¼€å‘ä¸­éå¸¸å¸¸è§çš„æ¦‚å¿µä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€æ˜“å¼„æ··çš„æ¦‚å¿µä¹‹ä¸€ï¼Œthisè¿™ä¸ªåç§°æœ¬èº«æœ‰æ—¶ä¹Ÿå®¹æ˜“è®©äººè¿·æƒ‘ã€‚è‡ªå·±ä¹‹å‰é¢è¯•æ—¶åœ¨thisä¸Šä¹Ÿæ˜¯æ ½è¿‡å‡ æ¬¡è·Ÿå¤´ï¼Œç‰¹åœ°æ¢³ç†ä¸€ä¸‹ï¼Œç›®çš„æ˜¯å½»åº•åƒé€ï¼Œä»¥ç»åæ‚£ã€‚

###å¸¸è§é”™è¯¯ç†è§£

1. **thisæ˜¯æŒ‡å‘è‡ªèº«å—ï¼Ÿ**

   ç‰¹åˆ«æ˜¯åœ¨å‡½æ•°ä¸­ä½¿ç”¨thisçš„æ—¶å€™ï¼Œthisæ˜¯æŒ‡çš„æ‰€åœ¨çš„è¿™ä¸ªå‡½æ•°å¯¹è±¡å—ï¼Ÿçœ‹ä¸‹é¢ç¤ºä¾‹ï¼š

   ```javascript
    function test() {
    	console.log(this.name);
    }
    test.name='aaaa';
    test();
   ```
   

åœ¨ä¸Šé¢è¿™ä¸ªç¤ºä¾‹é‡Œå¦‚æœthisæ˜¯æŒ‡å‘å½“å‰å‡½æ•°çš„è¯ï¼Œæ‰§è¡Œteståæ˜¯ä¸æ˜¯åº”è¯¥è¾“å‡º'aaaa'ï¼Œä½†å®é™…ä¸Šè¾“å‡ºçš„æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºæ­¤æ—¶thisæŒ‡å‘çš„æ˜¯windowï¼ˆåœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œï¼‰ï¼Œæ‰€ä»¥thiså¹¶ä¸æ˜¯æ¥æŒ‡å‘è‡ªèº«çš„ã€‚ï¼ˆè¾“å‡ºçš„å…·ä½“åŸå› ä¸‹é¢å†åˆ†æï¼‰

2. **thisæŒ‡å‘å‡½æ•°çš„ä½œç”¨åŸŸå—**

   è¿™ä¸ªæˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡ä»£ç æ¥éªŒè¯ä¸‹ï¼Œå¦‚ä¸‹ï¼š

   ```javascript
    function test() {
    	var name = 'bbbbb'
    	console.log(this.name);
    }
    test();
   ```
   

æ‰§è¡Œåå‘ç°è¾“å‡ºçš„ä»ç„¶æ˜¯ç©ºå­—ç¬¦ä¸²ï¼ŒåŸå› å’Œä¸Šé¢ä¸€æ ·ï¼Œthisæ²¡æœ‰æŒ‡å‘å½“å‰å‡½æ•°çš„ä½œç”¨åŸŸã€‚ä½†thisä¸€å®šä¼šä¸æŒ‡å‘å½“å‰å‡½æ•°ä½œç”¨åŸŸå—ï¼Ÿä¹Ÿä¸ä¸€å®šï¼Œåªéœ€çŸ¥é“ä¸èƒ½æ ¹æ®æ‰€åœ¨å‡½æ•°ä½œç”¨åŸŸæ¥ç¡®å®šthisçš„æŒ‡å‘å°±å¯¹äº†ï¼Œåº”è¯¥æ˜¯ç¡®å®šthisçš„æŒ‡å‘ï¼Œå†ç¡®å®šæ˜¯ä¸æ˜¯å½“å‰å‡½æ•°çš„ä½œç”¨åŸŸã€‚

è§£å†³æ‰å¸¸è§çš„ç†è§£é”™è¯¯åï¼Œæˆ‘ä»¬çœ‹ä¸‹thiså…¶å®æ˜¯åœ¨è¿è¡Œæ—¶ï¼ˆå³è¢«è°ƒç”¨æ—¶ï¼‰è¿›è¡Œç»‘å®šçš„ï¼Œå¹¶ä¸æ˜¯åœ¨å£°æ˜æ—¶ç»‘å®šï¼Œå®ƒçš„ä¸Šä¸‹æ–‡å–å†³äºå‡½æ•°è°ƒç”¨æ—¶çš„å„ç§æ¡ä»¶ã€‚this çš„ç»‘å®šå’Œå‡½æ•°å£°æ˜çš„ä½ç½®æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªå–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚ç¡®å®šthisæŒ‡å‘çš„æ­¥éª¤åº”è¯¥æ˜¯â€œç¡®å®šè°ƒç”¨ä½ç½®->åº”ç”¨è§„åˆ™->ç¡®å®šthisæŒ‡å‘â€ã€‚

###å¯»æ‰¾è°ƒç”¨ä½ç½®

thisæ—¢ç„¶æ˜¯å‡½æ•°è°ƒç”¨æ˜¯æ‰ç»‘å®šçš„ï¼Œé‚£ä¹ˆéœ€è¦é¦–å…ˆéœ€è¦ç¡®å®šå‡½æ•°çš„è°ƒç”¨ä½ç½®ã€‚è¿™ä¸ªä¸€èˆ¬æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå…ˆç¡®è®¤è°ƒç”¨æ ˆï¼Œç„¶åå½“å‰è°ƒç”¨æ ˆçš„å‰ä¸€ä¸ªå°±æ˜¯è°ƒç”¨ä½ç½®äº†ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```javascript
function a() {
  // è°ƒç”¨æ ˆæ˜¯c->b->a, è°ƒç”¨ä½ç½®b
  console.log(a);
}

function b() {
  // è°ƒç”¨æ ˆæ˜¯c->b, è°ƒç”¨ä½ç½®c
  a()
}

function c() {
  // è°ƒç”¨æ ˆæ˜¯c, è°ƒç”¨ä½ç½®æ˜¯å…¨å±€ä½œç”¨åŸŸ
  b();
}
c(); // cçš„è°ƒç”¨ä½ç½®
```

###åº”ç”¨ç»‘å®šè§„åˆ™

ç¡®å®šè°ƒç”¨ä½ç½®åï¼Œéœ€è¦åº”thisçš„ç»‘å®šè§„åˆ™ï¼Œæœ‰å››ç§ç»‘å®šè§„åˆ™ï¼Œåˆ¤æ–­æ¡ä»¶å¦‚ä¸‹ï¼š

####é»˜è®¤ç»‘å®š

ä¸€èˆ¬å¯ä»¥ç†è§£ä¸ºæ— æ³•åº”ç”¨å…¶ä»–è§„åˆ™æ—¶çš„å…œåº•é»˜è®¤è§„åˆ™ï¼Œç‹¬ç«‹å‡½æ•°è°ƒç”¨æ—¶ä¸€èˆ¬é€‚ç”¨ã€‚

```javascript
function test(){
	console.log(this.a);
}
var a = 'aaa'; // æˆ–è€…window.a='aaa'
test(); // è¾“å‡ºaaa
```

ä¸Šé¢è¿™ç§æ–¹å¼ä¾¿æ˜¯é»˜è®¤ç»‘å®šï¼Œtest()ä¸åœ¨ä»»ä½•å¯¹è±¡å†…çš„ç‹¬ç«‹è°ƒç”¨ï¼Œé€‚ç”¨äºé»˜è®¤ç»‘å®šï¼Œ**é»˜è®¤ç»‘å®šthisæŒ‡å‘çš„å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨é‡Œé¢å°±æ˜¯windowï¼Œåœ¨nodeé‡Œé¢å°±æ˜¯globalï¼Œ psï¼šä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå…¨å±€å¯¹è±¡æ— æ³•ä½¿ç”¨é»˜è®¤ç»‘å®šï¼Œé»˜è®¤ç»‘å®šä¼šç»‘å®šåˆ°undefinedä¸Š**

####éšå¼ç»‘å®š

éšå¼ç»‘å®šå­˜åœ¨äºåœ¨è°ƒç”¨ä½ç½®æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡æˆ–è€…è¯´è°ƒç”¨æ—¶è¢«å¯¹è±¡åŒ…å«æˆ–æ‹¥æœ‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```javascript
const obj = {
	name: 'oooo',
	say: function(){
		console.log(this.name);
	}
}
obj.say();// oooo
```

çœ‹ä¸Šé¢å‡½æ•°sayçš„è°ƒç”¨ï¼Œä¸æ˜¯sayå•ç‹¬è°ƒç”¨ï¼Œè€Œæ˜¯è¢«å¯¹è±¡objåŒ…å«ç€è°ƒç”¨ï¼Œæ­¤æ—¶thisæ˜¯æŒ‡å‘objå¯¹è±¡çš„ã€‚

##### éšå¼ä¸¢å¤±

æœ‰ä¸€ç§æƒ…å†µæ˜¯çœ‹ä¼¼åº”è¯¥æ˜¯éšå¼ç»‘å®šï¼Œä½†å®é™…å´æ˜¯é»˜è®¤ç»‘å®šï¼Œæœ‰ä¸¤ä¸ªæ —å­å¦‚ä¸‹ï¼š

```javascript
æ —å­oneï¼š
var name = 'globallll';
var obj = {
	name: 'oooo',
	say: function(){
		console.log(this.name);
	}
}
var copy = obj.say;
copy();// globallll

æ —å­two:
var name = 'globallll';
var obj = {
	name: 'oooo',
	say: function(){
		console.log(this.name);
	}
}
function b(func){
	func();
}
b(obj.say);// globallll
```

çœ‹èµ·æ¥sayå‡½æ•°çš„ç¡®æ˜¯objå¯¹è±¡çš„ä¸€éƒ¨åˆ†å‘€ï¼Œä½†ä¸ºä»€ä¹ˆçœ‹èµ·æ¥thisæ˜¯æŒ‡å‘çš„windowå‘¢ï¼Ÿã€Šyou don't know JavaScriptã€‹é‡Œé¢æŠŠè¿™ç§ç‰¹æ®Šå¯¹å¾…ç§°ä¸ºæ˜¯éšå¼ä¸¢å¤±ï¼Œä½†æˆ‘ç†è§£æ˜¯è¿™ç§æƒ…å†µæ˜¯ä¸æ»¡è¶³éšå¼å‡½æ•°ç»‘å®šçš„ï¼Œå› ä¸ºéšå¼å‡½æ•°ç»‘å®šåº”å½“æ˜¯è°ƒç”¨æ˜¯è¢«å¯¹è±¡åŒ…å«ç€è°ƒç”¨ï¼Œè€Œä¸æ˜¯è¯´åªè¦æ˜¯å¯¹è±¡çš„å…¶ä¸­ä¸€éƒ¨åˆ†å°±å¯ä»¥äº†ï¼Œé‡ç‚¹åœ¨äºè°ƒç”¨æ—¶æ˜¯å¦è¢«å‡½æ•°åŒ…å«ç€ï¼

æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸Šè¿°çš„ä¸¤ä¸ªä¾‹å­ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŠŠobjé‡Œçš„å‡½æ•°sayçš„å¼•ç”¨èµ‹å€¼ç»™copyå˜é‡ï¼Œå†é€šè¿‡copyæ¥è°ƒç”¨ï¼Œcopyè°ƒç”¨æ—¶å¹¶æ²¡æœ‰è¢«objåŒ…å«ç€è°ƒç”¨ï¼Œè¿™å°±é€‚ç”¨é»˜è®¤ç»‘å®šè§„åˆ™--ç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤æ­¤æ—¶thisæ˜¯æŒ‡å‘windowçš„ã€‚ç¬¬äºŒä¸ªä¾‹å­åŒç†ï¼Œåªä¸è¿‡çœ‹èµ·æ¥æ˜¯è°ƒç”¨çš„obj.say(),ä½†å®é™…è¿‡ç¨‹æ˜¯ï¼š

```javascript
	func = obj.say;
	func();
```

å’Œç¬¬ä¸€ä¸ªä¸€æ ·éƒ½æœ‰ä¸€ä¸ªèµ‹å€¼çš„è¿‡ç¨‹ã€‚

####æ˜¾å¼ç»‘å®š

é¦–å…ˆä¸ºå•¥éœ€è¦æ˜¾ç¤ºç»‘å®šå‘¢ï¼Ÿå› ä¸ºä»¥ä¸Šä¸¤ä¸ªè§„åˆ™ä¼šå¯¼è‡´thisçš„æŒ‡å‘ä¸ç¨³å®šï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦å‡½æ•°ä¸­thisç¨³å®šæŒ‡å‘æŸä¸ªå¯¹è±¡çš„ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼š

```javascript
var obj = {
	name: 'ooooo',
	say: function(){
		console.log(this.name);
	}
}
var name = 'globalllll';
setTimeout(obj.say, 1000); // globalllll
```

è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å…¶å®æ˜¯æƒ³è®©thisæŒ‡å‘objç„¶åè¾“å‡ºâ€˜oooooâ€™çš„ï¼Œä½†å®é™…ä¸Šè°ƒç”¨çš„è¿‡ç¨‹ä¸­é¦–å…ˆè¿›è¡Œäº†èµ‹å€¼ç„¶åè¿›è¡Œäº†è°ƒç”¨ï¼Œå¯¼è‡´ä½¿ç”¨é»˜è®¤ç»‘å®šï¼ŒthisæŒ‡å‘äº†windowã€‚ä¸ºäº†èƒ½å›ºå®šthisçš„ç»‘å®šï¼Œæ‰æœ‰äº†æ˜¾ç¤ºç»‘å®šã€‚

æ˜¾ç¤ºç»‘å®šæœ‰ä¸‰ç§æ–¹å¼ï¼šapplyï¼Œcallå’Œbindã€‚è¿™ä¸‰ä¸ªå‡½æ•°å¤§å®¶åº”è¯¥ç”¨çš„æ¯”è¾ƒå¤šäº†ï¼Œå…¶ä¸­applyå’Œcallåªæœ‰ä¼ å‚çš„åŒºåˆ«ï¼Œè€Œapplyå’Œbindçš„åŒºåˆ«åœ¨äºapplyç»‘å®šåç«‹å³æ‰§è¡Œï¼Œè€Œbindå¯ä»¥è¿”å›ç»‘å®šåçš„å‡½æ•°ã€‚ä¸Šè¿°ä¾‹å­å¯ä»¥è¿™ä¹ˆè§£å†³ï¼š

```javascript
var obj = {
	name: 'ooooo',
	say: function(){
		console.log(this.name);
	}
}
var test = obj.say.bind(obj);//ç»‘å®šåthisæŒ‡å‘ä¸å¯ä¿®æ”¹
//æˆ–è€…
//var test = function (){
//	obj.say.call(obj);
//}
var name = 'globalllll';
setTimeout(test, 1000); // oooo
```

æ€è€ƒğŸ¤”ï¼šå¦‚ä½•ç”¨applyæˆ–è€…callå®ç°bindï¼Ÿ

è¿›é˜¶ï¼šå®ç°applyï¼Ÿ

####newç»‘å®š

newæ˜¯ä¸€ä¸ªç”±ç±»æ–°å»ºç¤ºä¾‹çš„è¿‡ç¨‹ã€‚ä½¿ç”¨newæ—¶ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œä½†æ˜¯è¿‡ç¨‹ä¸­å¹¶ä¸æ˜¯å®ä¾‹åŒ–äº†ä¸€äº›ç±»ï¼Œè€Œæ˜¯é€šè¿‡æ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åæ‰§è¡ŒåŸå‹çš„é“¾æ¥ï¼Œæ–°å¯¹è±¡ç»‘å®šå‡½æ•°è°ƒç”¨çš„thisï¼Œè¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„è¿™ä¸ªå¯¹è±¡æˆ‘ä»¬å°±ç§°ä¸ºä¸€ä¸ªå®ä¾‹ã€‚æ¯”å¦‚ï¼š function Person(name){ this.name = name; } var student = new Person('LiMing'); console.log(student.name) // LiMing

ä¸Šè¿°ä»£ç çš„è¿‡ç¨‹æ˜¯ï¼š

1. æ–°å»ºä¸€ä¸ªå¯¹è±¡
2. æ‰§è¡ŒåŸå‹çš„é“¾æ¥ï¼ˆä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼‰
3. å°†æ–°å»ºå¯¹è±¡ç»‘å®šåˆ°Personä¸­çš„thisä¸Šï¼Œä¹Ÿå°±æ˜¯ç›®å‰thisæŒ‡å‘æ–°å»ºå¯¹è±¡
4. è¿”å›è¿™ä¸ªæ–°å»ºå¯¹è±¡ç»™studentï¼Œå³studentç­‰äºæ–°å»ºå¯¹è±¡

è¿™ç§åœ¨newçš„è¿‡ç¨‹ä¸­ç»‘å®šthisçš„æ–¹å¼ç§°ä¸ºæ˜¯newç»‘å®šã€‚

###ä¼˜å…ˆçº§

ä¸Šé¢æˆ‘ä»¬äº†è§£å››ç§ç»‘å®šè§„åˆ™ï¼Œä½†é—®é¢˜æ˜¯å¦‚æœç¬¦åˆå…¶ä¸­ä¸€ç§ä»¥ä¸Šçš„æƒ…å½¢æ—¶åº”è¯¥å¦‚æœç¡®å®šæ˜¯å“ªç§å‘¢ï¼Ÿè¿™å°±è¦ç¡®å®šå››ç§è§„åˆ™çš„ä¼˜å…ˆçº§äº†ã€‚ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š new	ç»‘å®š>æ˜¾å¼ç»‘å®š>éšå¼ç»‘å®š>é»˜è®¤ç»‘å®šã€‚

###ç‰¹æ®Šæƒ…å†µ

å‡¡äº‹æœ‰ä¾‹å¤–ï¼Œthisä¹Ÿä¸€æ ·ã€‚ä¸‹é¢ä»‹ç»ä¸‹ç‰¹æ®Šæƒ…å†µã€‚

#### ç®­å¤´å‡½æ•°

es6ä¸­å¼•å…¥çš„ç®­å¤´å‡½æ•°è™½ç„¶ä¹Ÿå«å‡½æ•°ï¼Œä½†æ˜¯å´ä¸é€‚ç”¨äºä¸Šé¢çš„å››è§„åˆ™ã€‚å…ˆå¼•å…¥ä¸€ä¸ªğŸŒ°ï¼š

```javascript
function a(){
	return ()=>{
		console.log(this.name);
	}
}
const obj1={
	name: 11111,
}
const obj2={
	name: 22222,
}
var test = a.call(obj1);
test.call(obj2); // 11111
```

ä¸Šé¢ä¾‹å­ä¸­ç®­å¤´å‡½æ•°ç†è®ºä¸Šç»‘å®šçš„æ˜¯obj2ï¼Œä½†æ˜¯å®é™…è¾“å‡ºçš„å´æ˜¯11111ã€‚æ‰€ä»¥ç®­å¤´å‡½æ•°æ˜¯ä¸é€‚ç”¨äºä¸Šé¢çš„å››è§„åˆ™çš„ã€‚ç®­å¤´å‡½æ•°çš„å…·ä½“è§„åˆ™æ—¶ï¼šç®­å¤´å‡½æ•°thisæ˜¯åœ¨å£°æ˜æ—¶å°±ç¡®å®šäº†ï¼Œå…¶thiså°±æ˜¯å£°æ˜æ—¶æ‰€åœ¨ä½œç”¨åŸŸçš„thisç¡®å®šçš„ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œç®­å¤´å‡½æ•°æ˜¯åœ¨aå‡½æ•°ä¸­å£°æ˜çš„ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°ä¸­æ‰€ç”¨çš„thiså°±æ˜¯açš„thisï¼Œè€Œaä¸­çš„thisæ˜¯æ ¹æ®è°ƒç”¨ä½ç½®å’Œè§„åˆ™ç¡®å®šæ˜¯obj1ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°ä¸­thisä¹Ÿæ˜¯æŒ‡å‘obj1ã€‚



##äº”ã€Callï¼ŒApplyï¼ŒBindçš„ç”¨æ³•

###call å’Œ apply çš„å…±åŒç‚¹

å®ƒä»¬çš„å…±åŒç‚¹æ˜¯ï¼Œéƒ½èƒ½å¤Ÿ**æ”¹å˜å‡½æ•°æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡**ï¼Œå°†ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•äº¤ç»™å¦ä¸€ä¸ªå¯¹è±¡æ¥æ‰§è¡Œï¼Œå¹¶ä¸”æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚

ä¸ºä½•è¦æ”¹å˜æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„å°ä¾‹å­ï¼šå¹³æ—¶æ²¡æ—¶é—´åšé¥­çš„æˆ‘ï¼Œå‘¨æœ«æƒ³ç»™å­©å­ç‚–ä¸ªè…Œç¬ƒé²œå°å°ã€‚ä½†æ˜¯æ²¡æœ‰é€‚åˆçš„é”…ï¼Œè€Œæˆ‘åˆä¸æƒ³å‡ºå»ä¹°ã€‚æ‰€ä»¥å°±é—®é‚»å±…å€Ÿäº†ä¸€ä¸ªé”…æ¥ç”¨ï¼Œè¿™æ ·æ—¢è¾¾åˆ°äº†ç›®çš„ï¼ŒåˆèŠ‚çœäº†å¼€æ”¯ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚

æ”¹å˜æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ŒA å¯¹è±¡æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œ B å¯¹è±¡å› ä¸ºæŸç§åŸå› ï¼Œä¹Ÿéœ€è¦ç”¨åˆ°åŒæ ·çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬æ˜¯å•ç‹¬ä¸º B å¯¹è±¡æ‰©å±•ä¸€ä¸ªæ–¹æ³•å‘¢ï¼Œè¿˜æ˜¯å€Ÿç”¨ä¸€ä¸‹ A å¯¹è±¡çš„æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶æ˜¯å€Ÿç”¨ A å¯¹è±¡çš„å•¦ï¼Œæ—¢å®Œæˆäº†éœ€æ±‚ï¼Œåˆå‡å°‘äº†å†…å­˜çš„å ç”¨ã€‚

å¦å¤–ï¼Œå®ƒä»¬çš„å†™æ³•ä¹Ÿå¾ˆç±»ä¼¼ï¼Œ**è°ƒç”¨ call å’Œ apply çš„å¯¹è±¡ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•° Function**ã€‚æ¥ä¸‹æ¥ï¼Œå°±ä¼šè¯´åˆ°å…·ä½“çš„å†™æ³•ï¼Œé‚£ä¹Ÿæ˜¯å®ƒä»¬åŒºåˆ«çš„ä¸»è¦ä½“ç°ã€‚

###call å’Œ apply çš„åŒºåˆ«

å®ƒä»¬çš„åŒºåˆ«ï¼Œä¸»è¦ä½“ç°åœ¨å‚æ•°çš„å†™æ³•ä¸Šã€‚å…ˆæ¥çœ‹ä¸€ä¸‹å®ƒä»¬å„è‡ªçš„å…·ä½“å†™æ³•ã€‚

#### call çš„å†™æ³•

```javascript
Function.call(obj,[param1[,param2[,â€¦[,paramN]]]])
```

éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- è°ƒç”¨ call çš„å¯¹è±¡ï¼Œå¿…é¡»æ˜¯ä¸ªå‡½æ•° Functionã€‚
- call çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ Function çš„è°ƒç”¨è€…ï¼Œå°†ä¼šæŒ‡å‘è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœä¸ä¼ ï¼Œåˆ™é»˜è®¤ä¸ºå…¨å±€å¯¹è±¡ windowã€‚
- ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ï¼Œå¯ä»¥æ¥æ”¶ä»»æ„ä¸ªå‚æ•°ã€‚æ¯ä¸ªå‚æ•°ä¼šæ˜ å°„åˆ°ç›¸åº”ä½ç½®çš„ Function çš„å‚æ•°ä¸Šã€‚ä½†æ˜¯å¦‚æœå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºæ•°ç»„ä¼ å…¥ï¼Œå®ƒä»¬ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“æ˜ å°„åˆ° Function å¯¹åº”çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸Šï¼Œä¹‹åå‚æ•°éƒ½ä¸ºç©ºã€‚

```javascript
function func (a,b,c) {}

func.call(obj, 1,2,3)
// func æ¥æ”¶åˆ°çš„å‚æ•°å®é™…ä¸Šæ˜¯ 1,2,3

func.call(obj, [1,2,3])
// func æ¥æ”¶åˆ°çš„å‚æ•°å®é™…ä¸Šæ˜¯ [1,2,3],undefined,undefined
```

#### apply çš„å†™æ³•

```javascript
Function.apply(obj[,argArray])
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- å®ƒçš„è°ƒç”¨è€…å¿…é¡»æ˜¯å‡½æ•° Functionï¼Œå¹¶ä¸”åªæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„è§„åˆ™ä¸ call ä¸€è‡´ã€‚
- ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¿…é¡»æ˜¯æ•°ç»„æˆ–è€…ç±»æ•°ç»„ï¼Œå®ƒä»¬ä¼šè¢«è½¬æ¢æˆç±»æ•°ç»„ï¼Œä¼ å…¥ Function ä¸­ï¼Œå¹¶ä¸”ä¼šè¢«æ˜ å°„åˆ° Function å¯¹åº”çš„å‚æ•°ä¸Šã€‚è¿™ä¹Ÿæ˜¯ call å’Œ apply ä¹‹é—´ï¼Œå¾ˆé‡è¦çš„ä¸€ä¸ªåŒºåˆ«ã€‚

```javascript
func.apply(obj, [1,2,3])
// func æ¥æ”¶åˆ°çš„å‚æ•°å®é™…ä¸Šæ˜¯ 1,2,3

func.apply(obj, {
    0: 1,
    1: 2,
    2: 3,
    length: 3
})
// func æ¥æ”¶åˆ°çš„å‚æ•°å®é™…ä¸Šæ˜¯ 1,2,3
```

#### ä»€ä¹ˆæ˜¯ç±»æ•°ç»„ï¼Ÿ

å…ˆè¯´æ•°ç»„ï¼Œè¿™æˆ‘ä»¬éƒ½ç†Ÿæ‚‰ã€‚å®ƒçš„ç‰¹å¾æœ‰ï¼šå¯ä»¥é€šè¿‡è§’æ ‡è°ƒç”¨ï¼Œå¦‚ array[0]ï¼›å…·æœ‰é•¿åº¦å±æ€§lengthï¼›å¯ä»¥é€šè¿‡ for å¾ªç¯æˆ–forEachæ–¹æ³•ï¼Œè¿›è¡Œéå†ã€‚

é‚£ä¹ˆï¼Œç±»æ•°ç»„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯**å…·å¤‡ä¸æ•°ç»„ç‰¹å¾ç±»ä¼¼çš„å¯¹è±¡**ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„è¿™ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªç±»æ•°ç»„ã€‚

```javascript
let arrayLike = {
    0: 1,
    1: 2,
    2: 3,
    length: 3
};
```

ç±»æ•°ç»„ arrayLike å¯ä»¥é€šè¿‡è§’æ ‡è¿›è¡Œè°ƒç”¨ï¼Œå…·æœ‰lengthå±æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ for å¾ªç¯è¿›è¡Œéå†ã€‚

ç±»æ•°ç»„ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œåªæ˜¯æˆ‘ä»¬å¹³æ—¶å¯èƒ½æ²¡æ³¨æ„åˆ°ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è·å– DOM èŠ‚ç‚¹çš„æ–¹æ³•ï¼Œè¿”å›çš„å°±æ˜¯ä¸€ä¸ªç±»æ•°ç»„ã€‚å†æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨ arguments è·å–åˆ°çš„æ‰€æœ‰å‚æ•°ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç±»æ•°ç»„ã€‚

ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**ç±»æ•°ç»„æ— æ³•ä½¿ç”¨ forEachã€spliceã€push ç­‰æ•°ç»„åŸå‹é“¾ä¸Šçš„æ–¹æ³•**ï¼Œæ¯•ç«Ÿå®ƒä¸æ˜¯çœŸæ­£çš„æ•°ç»„ã€‚

###call å’Œ apply çš„ç”¨é€”

ä¸‹é¢ä¼šåˆ†åˆ«åˆ—ä¸¾ call å’Œ apply çš„ä¸€äº›ä½¿ç”¨åœºæ™¯ã€‚å£°æ˜ï¼šä¾‹å­ä¸­æ²¡æœ‰å“ªä¸ªåœºæ™¯æ˜¯å¿…é¡»ç”¨ call æˆ–è€…å¿…é¡»ç”¨ apply çš„ï¼Œåªæ˜¯ä¸ªäººä¹ æƒ¯è¿™ä¹ˆç”¨è€Œå·²ã€‚

#### call çš„ä½¿ç”¨åœºæ™¯

**1ã€å¯¹è±¡çš„ç»§æ‰¿**ã€‚å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```javascript
function superClass () {
    this.a = 1;
    this.print = function () {
        console.log(this.a);
    }
}

function subClass () {
    superClass.call(this);
    this.print();
}

subClass();
// 1
```

subClass é€šè¿‡ call æ–¹æ³•ï¼Œç»§æ‰¿äº† superClass çš„ print æ–¹æ³•å’Œ a å˜é‡ã€‚æ­¤å¤–ï¼ŒsubClass è¿˜å¯ä»¥æ‰©å±•è‡ªå·±çš„å…¶ä»–æ–¹æ³•ã€‚

**2ã€å€Ÿç”¨æ–¹æ³•**ã€‚è¿˜è®°å¾—åˆšæ‰çš„ç±»æ•°ç»„ä¹ˆï¼Ÿå¦‚æœå®ƒæƒ³ä½¿ç”¨ Array åŸå‹é“¾ä¸Šçš„æ–¹æ³•ï¼Œå¯ä»¥è¿™æ ·ï¼š

```javascript
let domNodes = Array.prototype.slice.call(document.getElementsByTagName("*"));
```

è¿™æ ·ï¼ŒdomNodes å°±å¯ä»¥åº”ç”¨ Array ä¸‹çš„æ‰€æœ‰æ–¹æ³•äº†ã€‚

#### apply çš„ä¸€äº›å¦™ç”¨

**1ã€Math.max**ã€‚ç”¨å®ƒæ¥è·å–æ•°ç»„ä¸­æœ€å¤§çš„ä¸€é¡¹ã€‚

```javascript
let max = Math.max.apply(null, array);
```

åŒç†ï¼Œè¦è·å–æ•°ç»„ä¸­æœ€å°çš„ä¸€é¡¹ï¼Œå¯ä»¥è¿™æ ·ï¼š

```
let min = Math.min.apply(null, array);
å¤åˆ¶ä»£ç 
```

**2ã€å®ç°ä¸¤ä¸ªæ•°ç»„åˆå¹¶**ã€‚åœ¨ ES6 çš„æ‰©å±•è¿ç®—ç¬¦å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Array.prototype.pushæ¥å®ç°ã€‚

```javascript
let arr1 = [1, 2, 3];
let arr2 = [4, 5, 6];

Array.prototype.push.apply(arr1, arr2);
console.log(arr1); // [1, 2, 3, 4, 5, 6]
```

###bind çš„ä½¿ç”¨

æœ€åæ¥è¯´è¯´ bindã€‚åœ¨ MDN ä¸Šçš„è§£é‡Šæ˜¯ï¼šbind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨è°ƒç”¨æ—¶è®¾ç½® this å…³é”®å­—ä¸ºæä¾›çš„å€¼ã€‚å¹¶åœ¨è°ƒç”¨æ–°å‡½æ•°æ—¶ï¼Œå°†ç»™å®šå‚æ•°åˆ—è¡¨ä½œä¸ºåŸå‡½æ•°çš„å‚æ•°åºåˆ—çš„å‰è‹¥å¹²é¡¹ã€‚

å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š

```
Function.bind(thisArg[, arg1[, arg2[, ...]]])
å¤åˆ¶ä»£ç 
```

bind æ–¹æ³• ä¸ apply å’Œ call æ¯”è¾ƒç±»ä¼¼ï¼Œä¹Ÿèƒ½æ”¹å˜å‡½æ•°ä½“å†…çš„ this æŒ‡å‘ã€‚ä¸åŒçš„æ˜¯ï¼Œ**bind æ–¹æ³•çš„è¿”å›å€¼æ˜¯å‡½æ•°ï¼Œå¹¶ä¸”éœ€è¦ç¨åè°ƒç”¨ï¼Œæ‰ä¼šæ‰§è¡Œ**ã€‚è€Œ apply å’Œ call åˆ™æ˜¯ç«‹å³è°ƒç”¨ã€‚

æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```javascript
function add (a, b) {
    return a + b;
}

function sub (a, b) {
    return a - b;
}

add.bind(sub, 5, 3); // è¿™æ—¶ï¼Œå¹¶ä¸ä¼šè¿”å› 8
add.bind(sub, 5, 3)(); // è°ƒç”¨åï¼Œè¿”å› 8
```

å¦‚æœ bind çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ null æˆ–è€… undefinedï¼Œthis å°±æŒ‡å‘å…¨å±€å¯¹è±¡ windowã€‚

###æ€»ç»“

call å’Œ apply çš„ä¸»è¦ä½œç”¨ï¼Œæ˜¯æ”¹å˜å¯¹è±¡çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚å®ƒä»¬åœ¨å‚æ•°ä¸Šçš„å†™æ³•ç•¥æœ‰åŒºåˆ«ã€‚

bind ä¹Ÿèƒ½æ”¹å˜å¯¹è±¡çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå®ƒä¸ call å’Œ apply ä¸åŒçš„æ˜¯ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”éœ€è¦ç¨åå†è°ƒç”¨ä¸€ä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œã€‚

æœ€åï¼Œåˆ†äº«ä¸€ä¸ªåœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°çš„ï¼Œå…³äº call å’Œ apply çš„ä¾¿æ·è®°å¿†æ³•ï¼š

> çŒ«åƒé±¼ï¼Œç‹—åƒè‚‰ï¼Œå¥¥ç‰¹æ›¼æ‰“å°æ€ªå…½ã€‚
>
> æœ‰å¤©ç‹—æƒ³åƒé±¼äº†
>
> çŒ«.åƒé±¼.call(ç‹—ï¼Œé±¼)
>
> ç‹—å°±åƒåˆ°é±¼äº†
>
> çŒ«æˆç²¾äº†ï¼Œæƒ³æ‰“æ€ªå…½
>
> å¥¥ç‰¹æ›¼.æ‰“å°æ€ªå…½.call(çŒ«ï¼Œå°æ€ªå…½)
>
> çŒ«ä¹Ÿå¯ä»¥æ‰“å°æ€ªå…½äº†

## å…­ã€ç®—æ³•

### åˆ¤æ–­ä¸€ä¸ªå•è¯æ˜¯å¦æ˜¯å›æ–‡

å›æ–‡æ˜¯æŒ‡æŠŠç›¸åŒçš„è¯æ±‡æˆ–å¥å­ï¼Œåœ¨ä¸‹æ–‡ä¸­è°ƒæ¢ä½ç½®æˆ–é¢ å€’è¿‡æ¥ï¼Œäº§ç”Ÿé¦–å°¾å›ç¯çš„æƒ…è¶£ï¼Œå«åšå›æ–‡ï¼Œä¹Ÿå«å›ç¯ã€‚æ¯”å¦‚ mamam redivider .

å¾ˆå¤šäººæ‹¿åˆ°è¿™æ ·çš„é¢˜ç›®éå¸¸å®¹æ˜“æƒ³åˆ°ç”¨for å°†å­—ç¬¦ä¸²é¢ å€’å­—æ¯é¡ºåºç„¶ååŒ¹é…å°±è¡Œäº†ã€‚å…¶å®é‡è¦çš„è€ƒå¯Ÿçš„å°±æ˜¯å¯¹äºreverseçš„å®ç°ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç°æˆçš„å‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ï¼Œè¿™ä¸ªæ€è·¯å¾ˆé‡è¦ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰æ›´å¤šçš„è‡ªç”±åº¦å»è¿›è¡Œå­—ç¬¦ä¸²çš„ä¸€äº›æ“ä½œã€‚

```javascript
function checkPalindrom(str) {  
    return str == str.split('').reverse().join('');
}
```

### å»æ‰ä¸€ç»„æ•´å‹æ•°ç»„é‡å¤çš„å€¼

æ¯”å¦‚ è¾“å…¥: [1,13,24,11,11,14,1,2]ï¼Œ  è¾“å‡º: [1,13,24,11,14,2] ï¼Œéœ€è¦å»æ‰é‡å¤çš„11 å’Œ 1 è¿™ä¸¤ä¸ªå…ƒç´ ã€‚

ä¸»è¦è€ƒå¯Ÿä¸ªäººå¯¹Objectçš„ä½¿ç”¨ï¼Œåˆ©ç”¨keyæ¥è¿›è¡Œç­›é€‰ã€‚

```javascript
**
* unique an array 
**/
let unique = function(arr) {  
  let hashTable = {};
  let data = [];
  for(let i=0,l=arr.length;i<l;i++) {
    if(!hashTable[arr[i]]) {
      hashTable[arr[i]] = true;
      data.push(arr[i]);
    }
  }
  return data

}

module.exports = unique;  
```

###å»æ‰éæ•´å‹æ•°ç»„é‡å¤çš„å€¼

å‡å¦‚æ•°ç»„å¹¶ä¸æ˜¯æ•´å‹æ•°ç»„è¯¥å¦‚ä½•å»é™¤é‡å¤å‘¢ï¼Ÿ

å‡è®¾æœ‰ä¸€ä¸ªè¿™æ ·çš„æ•°ç»„ï¼š `let originalArray = [1, '1', '1', 2, true, 'true', false, false, null, null, {}, {}, 'abc', 'abc', undefined, undefined, NaN, NaN];`ã€‚åé¢çš„æ–¹æ³•ä¸­çš„æºæ•°ç»„ï¼Œéƒ½æ˜¯æŒ‡çš„è¿™ä¸ªã€‚

#### 1ã€ES6 çš„ Set å¯¹è±¡

ES6 æä¾›äº†æ–°çš„æ•°æ®ç»“æ„ Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚Set æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Set æ•°æ®ç»“æ„ã€‚

```javascript
let resultArr = Array.from(new Set(originalArray));

// æˆ–è€…ç”¨æ‰©å±•è¿ç®—ç¬¦
let resultArr = [...new Set(originalArray)];

console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN]
```

Set å¹¶ä¸æ˜¯çœŸæ­£çš„æ•°ç»„ï¼Œè¿™é‡Œçš„ `Array.from` å’Œ `...` éƒ½å¯ä»¥å°† Set æ•°æ®ç»“æ„ï¼Œè½¬æ¢æˆæœ€ç»ˆçš„ç»“æœæ•°ç»„ã€‚

è¿™æ˜¯æœ€ç®€å•å¿«æ·çš„å»é‡æ–¹æ³•ï¼Œä½†æ˜¯ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œè¿™é‡Œçš„ `{}` æ²¡æœ‰å»é‡ã€‚å¯æ˜¯åˆè½¬å¿µä¸€æƒ³ï¼Œ2 ä¸ªç©ºå¯¹è±¡çš„åœ°å€å¹¶ä¸ç›¸åŒï¼Œæ‰€ä»¥è¿™é‡Œå¹¶æ²¡æœ‰é—®é¢˜ï¼Œç»“æœ okã€‚

#### 2ã€Map çš„ has æ–¹æ³•

æŠŠæºæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ä½œä¸º key å­˜åˆ° Map ä¸­ã€‚ç”±äº Map ä¸­ä¸ä¼šå‡ºç°ç›¸åŒçš„ key å€¼ï¼Œæ‰€ä»¥æœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯å»é‡åçš„ç»“æœã€‚

```javascript
const resultArr = new Array();

for (let i = 0; i < originalArray.length; i++) {
    // æ²¡æœ‰è¯¥ key å€¼
    if (!map.has(originalArray[i])) {
        map.set(originalArray[i], true);
        resultArr.push(originalArray[i]);
    }
}

console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN]
```

ä½†æ˜¯å®ƒä¸ Set çš„æ•°æ®ç»“æ„æ¯”è¾ƒç›¸ä¼¼ï¼Œç»“æœ okã€‚

#### 3ã€indexOf å’Œ includes

å»ºç«‹ä¸€ä¸ªæ–°çš„ç©ºæ•°ç»„ï¼Œéå†æºæ•°ç»„ï¼Œå¾€è¿™ä¸ªç©ºæ•°ç»„é‡Œå¡å€¼ï¼Œæ¯æ¬¡ push ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦å·²æœ‰ç›¸åŒçš„å€¼ã€‚

åˆ¤æ–­çš„æ–¹æ³•æœ‰ 2 ä¸ªï¼šindexOf å’Œ includesï¼Œä½†å®ƒä»¬çš„ç»“æœä¹‹é—´æœ‰ç»†å¾®çš„å·®åˆ«ã€‚å…ˆçœ‹ indexOfã€‚

```javascript
const resultArr = [];
for (let i = 0; i < originalArray.length; i++) {
    if (resultArr.indexOf(originalArray[i]) < 0) {
        resultArr.push(originalArray[i]);
    }
}
console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN, NaN]
```

indexOf å¹¶ä¸æ²¡å¤„ç† `NaN`ã€‚

å†æ¥çœ‹ includesï¼Œå®ƒæ˜¯åœ¨ ES7 ä¸­æ­£å¼æå‡ºçš„ã€‚

```javascript
const resultArr = [];
for (let i = 0; i < originalArray.length; i++) {
    if (!resultArr.includes(originalArray[i])) {
        resultArr.push(originalArray[i]);
    }
}
console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN]
```

includes å¤„ç†äº† `NaN`ï¼Œç»“æœ okã€‚

#### 4ã€sort

å…ˆå°†åŸæ•°ç»„æ’åºï¼Œç”Ÿæˆæ–°çš„æ•°ç»„ï¼Œç„¶åéå†æ’åºåçš„æ•°ç»„ï¼Œç›¸é‚»çš„ä¸¤ä¸¤è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸åŒåˆ™å­˜å…¥æ–°æ•°ç»„ã€‚

```javascript
const sortedArr = originalArray.sort();

const resultArr = [sortedArr[0]];

for (let i = 1; i < sortedArr.length; i++) {
    if (sortedArr[i] !== resultArr[resultArr.length - 1]) {
        resultArr.push(sortedArr[i]);
    }
}
console.log(resultArr);
// [1, "1", 2, NaN, NaN, {â€¦}, {â€¦}, "abc", false, null, true, "true", undefined]
```

ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¯¹æºæ•°ç»„è¿›è¡Œäº†æ’åºã€‚ä½†åŒæ ·çš„æ²¡æœ‰å¤„ç† `NaN`ã€‚

#### 5ã€åŒå±‚ for å¾ªç¯ + splice

åŒå±‚å¾ªç¯ï¼Œå¤–å±‚éå†æºæ•°ç»„ï¼Œå†…å±‚ä» i+1 å¼€å§‹éå†æ¯”è¾ƒï¼Œç›¸åŒæ—¶åˆ é™¤è¿™ä¸ªå€¼ã€‚

```javascript
for (let i = 0; i < originalArray.length; i++) {
    for (let j = (i + 1); j < originalArray.length; j++) {
        // ç¬¬ä¸€ä¸ªç­‰äºç¬¬äºŒä¸ªï¼Œspliceå»æ‰ç¬¬äºŒä¸ª
        if (originalArray[i] === originalArray[j]) {
            originalArray.splice(j, 1);
            j--;
        }
    }
}

console.log(originalArray);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN, NaN]
```

splice æ–¹æ³•ä¼šä¿®æ”¹æºæ•°ç»„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ–°å¼€ç©ºæ•°ç»„å»å­˜å‚¨ï¼Œæœ€ç»ˆè¾“å‡ºçš„æ˜¯ä¿®æ”¹ä¹‹åçš„æºæ•°ç»„ã€‚ä½†åŒæ ·çš„æ²¡æœ‰å¤„ç† `NaN`ã€‚

#### 6ã€åŸå§‹å»é‡

å®šä¹‰ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¹¶å­˜æ”¾åŸæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå°†æºæ•°ç»„ä¸€ä¸€å’Œæ–°æ•°ç»„çš„å…ƒç´ å¯¹æ¯”ï¼Œè‹¥ä¸åŒåˆ™å­˜æ”¾åœ¨æ–°æ•°ç»„ä¸­ã€‚

```javascript
let resultArr = [originalArray[0]];
for(var i = 1; i < originalArray.length; i++){
    var repeat = false;
    for(var j=0; j < resultArr.length; j++){
        if(originalArray[i] === resultArr[j]){
            repeat = true;
            break;
        }
    }

    if(!repeat){
       resultArr.push(originalArray[i]);
    }
}
console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN, NaN]
```

è¿™æ˜¯æœ€åŸå§‹çš„å»é‡æ–¹æ³•ï¼Œå¾ˆå¥½ç†è§£ï¼Œä½†å†™æ³•ç¹çã€‚åŒæ ·çš„æ²¡æœ‰å¤„ç† `NaN`ã€‚

#### 7ã€ES5 çš„ reduce

reduce æ˜¯ ES5 ä¸­æ–¹æ³•ï¼Œå¸¸ç”¨äºå€¼çš„ç´¯åŠ ã€‚å®ƒçš„è¯­æ³•ï¼š

```javascript
arr.reduce(callback[, initialValue])
```

reduce çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª callbackï¼Œcallback ä¸­çš„å‚æ•°åˆ†åˆ«ä¸ºï¼š Accumulator(ç´¯åŠ å™¨)ã€currentValue(å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ )ã€currentIndex(å½“å‰æ­£åœ¨å¤„ç†çš„å…ƒç´ ç´¢å¼•ï¼Œå¯é€‰)ã€array(è°ƒç”¨ reduce çš„æ•°ç»„ï¼Œå¯é€‰)ã€‚

reduce çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä½œä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ callback å‡½æ•°æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚å¦‚æœæ²¡æœ‰æä¾›åˆå§‹å€¼ï¼Œåˆ™å°†ä½¿ç”¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚

åˆ©ç”¨ reduce çš„ç‰¹æ€§ï¼Œå†ç»“åˆä¹‹å‰çš„ includes(ä¹Ÿå¯ä»¥ç”¨ indexOf)ï¼Œå°±èƒ½å¾—åˆ°æ–°çš„å»é‡æ–¹æ³•ï¼š

```javascript
const reducer = (acc, cur) => acc.includes(cur) ? acc : [...acc, cur];

const resultArr = originalArray.reduce(reducer, []);

console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN]
```

è¿™é‡Œçš„ `[]` å°±æ˜¯åˆå§‹å€¼(initialValue)ã€‚acc æ˜¯ç´¯åŠ å™¨ï¼Œåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯å°†æ²¡æœ‰é‡å¤çš„å€¼å¡å…¥æ–°æ•°ç»„ï¼ˆå®ƒä¸€å¼€å§‹æ˜¯ç©ºçš„ï¼‰ã€‚ reduce çš„å†™æ³•å¾ˆç®€å•ï¼Œä½†éœ€è¦å¤šåŠ ç†è§£ã€‚å®ƒå¯ä»¥å¤„ç† `NaN`ï¼Œç»“æœ okã€‚

#### 8ã€å¯¹è±¡çš„å±æ€§

æ¯æ¬¡å–å‡ºåŸæ•°ç»„çš„å…ƒç´ ï¼Œç„¶ååœ¨å¯¹è±¡ä¸­è®¿é—®è¿™ä¸ªå±æ€§ï¼Œå¦‚æœå­˜åœ¨å°±è¯´æ˜é‡å¤ã€‚

```javascript
const resultArr = [];
const obj = {};
for(let i = 0; i < originalArray.length; i++){
    if(!obj[originalArray[i]]){
        resultArr.push(originalArray[i]);
        obj[originalArray[i]] = 1;
    }
}
console.log(resultArr);
// [1, 2, true, false, null, {â€¦}, "abc", undefined, NaN]
```

ä½†è¿™ç§æ–¹æ³•æœ‰ç¼ºé™·ã€‚ä»ç»“æœçœ‹ï¼Œå®ƒè²Œä¼¼åªå…³å¿ƒå€¼ï¼Œä¸å…³æ³¨ç±»å‹ã€‚è¿˜æŠŠ {} ç»™å¤„ç†äº†ï¼Œä½†è¿™ä¸æ˜¯æ­£ç»Ÿçš„å¤„ç†åŠæ³•ï¼Œæ‰€ä»¥ **ä¸æ¨èä½¿ç”¨**ã€‚

#### 9ã€filter + hasOwnProperty

filter æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œé€šè¿‡ hasOwnProperty æ¥æ£€æŸ¥æ˜¯å¦ä¸ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚

```javascript
const obj = {};
const resultArr = originalArray.filter(function (item) {
    return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true);
});

console.log(resultArr);
// [1, "1", 2, true, "true", false, null, {â€¦}, "abc", undefined, NaN]
```

è¿™ `è²Œä¼¼` æ˜¯ç›®å‰çœ‹æ¥æœ€å®Œç¾çš„è§£å†³æ–¹æ¡ˆäº†ã€‚è¿™é‡Œç¨åŠ è§£é‡Šä¸€ä¸‹ï¼š

- hasOwnProperty æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºå¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§ã€‚
- `typeof item + item` çš„å†™æ³•ï¼Œæ˜¯ä¸ºäº†ä¿è¯å€¼ç›¸åŒï¼Œä½†ç±»å‹ä¸åŒçš„å…ƒç´ è¢«ä¿ç•™ä¸‹æ¥ã€‚ä¾‹å¦‚ï¼šç¬¬ä¸€ä¸ªå…ƒç´ ä¸º number1ï¼Œç¬¬äºŒç¬¬ä¸‰ä¸ªå…ƒç´ éƒ½æ˜¯ string1ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå…ƒç´ å°±è¢«å»é™¤äº†ã€‚
- `obj[typeof item + item] = true` å¦‚æœ hasOwnProperty æ²¡æœ‰æ‰¾åˆ°è¯¥å±æ€§ï¼Œåˆ™å¾€ obj é‡Œå¡é”®å€¼å¯¹è¿›å»ï¼Œä»¥æ­¤ä½œä¸ºä¸‹æ¬¡å¾ªç¯çš„åˆ¤æ–­ä¾æ®ã€‚
- å¦‚æœ hasOwnProperty æ²¡æœ‰æ£€æµ‹åˆ°é‡å¤çš„å±æ€§ï¼Œåˆ™å‘Šè¯‰ filter æ–¹æ³•å¯ä»¥å…ˆç§¯æ”’ç€ï¼Œæœ€åä¸€èµ·è¾“å‡ºã€‚

`çœ‹ä¼¼` å®Œç¾è§£å†³äº†æˆ‘ä»¬æºæ•°ç»„çš„å»é‡é—®é¢˜ï¼Œä½†åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šç»™ä¸¤ä¸ªç©ºå¯¹è±¡ç»™æˆ‘ä»¬å»é‡ã€‚æ‰€ä»¥ç¨åŠ æ”¹å˜æºæ•°ç»„ï¼Œç»™ä¸¤ä¸ªç©ºå¯¹è±¡ä¸­åŠ å…¥é”®å€¼å¯¹ã€‚

```javascript
let originalArray = [1, '1', '1', 2, true, 'true', false, false, null, null, {a: 1}, {a: 2}, 'abc', 'abc', undefined, undefined, NaN, NaN];
```

ç„¶åå†ç”¨ filter + hasOwnProperty å»é‡ã€‚

ç„¶è€Œï¼Œç»“æœç«Ÿç„¶æŠŠ `{a: 2}` ç»™å»é™¤äº†ï¼ï¼ï¼è¿™å°±ä¸å¯¹äº†ã€‚

æ‰€ä»¥ï¼Œè¿™ç§æ–¹æ³•æœ‰ç‚¹å»é‡ `è¿‡å¤´` äº†ï¼Œä¹Ÿæ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚

#### 10ã€lodash ä¸­çš„ _.uniq

çµæœºä¸€åŠ¨ï¼Œè®©æˆ‘æƒ³åˆ°äº† lodash çš„å»é‡æ–¹æ³• _.uniqï¼Œé‚£å°±å°è¯•ä¸€æŠŠï¼š

```javascript
console.log(_.uniq(originalArray));

// [1, "1", 2, true, "true", false, null, {â€¦}, {â€¦}, "abc", undefined, NaN]
```

ç”¨æ³•å¾ˆç®€å•ï¼Œå¯ä»¥åœ¨å®é™…å·¥ä½œä¸­æ­£ç¡®å¤„ç†å»é‡é—®é¢˜ã€‚

ç„¶åï¼Œæˆ‘åœ¨å¥½å¥‡å¿ƒä¿ƒä½¿ä¸‹ï¼Œçœ‹äº†å®ƒçš„æºç ï¼ŒæŒ‡å‘äº† baseUniq æ–‡ä»¶ï¼Œå®ƒçš„æºç å¦‚ä¸‹ï¼š

```javascript
function baseUniq(array, iteratee, comparator) {
  let index = -1
  let includes = arrayIncludes
  let isCommon = true

  const { length } = array
  const result = []
  let seen = result

  if (comparator) {
    isCommon = false
    includes = arrayIncludesWith
  }
  else if (length >= LARGE_ARRAY_SIZE) {
    const set = iteratee ? null : createSet(array)
    if (set) {
      return setToArray(set)
    }
    isCommon = false
    includes = cacheHas
    seen = new SetCache
  }
  else {
    seen = iteratee ? [] : result
  }
  outer:
  while (++index < length) {
    let value = array[index]
    const computed = iteratee ? iteratee(value) : value

    value = (comparator || value !== 0) ? value : 0
    if (isCommon && computed === computed) {
      let seenIndex = seen.length
      while (seenIndex--) {
        if (seen[seenIndex] === computed) {
          continue outer
        }
      }
      if (iteratee) {
        seen.push(computed)
      }
      result.push(value)
    }
    else if (!includes(seen, computed, comparator)) {
      if (seen !== result) {
        seen.push(computed)
      }
      result.push(value)
    }
  }
  return result
}
```

æœ‰æ¯”è¾ƒå¤šçš„å¹²æ‰°é¡¹ï¼Œé‚£æ˜¯ä¸ºäº†å…¼å®¹å¦å¤–ä¸¤ä¸ªæ–¹æ³•ï¼Œ_.uniqBy å’Œ _.uniqWithã€‚å»é™¤æ‰ä¹‹åï¼Œå°±ä¼šæ›´å®¹æ˜“å‘ç°å®ƒæ˜¯ç”¨ while åšäº†å¾ªç¯ã€‚å½“é‡åˆ°ç›¸åŒçš„å€¼å¾—æ—¶å€™ï¼Œcontinue outer å†æ¬¡è¿›å…¥å¾ªç¯è¿›è¡Œæ¯”è¾ƒï¼Œå°†æ²¡æœ‰é‡å¤çš„å€¼å¡è¿› result é‡Œï¼Œæœ€ç»ˆè¾“å‡ºã€‚

å¦å¤–ï¼Œ_.uniqBy æ–¹æ³•å¯ä»¥é€šè¿‡æŒ‡å®š keyï¼Œæ¥ä¸“é—¨å»é‡å¯¹è±¡åˆ—è¡¨ã€‚

```javascript
_.uniqBy([{ 'x': 1 }, { 'x': 2 }, { 'x': 1 }], 'x');
// => [{ 'x': 1 }, { 'x': 2 }]
```

_.uniqWith æ–¹æ³•å¯ä»¥å®Œå…¨åœ°ç»™å¯¹è±¡ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œè¿›è¡Œæ¯”è¾ƒã€‚

```javascript
var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 2 }];

_.uniqWith(objects, _.isEqual);
// => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }]
```

è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œéƒ½è¿˜æŒºå®ç”¨çš„ã€‚





### ç»Ÿè®¡ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºç°æœ€å¤šçš„å­—ç¬¦

ç»™å‡ºä¸€æ®µè‹±æ–‡è¿ç»­çš„è‹±æ–‡å­—ç¬¦çªœï¼Œæ‰¾å‡ºé‡å¤å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—æ¯

**æ¯”å¦‚ï¼š** è¾“å…¥ï¼šafjghdfraaaasdenas  è¾“å‡º ï¼š a

å‰é¢å‡ºç°è¿‡å»é‡çš„ç®—æ³•ï¼Œè¿™é‡Œéœ€è¦æ˜¯ç»Ÿè®¡é‡å¤æ¬¡æ•°ã€‚

```javascript
function findMaxDuplicateChar(str) {  
  if(str.length == 1) {
    return str;
  }
  let charObj = {};
  for(let i=0;i<str.length;i++) {
    if(!charObj[str.charAt(i)]) {
      charObj[str.charAt(i)] = 1;
    }else{
      charObj[str.charAt(i)] += 1;
    }
  }
  let maxChar = '',
      maxValue = 1;
  for(var k in charObj) {
    if(charObj[k] >= maxValue) {
      maxChar = k;
      maxValue = charObj[k];
    }
  }
  return maxChar;

}

module.exports = findMaxDuplicateChar;  
```

### æ’åºç®—æ³•

#### 1.å†’æ³¡æ’åº

å¦‚æœè¯´åˆ°ç®—æ³•é¢˜ç›®çš„è¯ï¼Œåº”è¯¥å¤§å¤šéƒ½æ˜¯æ¯”è¾ƒå¼€æ”¾çš„é¢˜ç›®ï¼Œä¸é™å®šç®—æ³•çš„å®ç°ï¼Œä½†æ˜¯ä¸€å®šè¦æ±‚æŒæ¡å…¶ä¸­çš„å‡ ç§ï¼Œæ‰€ä»¥å†’æ³¡æ’åºï¼Œè¿™ç§è¾ƒä¸ºåŸºç¡€å¹¶ä¸”ä¾¿äºç†è§£è®°å¿†çš„ç®—æ³•ä¸€å®šéœ€è¦ç†Ÿè®°äºå¿ƒã€‚å†’æ³¡æ’åºç®—æ³•å°±æ˜¯ä¾æ¬¡æ¯”è¾ƒå¤§å°ï¼Œå°çš„çš„å¤§çš„è¿›è¡Œä½ç½®ä¸Šçš„äº¤æ¢ã€‚

```javascript
function bubbleSort(arr) {  
    for(let i = 0,l=arr.length;i<l-1;i++) {
        for(let j = i+1;j<l;j++) { 
          if(arr[i]>arr[j]) {
                let tem = arr[i];
                arr[i] = arr[j];
                arr[j] = tem;
            }
        }
    }
    return arr;
}
module.exports = bubbleSort;  
```

#### 2.é€‰æ‹©æ’åº

ç®—æ³•å‚è€ƒæŸä¸ªå…ƒç´ å€¼ï¼Œå°†å°äºå®ƒçš„å€¼ï¼Œæ”¾åˆ°å·¦æ•°ç»„ä¸­ï¼Œå¤§äºå®ƒçš„å€¼çš„å…ƒç´ å°±æ”¾åˆ°å³æ•°ç»„ä¸­ï¼Œç„¶åé€’å½’è¿›è¡Œä¸Šä¸€æ¬¡å·¦å³æ•°ç»„çš„æ“ä½œï¼Œè¿”å›åˆå¹¶çš„æ•°ç»„å°±æ˜¯å·²ç»æ’å¥½é¡ºåºçš„æ•°ç»„äº†ã€‚

```javascript
function quickSort(arr) {

    if(arr.length<=1) {
        return arr;
    }

    let leftArr = [];
    let rightArr = [];
    let q = arr[0];
    for(let i = 1,l=arr.length; i<l; i++) {
        if(arr[i]>q) {
            rightArr.push(arr[i]);
        }else{
            leftArr.push(arr[i]);
        }
    }

    return [].concat(quickSort(leftArr),[q],quickSort(rightArr));
}

module.exports = quickSort; 
```

[HTML5 Canvas Demo: Sorting Algorithms](http://math.hws.edu/eck/jsdemo/sortlab.html)ï¼Œç”¨åŠ¨ç”»æ¼”ç¤ºç®—æ³•ã€‚

####3.æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰

#####ç®—æ³•æè¿°

æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰çš„ç®—æ³•æè¿°æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­**ä»åå‘å‰æ‰«æ**ï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ’å…¥æ’åºåœ¨å®ç°ä¸Šï¼Œé€šå¸¸é‡‡ç”¨in-placeæ’åºï¼ˆå³åªéœ€ç”¨åˆ°O(1)çš„é¢å¤–ç©ºé—´çš„æ’åºï¼‰ï¼Œå› è€Œåœ¨ä»åå‘å‰æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åå¤æŠŠå·²æ’åºå…ƒç´ é€æ­¥å‘åæŒªä½ï¼Œä¸ºæœ€æ–°å…ƒç´ æä¾›æ’å…¥ç©ºé—´ã€‚

æ’å…¥æ’åºæ ¸å¿ƒ--æ‰‘å…‹ç‰Œæ€æƒ³ï¼š å°±æƒ³ç€è‡ªå·±åœ¨æ‰“æ‰‘å…‹ç‰Œï¼Œæ¥èµ·æ¥ç¬¬ä¸€å¼ ï¼Œæ”¾å“ªé‡Œæ— æ‰€è°“ï¼Œå†æ¥èµ·æ¥ä¸€å¼ ï¼Œæ¯”ç¬¬ä¸€å¼ å°ï¼Œæ”¾å·¦è¾¹ï¼Œç»§ç»­æ¥ï¼Œå¯èƒ½æ˜¯ä¸­é—´æ•°ï¼Œå°±æ’åœ¨ä¸­é—´.åé¢èµ·çš„ç‰Œä»åå‘å‰ä¾æ¬¡æ¯”è¾ƒ,å¹¶æ’å…¥.



![æ’å…¥æ’åº](https://user-gold-cdn.xitu.io/2019/2/24/1691df9f6afc4b04?imageslim)

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ€è·¯:** æ’å…¥æ’åºä¹Ÿå±äºåŸºæœ¬æ’åºç®—æ³•,**å¤§è‡´æ€è·¯ä¹Ÿæ˜¯ä¸¤å±‚å¾ªç¯åµŒå¥—**.é¦–å…ˆ,æŒ‰ç…§å…¶æ‰‘å…‹ç‰Œçš„æ€è·¯.å°†è¦æ’åºçš„æ•°åˆ—åˆ†ä¸ºä¸¤éƒ¨åˆ†.å·¦è¾¹ä¸ºæœ‰åºæ•°åˆ—(èµ·åœ¨æ‰‹ä¸­çš„ç‰Œ),åˆšå¼€å§‹ä¸ºç©º.å³è¾¹éƒ¨åˆ†ä¸ºå¾…æ’åºçš„æ•°åˆ—(å³ä¹±åºçš„æ‰‘å…‹ç‰Œ).

æœ‰äº†ä¸Šé¢å¤§è‡´æ€æƒ³å,å¼€å§‹è®¾ç½®å¾ªç¯.é¦–å…ˆå¤–å¾ªç¯ä¸ºä½ éœ€è¦èµ·å¤šå°‘å¼ ç‰Œ.é‚£æ˜¯å¤šå°‘?æ¯«æ— ç–‘é—®å°±æ˜¯æ•°åˆ—çš„é•¿åº¦,ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿,æˆ‘ä»¬å¯ä»¥é»˜è®¤è®©æ•°åˆ—ç¬¬ä¸€ä¸ªæ•°ä½œä¸ºæœ‰åºæ•°åˆ—,å¯ä»¥å‡å°‘ä¸€æ¬¡å¾ªç¯.æ•…å¤–å¾ªç¯æ¬¡æ•°ä¸ºæ•°åˆ—é•¿åº¦å‡1;å†…å¾ªç¯åˆ™å¾ªç¯æœ‰åºæ•°åˆ—,å¹¶ä»å³å¾€å·¦,æ¯”è¾ƒå¤§å°,å°†è¾ƒå°æ•°æ’åœ¨å‰é¢(ç»“åˆåŠ¨å›¾)

**æ­¥éª¤:**

- 1.ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼›
- 2.å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼›
- 3.å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼›
- 4.é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼›
- 5.å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼›
- 6.é‡å¤æ­¥éª¤2~5ã€‚

**JSä»£ç å®ç°:**

```
function insertSort(arr) {
    for(let i = 1; i < arr.length; i++) {  //å¤–å¾ªç¯ä»1å¼€å§‹ï¼Œé»˜è®¤arr[0]æ˜¯æœ‰åºæ®µ
        for(let j = i; j > 0; j--) {  //j = i,è¡¨ç¤ºæ­¤æ—¶ä½ èµ·åœ¨æ‰‹ä¸Šçš„é‚£å¼ ç‰Œ,å°†arr[j]ä¾æ¬¡æ¯”è¾ƒæ’å…¥æœ‰åºæ®µä¸­
            if(arr[j] < arr[j-1]) {
                [arr[j],arr[j-1]] = [arr[j-1],arr[j]];  //å…¶å®è¿™é‡Œå†…å¾ªç¯ä¸­,åªè¦æ¯”å®ƒå‰ä¸€ä¸ªæ•°å°å°±äº¤æ¢,ç›´åˆ°æ²¡æœ‰æ›´å°çš„,å°±breaké€€å‡º.è¿™å’ŒåŠ¨å›¾è¡¨ç¤ºçš„æ’å…¥è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„,ä½†æœ€åç»“æœå…¶å®æ˜¯ä¸€æ ·çš„.
            } else {
                break;
            }
        }
    }
    return arr;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(insertSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
å¤åˆ¶ä»£ç 
```

####4.å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰

#####ç®—æ³•æè¿°

å¿«é€Ÿæ’åºçš„åå­—èµ·çš„æ˜¯ç®€å•ç²—æš´ï¼Œå› ä¸ºä¸€å¬åˆ°è¿™ä¸ªåå­—ä½ å°±çŸ¥é“å®ƒå­˜åœ¨çš„æ„ä¹‰ï¼Œå°±æ˜¯å¿«ï¼Œè€Œä¸”æ•ˆç‡é«˜! å®ƒæ˜¯å¤„ç†**å¤§æ•°æ®**æœ€å¿«çš„æ’åºç®—æ³•ä¹‹ä¸€äº†ã€‚

å®ƒæ˜¯åœ¨å†’æ³¡æ’åºåŸºç¡€ä¸Šçš„é€’å½’åˆ†æ²»æ³•ã€‚é€šè¿‡é€’å½’çš„æ–¹å¼å°†æ•°æ®ä¾æ¬¡åˆ†è§£ä¸ºåŒ…å«è¾ƒå°å…ƒç´ å’Œè¾ƒå¤§å…ƒç´ çš„ä¸åŒå­åºåˆ—ã€‚è¯¥ç®—æ³•ä¸æ–­é‡å¤è¿™ä¸ªæ­¥éª¤ç›´è‡³æ‰€æœ‰æ•°æ®éƒ½æ˜¯æœ‰åºçš„ã€‚

**æ³¨æ„:** å¿«é€Ÿæ’åºä¹Ÿæ˜¯é¢è¯•æ˜¯**æœ€æœ€æœ€å®¹æ˜“è€ƒåˆ°çš„ç®—æ³•é¢˜**,ç»å¸¸å°±ä¼šè®©ä½ è¿›è¡Œæ‰‹å†™.



![å¿«é€Ÿæ’åº](https://user-gold-cdn.xitu.io/2019/2/24/1691dfaa8bbf0e52?imageslim)

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ€è·¯:** å¿«é€Ÿæ’åºå±äºé«˜çº§æ’åºç®—æ³•,æ­¤æ—¶å°±ä¸æ˜¯ç›¸ä¼¼çš„å¾ªç¯åµŒå¥—.å®ƒçš„å¤§æ¦‚æ€æƒ³å°±æ˜¯: æ‰¾åˆ°ä¸€ä¸ªæ•°ä½œä¸ºå‚è€ƒï¼Œæ¯”è¿™ä¸ªæ•°å­—å¤§çš„æ”¾åœ¨æ•°å­—å·¦è¾¹ï¼Œæ¯”å®ƒå°çš„æ”¾åœ¨å³è¾¹ï¼› ç„¶ååˆ†åˆ«å†å¯¹å·¦è¾¹å’Œå³å˜çš„åºåˆ—åšç›¸åŒçš„æ“ä½œ(é€’å½’).

**æ³¨æ„:** **æ¶‰åŠåˆ°é€’å½’çš„ç®—æ³•,ä¸€å®šè¦è®°å¾—è®¾ç½®å‡ºå£,è·³å‡ºé€’å½’!**

**æ­¥éª¤:**

- 1.ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰;
- 2.é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›
- 3.é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºï¼›

**JSä»£ç å®ç°:**

```javascript
function quickSort (arr) {
	if(arr.length <= 1) {
        return arr;  //é€’å½’å‡ºå£
    }
	let left = [],
        right = [],
		//è¿™é‡Œæˆ‘ä»¬é»˜è®¤é€‰æ‹©æ•°ç»„ç¬¬ä¸€ä¸ªä¸ºåŸºå‡†,PS:å…¶å®è¿™æ ·å·æ‡’æ˜¯ä¸å¥½çš„,å¦‚æœæ•°ç»„æ˜¯å·²ç»æ’å¥½åºäº†çš„.åˆ™å¾ˆæœ‰å¯èƒ½å˜æˆæœ€å·®æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦
		//pivotIndex = Math.floor(arr.length / 2),
	    pivot = arr[0];    //é˜®ä¸€å³°ç‰ˆ:  arr.splice(pivotIndex, 1)[0];   ä½¿ç”¨spliceåœ¨å¤§é‡æ•°æ®æ—¶,ä¼šæ¶ˆè€—å¤§é‡å†…å­˜;ä½†ä¹Ÿä¸è‡³äºè¢«å–·å¾—ä¸€æ— æ˜¯å¤„! å®ƒçš„æ€è·¯æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„! 
	for (var i = 1; i < arr.length; i++) {
		if (arr[i] < pivot) {
			left.push(arr[i])
		} else {
			right.push(arr[i])
		}
	}
	//concatä¹Ÿä¸é€‚åˆå¤§é‡æ•°æ®çš„æ’åº,ä¼šæ¶ˆè€—å¤§é‡å†…å­˜
	return quickSort(left).concat(pivot, quickSort(right))
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(quickSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]

//æ”¹è¿›ç‰ˆ:
function partition2(arr, low, high) {
  let pivot = arr[low];
  while (low < high) {
    while (low < high && arr[high] > pivot) {
      --high;
    }
    arr[low] = arr[high];
    while (low < high && arr[low] <= pivot) {
      ++low;
    }
    arr[high] = arr[low];
  }
  arr[low] = pivot;
  return low;
}

function quickSort2(arr, low, high) {
  if (low < high) {
    let pivot = partition2(arr, low, high);
    quickSort2(arr, low, pivot - 1);
    quickSort2(arr, pivot + 1, high);
  }
  return arr;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(quickSort2(arr,0,arr.length-1));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####5.å¸Œå°”æ’åºï¼ˆShell Sortï¼‰

#####ç®—æ³•æè¿°

1959å¹´Shellå‘æ˜ï¼› ç¬¬ä¸€ä¸ªçªç ´O(n^2)çš„æ’åºç®—æ³•ï¼›**æ˜¯ç®€å•æ’å…¥æ’åºçš„æ”¹è¿›ç‰ˆï¼›å®ƒä¸æ’å…¥æ’åºçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šä¼˜å…ˆæ¯”è¾ƒè·ç¦»è¾ƒè¿œçš„å…ƒç´ ã€‚** å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åº.å¹¶ä¸”æ’åºä¹Ÿæ˜¯ä¸ç¨³å®šçš„

å¸Œå°”æ’åºæ˜¯åŸºäºæ’å…¥æ’åºçš„ä»¥ä¸‹ä¸¤ç‚¹æ€§è´¨è€Œæå‡ºæ”¹è¿›æ–¹æ³•çš„ï¼š

- æ’å…¥æ’åºåœ¨å¯¹å‡ ä¹å·²ç»æ’å¥½åºçš„æ•°æ®æ“ä½œæ—¶ï¼Œæ•ˆç‡é«˜ï¼Œå³å¯ä»¥è¾¾åˆ°çº¿æ€§æ’åºçš„æ•ˆç‡ï¼›
- ä½†æ’å…¥æ’åºä¸€èˆ¬æ¥è¯´æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæ’å…¥æ’åºæ¯æ¬¡åªèƒ½å°†æ•°æ®ç§»åŠ¨ä¸€ä½ï¼›

å¸Œå°”æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ€è·¯:**  å¸Œå°”æ’åºå…¶å®å¤§ä½“æ€è·¯å¾ˆç®€å•,å°±æ˜¯å°†æ•°ç»„(é•¿åº¦ä¸ºlen)åˆ†æˆé—´éš”ä¸ºt1çš„è‹¥å¹²æ•°ç»„.è¿›è¡Œæ’å…¥æ’åº;æ’å®Œå,å°†æ•°ç»„å†åˆ†æˆé—´éš”ä¸ºt2(é€æ­¥å‡å°)çš„è‹¥å¹²æ•°ç»„,è¿›è¡Œæ’å…¥æ’åº;ç„¶åç»§ç»­ä¸Šè¿°æ“ä½œ,ç›´åˆ°åˆ†æˆé—´éš”ä¸º1çš„æ•°ç»„,å†è¿›è¡Œæœ€åä¸€æ¬¡æ’å…¥æ’åºåˆ™å®Œæˆ.

æ–¹ä¾¿ç†è§£å¯ä»¥æŸ¥çœ‹ä¸‹å›¾:



![img](https://user-gold-cdn.xitu.io/2019/2/24/1691dfc27c806ac3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



**æ­¥éª¤:**

- 1,é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti>tjï¼Œtk=1ï¼›
- 2,æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œk è¶Ÿæ’åºï¼›
- 3,æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚

**JSä»£ç å®ç°:**

```javascript
function shellSort(arr) {
    var len = arr.length,
        temp,
        gap = 1;
    while(gap < len/5) {          //åŠ¨æ€å®šä¹‰é—´éš”åºåˆ—
        gap =gap*5+1;
    }
    for (gap; gap > 0; gap = Math.floor(gap/5)) {
        for (var i = gap; i < len; i++) {
            temp = arr[i];
            for (var j = i-gap; j >= 0 && arr[j] > temp; j-=gap) {
                arr[j+gap] = arr[j];
            }
            arr[j+gap] = temp;
        }
    }
    return arr;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(shellSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####6.å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰

#####ç®—æ³•æè¿°

å½’å¹¶æ’åºï¼ˆMerge sortï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯**é‡‡ç”¨åˆ†æ²»æ³•**ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚

å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ€è·¯:** å°†æ•°ç»„åˆ†ä¸ºå·¦å’Œå³ä¸¤éƒ¨åˆ†,ç„¶åç»§ç»­å°†å·¦å³ä¸¤éƒ¨åˆ†ç»§ç»­(é€’å½’)æ‹†åˆ†,ç›´åˆ°æ‹†åˆ†æˆå•ä¸ªä¸ºæ­¢;ç„¶åå°†æ‹†åˆ†ä¸ºæœ€å°çš„ä¸¤ä¸ªæ•°ç»„,è¿›è¡Œæ¯”è¾ƒ,åˆå¹¶æ’æˆä¸€ä¸ªæ•°ç»„.æ¥ç€ç»§ç»­é€’å½’æ¯”è¾ƒåˆå¹¶.ç›´åˆ°æœ€ååˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„.

**æ­¥éª¤:**

- 1.æŠŠé•¿åº¦ä¸ºnçš„è¾“å…¥åºåˆ—åˆ†æˆä¸¤ä¸ªé•¿åº¦ä¸ºn/2çš„å­åºåˆ—ï¼›
- 2.å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«é‡‡ç”¨å½’å¹¶æ’åºï¼›
- 3.å°†ä¸¤ä¸ªæ’åºå¥½çš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„æ’åºåºåˆ—ã€‚

**JSä»£ç å®ç°:**

```javascript
function mergeSort(arr) {  //é‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„é€’å½’æ–¹æ³•
    var len = arr.length;
    if(len < 2) {
        return arr;
    }
    var middle = Math.floor(len / 2),
        left = arr.slice(0, middle),
        right = arr.slice(middle);
    return merge(mergeSort(left), mergeSort(right));
}

function merge(left, right){
    var result = [];
    while (left.length && right.length) {
        if (left[0] <= right[0]) {
            result.push(left.shift());
        } else {
            result.push(right.shift());
        }
    }

    while (left.length)
        result.push(left.shift());

    while (right.length)
        result.push(right.shift());
    return result;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(mergeSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####7.å †æ’åºï¼ˆHeap Sortï¼‰

#####ç®—æ³•æè¿°

å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚å †æ’åºå¯ä»¥è¯´æ˜¯ä¸€ç§åˆ©ç”¨å †çš„æ¦‚å¿µæ¥æ’åºçš„é€‰æ‹©æ’åºã€‚åˆ†ä¸ºä¸¤ç§æ–¹æ³•ï¼š

- å¤§é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºå‡åºæ’åˆ—ï¼›
- å°é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºé™åºæ’åˆ—ï¼›



![å½’å¹¶æ’åº](https://user-gold-cdn.xitu.io/2019/2/24/1691dfd711a56f14?imageslim)



**æ­¥éª¤:**

- 1.å°†åˆå§‹å¾…æ’åºå…³é”®å­—åºåˆ—(R1,R2....Rn)æ„å»ºæˆå¤§é¡¶å †ï¼Œæ­¤å †ä¸ºåˆå§‹çš„æ— åºåŒºï¼›
- 2.å°†å †é¡¶å…ƒç´ R[1]ä¸æœ€åä¸€ä¸ªå…ƒç´ R[n]äº¤æ¢ï¼Œæ­¤æ—¶å¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2,......Rn-1)å’Œæ–°çš„æœ‰åºåŒº(Rn),ä¸”æ»¡è¶³R[1,2...n-1]<=R[n]ï¼›
- 3.ç”±äºäº¤æ¢åæ–°çš„å †é¡¶R[1]å¯èƒ½è¿åå †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦å¯¹å½“å‰æ— åºåŒº(R1,R2,......Rn-1)è°ƒæ•´ä¸ºæ–°å †ï¼Œç„¶åå†æ¬¡å°†R[1]ä¸æ— åºåŒºæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°æ–°çš„æ— åºåŒº(R1,R2....Rn-2)å’Œæ–°çš„æœ‰åºåŒº(Rn-1,Rn)ã€‚ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°æœ‰åºåŒºçš„å…ƒç´ ä¸ªæ•°ä¸ºn-1ï¼Œåˆ™æ•´ä¸ªæ’åºè¿‡ç¨‹å®Œæˆã€‚

**JSä»£ç å®ç°:**

```javascript
function buildMaxHeap(arr,len) {   // å»ºç«‹å¤§é¡¶å †
    
    for (var i = Math.floor(len/2); i >= 0; i--) {
        heapify(arr, i,len);
    }
}

function heapify(arr, i,len) {     // å †è°ƒæ•´
    var left = 2 * i + 1,
        right = 2 * i + 2,
        largest = i;

    if (left < len && arr[left] > arr[largest]) {
        largest = left;
    }

    if (right < len && arr[right] > arr[largest]) {
        largest = right;
    }

    if (largest != i) {
        swap(arr, i, largest);
        heapify(arr, largest,len);
    }
}

function swap(arr, i, j) {
    var temp = arr[i];
    arr[i] = arr[j];
    arr[j] = temp;
}

function heapSort(arr) {
    var len = arr.length;
    buildMaxHeap(arr,len);

    for (var i = arr.length-1; i > 0; i--) {
        swap(arr, 0, i);
        len--;
        heapify(arr, 0,len);
    }
    return arr;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(heapSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####8.è®¡æ•°æ’åºï¼ˆCounting Sortï¼‰

#####ç®—æ³•æè¿°

è®¡æ•°æ’åºå‡ ä¹æ˜¯å”¯ä¸€ä¸€ä¸ªä¸åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•, è¯¥ç®—æ³•äº1954å¹´ç”± Harold H. Seward æå‡º. ä½¿ç”¨å®ƒå¤„ç†ä¸€å®šèŒƒå›´å†…çš„æ•´æ•°æ’åºæ—¶, æ—¶é—´å¤æ‚åº¦ä¸ºO(n+k), å…¶ä¸­kæ˜¯æ•´æ•°çš„èŒƒå›´, å®ƒå‡ ä¹æ¯”ä»»ä½•åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•éƒ½è¦å¿«`( åªæœ‰å½“O(k)>O(n*log(n))çš„æ—¶å€™å…¶æ•ˆç‡åè€Œä¸å¦‚åŸºäºæ¯”è¾ƒçš„æ’åº, å¦‚å½’å¹¶æ’åºå’Œå †æ’åº)`.

è®¡æ•°æ’åºçš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨**é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚**



![è®¡æ•°æ’åº](https://user-gold-cdn.xitu.io/2019/2/24/1691dfde0eaa754a?imageslim)

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ€è·¯:** è®¡æ•°æ’åºåˆ©ç”¨äº†ä¸€ä¸ªç‰¹æ€§, å¯¹äºæ•°ç»„çš„æŸä¸ªå…ƒç´ , ä¸€æ—¦çŸ¥é“äº†æœ‰å¤šå°‘ä¸ªå…¶å®ƒå…ƒç´ æ¯”å®ƒå°(å‡è®¾ä¸ºmä¸ª), é‚£ä¹ˆå°±å¯ä»¥ç¡®å®šå‡ºè¯¥å…ƒç´ çš„æ­£ç¡®ä½ç½®(ç¬¬m+1ä½)

**æ­¥éª¤:**

- 1, è·å–å¾…æ’åºæ•°ç»„Açš„æœ€å¤§å€¼, æœ€å°å€¼.
- 2, å°†æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®å€¼+1ä½œä¸ºé•¿åº¦æ–°å»ºè®¡æ•°æ•°ç»„Bï¼Œå¹¶å°†ç›¸åŒå…ƒç´ çš„æ•°é‡ä½œä¸ºå€¼å­˜å…¥è®¡æ•°æ•°ç»„.
- 3, å¯¹è®¡æ•°æ•°ç»„Bç´¯åŠ è®¡æ•°, å­˜å‚¨ä¸åŒå€¼çš„åˆå§‹ä¸‹æ ‡.
- 4, ä»åŸæ•°ç»„AæŒ¨ä¸ªå–å€¼, èµ‹å€¼ç»™ä¸€ä¸ªæ–°çš„æ•°ç»„Cç›¸åº”çš„ä¸‹æ ‡, æœ€ç»ˆè¿”å›æ•°ç»„C.

æ³¨æ„: **å¦‚æœåŸæ•°ç»„Aæ˜¯åŒ…å«è‹¥å¹²ä¸ªå¯¹è±¡çš„æ•°ç»„ï¼Œéœ€è¦åŸºäºå¯¹è±¡çš„æŸä¸ªå±æ€§è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆç®—æ³•å¼€å§‹æ—¶ï¼Œéœ€è¦å°†åŸæ•°ç»„Aå¤„ç†ä¸ºä¸€ä¸ªåªåŒ…å«å¯¹è±¡å±æ€§å€¼çš„ç®€å•æ•°ç»„simpleA, æ¥ä¸‹æ¥ä¾¿åŸºäºsimpleAè¿›è¡Œè®¡æ•°ã€ç´¯åŠ è®¡æ•°, å…¶å®ƒåŒä¸Š.**

**JSä»£ç å®ç°:**

```javascript
//ä»¥ä¸‹å®ç°ä¸ä»…æ”¯æŒäº†æ•°å€¼åºåˆ—çš„æ’åºï¼Œè¿˜æ”¯æŒæ ¹æ®å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼æ¥æ’åºã€‚
function countSort(array, keyName){
  var length = array.length,
      output = new Array(length),
      max,
      min,
      simpleArray = keyName ? array.map(function(v){
        return v[keyName];
      }) : array; // å¦‚æœkeyNameæ˜¯å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªåªæœ‰keyValueçš„ç®€å•æ•°ç»„

  // è·å–æœ€å¤§æœ€å°å€¼
  max = min = simpleArray[0];
  simpleArray.forEach(function(v){
    v > max && (max = v);
    v < min && (min = v);
  });
  // è·å–è®¡æ•°æ•°ç»„çš„é•¿åº¦
  var k = max - min + 1;
  // æ–°å»ºå¹¶åˆå§‹åŒ–è®¡æ•°æ•°ç»„
  var countArray = new Array(k);
  simpleArray.forEach(function(v){
    countArray[v - min]= (countArray[v - min] || 0) + 1;
  });
  // ç´¯åŠ è®¡æ•°ï¼Œå­˜å‚¨ä¸åŒå€¼çš„åˆå§‹ä¸‹æ ‡
  countArray.reduce(function(prev, current, i, arr){
    arr[i] = prev;
    return prev + current;
  }, 0);
  // ä»åŸæ•°ç»„æŒ¨ä¸ªå–å€¼(å› å–çš„æ˜¯åŸæ•°ç»„çš„ç›¸åº”å€¼ï¼Œåªèƒ½é€šè¿‡éå†åŸæ•°ç»„æ¥å®ç°)
  simpleArray.forEach(function(v, i){
    var j = countArray[v - min]++;
    output[j] = array[i];
  });
  return output;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(countSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####9.æ¡¶æ’åºï¼ˆBucket Sortï¼‰

#####ç®—æ³•æè¿°

æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚ä¸ºäº†ä½¿æ¡¶æ’åºæ›´åŠ é«˜æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°è¿™ä¸¤ç‚¹ï¼š

- åœ¨é¢å¤–ç©ºé—´å……è¶³çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¢å¤§æ¡¶çš„æ•°é‡
- ä½¿ç”¨çš„æ˜ å°„å‡½æ•°èƒ½å¤Ÿå°†è¾“å…¥çš„ N ä¸ªæ•°æ®å‡åŒ€çš„åˆ†é…åˆ° K ä¸ªæ¡¶ä¸­

åŒæ—¶ï¼Œå¯¹äºæ¡¶ä¸­å…ƒç´ çš„æ’åºï¼Œé€‰æ‹©ä½•ç§æ¯”è¾ƒæ’åºç®—æ³•å¯¹äºæ€§èƒ½çš„å½±å“è‡³å…³é‡è¦ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ¡¶åˆ’åˆ†çš„è¶Šå°ï¼Œå„ä¸ªæ¡¶ä¹‹é—´çš„æ•°æ®è¶Šå°‘ï¼Œæ’åºæ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šå°‘ã€‚ä½†ç›¸åº”çš„ç©ºé—´æ¶ˆè€—å°±ä¼šå¢å¤§ã€‚



![æ¡¶æ’åº](https://user-gold-cdn.xitu.io/2019/2/24/1691dfe4be472342?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ€è·¯:** æ¡¶æ’åº (Bucket sort)çš„å·¥ä½œçš„åŸç†ï¼šå‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’

**æ­¥éª¤:**

- 1.è®¾ç½®ä¸€ä¸ªå®šé‡çš„æ•°ç»„å½“ä½œç©ºæ¡¶ï¼›
- 2.éå†è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å¯¹åº”çš„æ¡¶é‡Œå»ï¼›
- 3.å¯¹æ¯ä¸ªä¸æ˜¯ç©ºçš„æ¡¶è¿›è¡Œæ’åºï¼›
- 4.ä»ä¸æ˜¯ç©ºçš„æ¡¶é‡ŒæŠŠæ’å¥½åºçš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚

æ³¨æ„: **å¦‚æœåŸæ•°ç»„Aæ˜¯åŒ…å«è‹¥å¹²ä¸ªå¯¹è±¡çš„æ•°ç»„ï¼Œéœ€è¦åŸºäºå¯¹è±¡çš„æŸä¸ªå±æ€§è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆç®—æ³•å¼€å§‹æ—¶ï¼Œéœ€è¦å°†åŸæ•°ç»„Aå¤„ç†ä¸ºä¸€ä¸ªåªåŒ…å«å¯¹è±¡å±æ€§å€¼çš„ç®€å•æ•°ç»„simpleA, æ¥ä¸‹æ¥ä¾¿åŸºäºsimpleAè¿›è¡Œè®¡æ•°ã€ç´¯åŠ è®¡æ•°, å…¶å®ƒåŒä¸Š.**

**JSä»£ç å®ç°:**

```javascript
function bucketSort(arr, bucketSize) {
    if (arr.length === 0) {
      return arr;
    }

    var i;
    var minValue = arr[0];
    var maxValue = arr[0];
    for (i = 1; i < arr.length; i++) {
      if (arr[i] < minValue) {
          minValue = arr[i];                // è¾“å…¥æ•°æ®çš„æœ€å°å€¼
      } else if (arr[i] > maxValue) {
          maxValue = arr[i];                // è¾“å…¥æ•°æ®çš„æœ€å¤§å€¼
      }
    }

    //æ¡¶çš„åˆå§‹åŒ–
    var DEFAULT_BUCKET_SIZE = 5;            // è®¾ç½®æ¡¶çš„é»˜è®¤æ•°é‡ä¸º5
    bucketSize = bucketSize || DEFAULT_BUCKET_SIZE;
    var bucketCount = Math.floor((maxValue - minValue) / bucketSize) + 1;   
    var buckets = new Array(bucketCount);
    for (i = 0; i < buckets.length; i++) {
        buckets[i] = [];
    }

    //åˆ©ç”¨æ˜ å°„å‡½æ•°å°†æ•°æ®åˆ†é…åˆ°å„ä¸ªæ¡¶ä¸­
    for (i = 0; i < arr.length; i++) {
        buckets[Math.floor((arr[i] - minValue) / bucketSize)].push(arr[i]);
    }

    arr.length = 0;
    for (i = 0; i < buckets.length; i++) {
        insertionSort(buckets[i]);                      // å¯¹æ¯ä¸ªæ¡¶è¿›è¡Œæ’åºï¼Œè¿™é‡Œä½¿ç”¨äº†æ’å…¥æ’åº
        for (var j = 0; j < buckets[i].length; j++) {
            arr.push(buckets[i][j]);                      
        }
    }

    return arr;
}
var arr=[3,44,38,5,47,15,36,26,27,2,46,4,19,50,48];
console.log(bucketSort(arr));//[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####10.åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰

#####ç®—æ³•æè¿°

åŸºæ•°æ’åºæ˜¯ä¸€ç§éæ¯”è¾ƒå‹æ•´æ•°æ’åºç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚ç”±äºæ•´æ•°ä¹Ÿå¯ä»¥è¡¨è¾¾å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚åå­—æˆ–æ—¥æœŸï¼‰å’Œç‰¹å®šæ ¼å¼çš„æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥åŸºæ•°æ’åºä¹Ÿä¸æ˜¯åªèƒ½ä½¿ç”¨äºæ•´æ•°ã€‚

æŒ‰ç…§ä¼˜å…ˆä»é«˜ä½æˆ–ä½ä½æ¥æ’åºæœ‰ä¸¤ç§å®ç°æ–¹æ¡ˆ:

- MSD: ç”±é«˜ä½ä¸ºåŸºåº•, å…ˆæŒ‰k1æ’åºåˆ†ç»„, åŒä¸€ç»„ä¸­è®°å½•, å…³é”®ç k1ç›¸ç­‰, å†å¯¹å„ç»„æŒ‰k2æ’åºåˆ†æˆå­ç»„, ä¹‹å, å¯¹åé¢çš„å…³é”®ç ç»§ç»­è¿™æ ·çš„æ’åºåˆ†ç»„, ç›´åˆ°æŒ‰æœ€æ¬¡ä½å…³é”®ç kdå¯¹å„å­ç»„æ’åºå. å†å°†å„ç»„è¿æ¥èµ·æ¥, ä¾¿å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—. MSDæ–¹å¼é€‚ç”¨äºä½æ•°å¤šçš„åºåˆ—.
- LSD: ç”±ä½ä½ä¸ºåŸºåº•, å…ˆä»kdå¼€å§‹æ’åºï¼Œå†å¯¹kd-1è¿›è¡Œæ’åºï¼Œä¾æ¬¡é‡å¤ï¼Œç›´åˆ°å¯¹k1æ’åºåä¾¿å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—. LSDæ–¹å¼é€‚ç”¨äºä½æ•°å°‘çš„åºåˆ—.

åŸºæ•°æ’åº,è®¡æ•°æ’åº,æ¡¶æ’åº.è¿™ä¸‰ç§æ’åºç®—æ³•éƒ½åˆ©ç”¨äº†æ¡¶çš„æ¦‚å¿µï¼Œä½†å¯¹æ¡¶çš„ä½¿ç”¨æ–¹æ³•ä¸Šæœ‰æ˜æ˜¾å·®å¼‚ï¼š

- åŸºæ•°æ’åºï¼šæ ¹æ®é”®å€¼çš„æ¯ä½æ•°å­—æ¥åˆ†é…æ¡¶ï¼›
- è®¡æ•°æ’åºï¼šæ¯ä¸ªæ¡¶åªå­˜å‚¨å•ä¸€é”®å€¼ï¼›
- æ¡¶æ’åºï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ä¸€å®šèŒƒå›´çš„æ•°å€¼ï¼›



![åŸºæ•°æ’åº](https://user-gold-cdn.xitu.io/2019/2/24/1691dfecee7659e2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

#####ç®—æ³•æ­¥éª¤åŠå®ç°ä»£ç 

**æ­¥éª¤:**

- 1.å–å¾—æ•°ç»„ä¸­çš„æœ€å¤§æ•°ï¼Œå¹¶å–å¾—ä½æ•°ï¼›
- 2.arrä¸ºåŸå§‹æ•°ç»„ï¼Œä»æœ€ä½ä½å¼€å§‹å–æ¯ä¸ªä½ç»„æˆradixæ•°ç»„ï¼›
- 3.å¯¹radixè¿›è¡Œè®¡æ•°æ’åºï¼ˆåˆ©ç”¨è®¡æ•°æ’åºé€‚ç”¨äºå°èŒƒå›´æ•°çš„ç‰¹ç‚¹ï¼‰ï¼›

**JSä»£ç å®ç°:**

```javascript
/**
 * åŸºæ•°æ’åºé€‚ç”¨äºï¼š
 *  (1)æ•°æ®èŒƒå›´è¾ƒå°ï¼Œå»ºè®®åœ¨å°äº1000
 *  (2)æ¯ä¸ªæ•°å€¼éƒ½è¦å¤§äºç­‰äº0
 * @author xiazdong
 * @param  arr å¾…æ’åºæ•°ç»„
 * @param  maxDigit æœ€å¤§ä½æ•°
 */
//LSD Radix Sort

function radixSort(arr, maxDigit) {
    var mod = 10;
    var dev = 1;
    var counter = [];
    console.time('åŸºæ•°æ’åºè€—æ—¶');
    for (var i = 0; i < maxDigit; i++, dev *= 10, mod *= 10) {
        for(var j = 0; j < arr.length; j++) {
            var bucket = parseInt((arr[j] % mod) / dev);
            if(counter[bucket]== null) {
                counter[bucket] = [];
            }
            counter[bucket].push(arr[j]);
        }
        var pos = 0;
        for(var j = 0; j < counter.length; j++) {
            var value = null;
            if(counter[j]!=null) {
                while ((value = counter[j].shift()) != null) {
                      arr[pos++] = value;
                }
          }
        }
    }
    console.timeEnd('åŸºæ•°æ’åºè€—æ—¶');
    return arr;
}
var arr = [3, 44, 38, 5, 47, 15, 36, 26, 27, 2, 46, 4, 19, 50, 48];
console.log(radixSort(arr,2)); //[2, 3, 4, 5, 15, 19, 26, 27, 36, 38, 44, 46, 47, 48, 50]
```

####11.äºŒå‰æ ‘å’ŒäºŒå‰æŸ¥æ‰¾æ ‘

#####**æ ‘**

æ ‘æ˜¯ä¸€ç§éé¡ºåºæ•°æ®ç»“æ„ï¼Œä¸€ç§åˆ†å±‚æ•°æ®çš„æŠ½è±¡æ¨¡å‹ï¼Œå®ƒå¯¹äºå­˜å‚¨éœ€è¦å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®éå¸¸æœ‰ç”¨ã€‚

ç°å®ç”Ÿæ´»ä¸­æœ€å¸¸è§çš„æ ‘çš„ä¾‹å­æ˜¯å®¶è°±ï¼Œæˆ–æ˜¯å…¬å¸çš„ç»„ç»‡æ¶æ„å›¾.

ä¸€ä¸ªæ ‘ç»“æ„åŒ…å«ä¸€ç³»åˆ—å­˜åœ¨çˆ¶å­å…³ç³»çš„èŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼ˆé™¤äº†é¡¶éƒ¨çš„ç¬¬ä¸€ä¸ª èŠ‚ç‚¹ï¼‰ä»¥åŠé›¶ä¸ªæˆ–å¤šä¸ªå­èŠ‚ç‚¹.

**æ ‘å¸¸è§ç»“æ„/å±æ€§ï¼š**

- èŠ‚ç‚¹ 
  - æ ¹èŠ‚ç‚¹
  - å†…éƒ¨èŠ‚ç‚¹ï¼šéæ ¹èŠ‚ç‚¹ã€ä¸”æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹
  - å¤–éƒ¨èŠ‚ç‚¹/é¡µèŠ‚ç‚¹ï¼šæ— å­èŠ‚ç‚¹çš„èŠ‚ç‚¹
- å­æ ‘ï¼šå°±æ˜¯å¤§å¤§å°å°èŠ‚ç‚¹ç»„æˆçš„æ ‘
- æ·±åº¦ï¼šèŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„èŠ‚ç‚¹æ•°é‡
- é«˜åº¦ï¼šæ ‘çš„é«˜åº¦å–å†³äºæ‰€æœ‰èŠ‚ç‚¹æ·±åº¦ä¸­çš„æœ€å¤§å€¼
- å±‚çº§ï¼šä¹Ÿå¯ä»¥æŒ‰ç…§èŠ‚ç‚¹çº§åˆ«æ¥åˆ†å±‚

#####**äºŒå‰æ ‘**

äºŒå‰æ ‘ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘ï¼Œå³å­èŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªï¼Œè¿™ä¸ªé™åˆ¶å¯ä»¥ä½¿å¾—å†™å‡ºé«˜æ•ˆçš„æ’å…¥ã€åˆ é™¤ã€å’ŒæŸ¥æ‰¾æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸­ï¼Œå­èŠ‚ç‚¹åˆ†åˆ«å«å·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹ã€‚



![äºŒå‰æ ‘](https://user-gold-cdn.xitu.io/2019/2/24/1691e0043526d05f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

#####**äºŒå‰æŸ¥æ‰¾æ ‘**

äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œ**ç›¸å¯¹è¾ƒå°çš„å€¼ä¿å­˜åœ¨å·¦èŠ‚ç‚¹ä¸­ï¼Œè¾ƒå¤§çš„å€¼ï¼ˆæˆ–è€…ç­‰äºï¼‰ä¿å­˜åœ¨å³èŠ‚ç‚¹ä¸­ï¼Œè¿™ä¸€ç‰¹æ€§ä½¿å¾—æŸ¥æ‰¾çš„æ•ˆç‡å¾ˆé«˜ï¼Œå¯¹äºæ•°å€¼å‹å’Œéæ•°å€¼å‹æ•°æ®ï¼Œæ¯”å¦‚å­—æ¯å’Œå­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯å¦‚æ­¤ã€‚** ç°åœ¨é€šè¿‡JSå®ç°ä¸€ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘ã€‚

**èŠ‚ç‚¹:**

äºŒå‰æ ‘çš„æœ€å°å…ƒç´ æ˜¯èŠ‚ç‚¹ï¼Œæ‰€ä»¥å…ˆå®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹

```javascript
function Node(data,left,right) {
    this.left = left;
    this.right = right;
    this.data = data;
    this.show = () => {return this.data}
}
```

è¿™ä¸ªå°±æ˜¯äºŒå‰æ ‘çš„æœ€å°ç»“æ„å•å…ƒ

**äºŒå‰æ ‘**

```javascript
function BST() {
    this.root = null //åˆå§‹åŒ–,rootä¸ºnull
}
```

BSTåˆå§‹åŒ–æ—¶ï¼Œåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œä¸”æ²¡æœ‰ä»»ä½•æ•°æ®ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„è§„åˆ™ï¼Œå®šä¹‰ä¸€ä¸ªæ’å…¥æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯:

1. å¦‚æœ`BST.root === null` ï¼Œé‚£ä¹ˆå°±å°†èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹
2. å¦‚æœ`BST.root !==null` ï¼Œå°†æ’å…¥èŠ‚ç‚¹è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼Œå°äºæ ¹èŠ‚ç‚¹ï¼Œæ‹¿åˆ°å·¦è¾¹çš„èŠ‚ç‚¹ï¼Œå¦åˆ™æ‹¿å³è¾¹ï¼Œå†æ¬¡æ¯”è¾ƒã€é€’å½’ã€‚

è¿™é‡Œå°±å‡ºç°äº†é€’å½’äº†ï¼Œå› ä¸ºï¼Œæ€»æ˜¯è¦æŠŠè¾ƒå°çš„æ”¾åœ¨é å·¦çš„åˆ†æ”¯ã€‚æ¢è¨€ä¹‹

**æœ€å·¦å˜çš„å¶å­èŠ‚ç‚¹æ˜¯æœ€å°çš„æ•°ï¼Œæœ€å³çš„å¶å­èŠ‚ç‚¹æ˜¯æœ€å¤§çš„æ•°**

```javascript
function insert(data) {
    var node = new Node(data,null,null);
    if(this.root === null) {
        this.root = node
    } else {
        var current = this.root;
        var parent;
        while(true) {
            parent = current;
            if(data < current.data) {
                current = current.left; //åˆ°å·¦å­æ ‘
                if(current === null) {  //å¦‚æœå·¦å­æ ‘ä¸ºç©ºï¼Œè¯´æ˜å¯ä»¥å°†nodeæ’å…¥åœ¨è¿™é‡Œ
                    parent.left = node;
                    break;  //è·³å‡ºwhileå¾ªç¯
                }
            } else {
                current = current.right;
                if(current === null) {
                    parent.right = node;
                    break;
                }
            }
        }
    }
}
```

è¿™é‡Œï¼Œæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå¾ªç¯æ–¹æ³•ï¼Œä¸æ–­çš„å»å‘å­æ ‘å¯»æ‰¾æ­£ç¡®çš„ä½ç½®ã€‚ å¾ªç¯å’Œé€’å½’éƒ½æœ‰ä¸€ä¸ªæ ¸å¿ƒï¼Œå°±æ˜¯æ‰¾åˆ°å‡ºå£ï¼Œè¿™é‡Œçš„å‡ºå£å°±æ˜¯å½“current ä¸ºnullçš„æ—¶å€™ï¼Œä»£è¡¨æ²¡æœ‰å†…å®¹ï¼Œå¯ä»¥æ’å…¥ã€‚

æ¥ä¸‹æ¥ï¼Œå°†æ­¤æ–¹æ³•å†™å…¥BSTå³å¯:

```javascript
function BST() {
    this.root = null;
    this.insert = insert;
}
```

è¿™æ ·å­ï¼Œå°±å¯ä»¥ä½¿ç”¨äºŒå‰æ ‘è¿™ä¸ªè‡ªå»ºçš„æ•°æ®ç»“æ„äº†:

```javascript
var bst = new BST()ï¼›
bst.insert(10);
bst.insert(8);
bst.insert(2);
bst.insert(7);
bst.insert(5);
```

ä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œæƒ³è¦çœ‹æ ‘ä¸­çš„æ•°æ®ï¼Œä¸æ˜¯é‚£ä¹ˆæ¸…æ™°ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ï¼Œå°±è¦ç”¨åˆ°éå†äº†ã€‚

**æ ‘çš„éå†:**

æŒ‰ç…§æ ¹èŠ‚ç‚¹è®¿é—®çš„é¡ºåºä¸åŒï¼Œæ ‘çš„éå†åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š

- å‰åºéå† (æ ¹èŠ‚ç‚¹->å·¦å­æ ‘->å³å­æ ‘)
- ä¸­åºéå† (å·¦å­æ ‘->æ ¹èŠ‚ç‚¹->å³å­æ ‘)
- ååºéå† (å·¦å­æ ‘->å³å­æ ‘->æ ¹èŠ‚ç‚¹)

**å…ˆåºéå†:**

å…ˆåºéå†æ˜¯ä»¥ä¼˜å…ˆäºåä»£èŠ‚ç‚¹çš„é¡ºåºè®¿é—®æ¯ä¸ªèŠ‚ç‚¹çš„ã€‚å…ˆåºéå†çš„ä¸€ç§åº”ç”¨æ˜¯æ‰“å°ä¸€ä¸ªç»“æ„åŒ–çš„æ–‡æ¡£ã€‚



![å…ˆåºéå†](https://user-gold-cdn.xitu.io/2019/2/24/1691e00c3d7c8b47?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



```javascript
function preOrder(node) {
    if(node !== null) {
        //æ ¹èŠ‚ç‚¹->å·¦å­æ ‘->å³å­æ ‘
        console.log(node.show());
        preOrder(node.left);
        preOrder(node.right);
    }
}
```

**ä¸­åºéå†:**

ä¸­åºéå†æ˜¯ä»¥ä»æœ€å°åˆ°æœ€å¤§çš„é¡ºåºè®¿ é—®æ‰€æœ‰èŠ‚ç‚¹ã€‚ä¸­åºéå†çš„ä¸€ç§åº”ç”¨å°±æ˜¯å¯¹æ ‘è¿›è¡Œæ’åºæ“ä½œã€‚



![ä¸­åºéå†](https://user-gold-cdn.xitu.io/2019/2/24/1691e011441b61ab?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



```javascript
function inOrder(node) {
    if(node !== null) {
        //å¦‚æœä¸æ˜¯nullï¼Œå°±ä¸€ç›´æŸ¥æ‰¾å·¦å˜ï¼Œå› æ­¤é€’å½’
		//å·¦å­æ ‘->æ ¹èŠ‚ç‚¹->å³å­æ ‘
        inOrder(node.left);
        //é€’å½’ç»“æŸï¼Œæ‰“å°å½“å‰å€¼
        console.log(node.show());
        //ä¸Šä¸€æ¬¡é€’å½’å·²ç»æŠŠå·¦è¾¹æå®Œäº†ï¼Œå³è¾¹
        inOrder(node.right);
    }
}
```

**ååºéå†:**

ååºéå†åˆ™æ˜¯å…ˆè®¿é—®èŠ‚ç‚¹çš„åä»£èŠ‚ç‚¹ï¼Œå†è®¿é—®èŠ‚ç‚¹æœ¬èº«ã€‚ååºéå†çš„ä¸€ç§åº”ç”¨æ˜¯è®¡ç®—ä¸€ä¸ªç›®å½•å’Œå®ƒçš„å­ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶æ‰€å ç©ºé—´çš„å¤§å°ã€‚



![ååºéå†](https://user-gold-cdn.xitu.io/2019/2/24/1691e0164e731d33?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



```javascript
function postOrder(node) {
    if(node !== null) {
        //å·¦å­æ ‘->å³å­æ ‘->æ ¹èŠ‚ç‚¹
        postOrder(node.left);
        postOrder(node.right);
        console.log(node.show())
    }
}
```

#####äºŒå‰æ ‘çš„æŸ¥æ‰¾

åœ¨äºŒå‰æ ‘è¿™ç§æ•°æ®ç»“æ„ä¸­è¿›è¡Œæ•°æ®æŸ¥æ‰¾æ˜¯æœ€æ–¹ä¾¿çš„ï¼š

- æœ€å°å€¼ï¼š æœ€å·¦å­æ ‘çš„å¶å­èŠ‚ç‚¹
- æœ€å¤§å€¼ï¼š æœ€å³å­æ ‘çš„å¶å­èŠ‚ç‚¹
- ç‰¹å®šå€¼ï¼š targetä¸currentè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ¯”currentå¤§ï¼Œåœ¨current.rightè¿›è¡ŒæŸ¥æ‰¾ï¼Œåä¹‹ç±»ä¼¼ã€‚

æ¸…æ¥šæ€è·¯åï¼Œå°±åŠ¨æ‰‹æ¥å†™ï¼š

```javascript
//æœ€å°å€¼
function getMin(bst) {
    var current = bst.root;
    while(current.left !== null) {
        current = current.left;
    }
    return current.data;
}

//æœ€å¤§å€¼
function getMax(bst) {
    var current = bst.root;
    while(current.right !== null) {
        current = current.right;
    }
    return current.data;
}
```

æœ€å¤§ã€æœ€å°å€¼éƒ½æ˜¯éå¸¸ç®€å•çš„ï¼Œä¸‹é¢ä¸»è¦çœ‹ä¸‹å¦‚ä½•é€šè¿‡

```javascript
function find(target,bst) {
    var current = bst.root;
    while(current !== null) {
        if(target === current.data) {
            return true;
        }
        else if(target > current.data) {
            current = current.right;
        } else if(target < current.data) {
            current = current.left;
        }
    }
    return -1;
}
```

å…¶å®æ ¸å¿ƒï¼Œä»ç„¶æ˜¯é€šè¿‡ä¸€ä¸ªå¾ªç¯å’Œåˆ¤æ–­ï¼Œæ¥ä¸æ–­çš„å‘ä¸‹å»å¯»æ‰¾ï¼Œè¿™é‡Œçš„æ€æƒ³å…¶å®å’ŒäºŒåˆ†æŸ¥æ‰¾æ˜¯æœ‰ç‚¹ç±»ä¼¼çš„ã€‚

#####AVLæ ‘ï¼š

AVLæ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ŒAVLæ ‘æœ¬è´¨ä¸Šæ˜¯å¸¦äº†å¹³è¡¡åŠŸèƒ½çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆäºŒå‰æ’åºæ ‘ï¼ŒäºŒå‰æœç´¢æ ‘ï¼‰ï¼Œåœ¨AVLæ ‘ä¸­ä»»ä½•èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦æœ€å¤§å·®åˆ«ä¸ºä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§æ ‘ä¼šåœ¨æ·»åŠ æˆ–ç§»é™¤èŠ‚ç‚¹æ—¶å°½é‡è¯•ç€æˆä¸ºä¸€æ£µå®Œå…¨æ ‘ï¼Œæ‰€ä»¥å®ƒä¹Ÿè¢«ç§°ä¸ºé«˜åº¦å¹³è¡¡æ ‘ã€‚æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤åœ¨å¹³å‡å’Œæœ€åæƒ…å†µä¸‹éƒ½æ˜¯ `Oï¼ˆlog nï¼‰`ï¼Œå¢åŠ å’Œåˆ é™¤å¯èƒ½éœ€è¦é€šè¿‡ä¸€æ¬¡æˆ–å¤šæ¬¡æ ‘æ—‹è½¬æ¥é‡æ–°å¹³è¡¡è¿™ä¸ªæ ‘ã€‚

#####çº¢é»‘æ ‘ï¼š

çº¢é»‘æ ‘å’ŒAVLæ ‘ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶é€šè¿‡ç‰¹å®šæ“ä½œä¿æŒäºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³è¡¡ï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æŸ¥æ‰¾æ€§èƒ½ï¼›å®ƒè™½ç„¶æ˜¯å¤æ‚çš„ï¼Œä½†å®ƒçš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¹Ÿæ˜¯éå¸¸è‰¯å¥½çš„ï¼Œå¹¶ä¸”åœ¨å®è·µä¸­æ˜¯é«˜æ•ˆçš„ï¼šå®ƒå¯ä»¥åœ¨`O(log n)`æ—¶é—´å†…åšæŸ¥æ‰¾ï¼Œæ’å…¥å’Œåˆ é™¤ï¼Œè¿™é‡Œçš„ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°ç›®ã€‚

çº¢é»‘æ ‘æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰é¢œè‰²å±æ€§çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œé¢œè‰²æˆ–çº¢è‰²æˆ–é»‘è‰²ã€‚åœ¨äºŒå‰æŸ¥æ‰¾æ ‘å¼ºåˆ¶ä¸€èˆ¬è¦æ±‚ä»¥å¤–ï¼Œå¯¹äºä»»ä½•æœ‰æ•ˆçš„çº¢é»‘æ ‘æˆ‘ä»¬å¢åŠ äº†å¦‚ä¸‹çš„é¢å¤–è¦æ±‚ï¼š

- èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²
- æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
- æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²çš„
- æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ã€‚(ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹)
- ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹

è¿™äº›çº¦æŸå¼ºåˆ¶äº†çº¢é»‘æ ‘çš„å…³é”®æ€§è´¨ï¼šä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿ã€‚ç»“æœæ˜¯è¿™ä¸ªæ ‘å¤§è‡´ä¸Šæ˜¯å¹³è¡¡çš„ã€‚å› ä¸ºæ“ä½œæ¯”å¦‚æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æŸä¸ªå€¼çš„æœ€åæƒ…å†µæ—¶é—´éƒ½è¦æ±‚ä¸æ ‘çš„é«˜åº¦æˆæ¯”ä¾‹ï¼Œè¿™ä¸ªåœ¨é«˜åº¦ä¸Šçš„ç†è®ºä¸Šé™å…è®¸çº¢é»‘æ ‘åœ¨æœ€åæƒ…å†µä¸‹éƒ½æ˜¯é«˜æ•ˆçš„ï¼Œè€Œä¸åŒäºæ™®é€šçš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚

çº¢é»‘æ ‘å’ŒAVLæ ‘ä¸€æ ·éƒ½å¯¹æ’å…¥æ—¶é—´ã€åˆ é™¤æ—¶é—´å’ŒæŸ¥æ‰¾æ—¶é—´æä¾›äº†æœ€å¥½å¯èƒ½çš„æœ€åæƒ…å†µæ‹…ä¿ã€‚è¿™ä¸åªæ˜¯ä½¿å®ƒä»¬åœ¨æ—¶é—´æ•æ„Ÿçš„åº”ç”¨å¦‚å³æ—¶åº”ç”¨(real time application)ä¸­æœ‰ä»·å€¼ï¼Œè€Œä¸”ä½¿å®ƒä»¬æœ‰åœ¨æä¾›æœ€åæƒ…å†µæ‹…ä¿çš„å…¶ä»–æ•°æ®ç»“æ„ä¸­ä½œä¸ºå»ºé€ æ¿å—çš„ä»·å€¼ï¼›ä¾‹å¦‚ï¼Œåœ¨è®¡ç®—å‡ ä½•ä¸­ä½¿ç”¨çš„å¾ˆå¤šæ•°æ®ç»“æ„éƒ½å¯ä»¥åŸºäºçº¢é»‘æ ‘ã€‚ çº¢é»‘æ ‘åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ä¹Ÿç‰¹åˆ«æœ‰ç”¨ï¼Œåœ¨è¿™é‡Œå®ƒä»¬æ˜¯æœ€å¸¸ç”¨çš„æŒä¹…æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œå®ƒä»¬ç”¨æ¥æ„é€ å…³è”æ•°ç»„å’Œé›†åˆï¼Œåœ¨çªå˜ä¹‹åå®ƒä»¬èƒ½ä¿æŒä¸ºä»¥å‰çš„ç‰ˆæœ¬ã€‚é™¤äº†`O(log n)`çš„æ—¶é—´ä¹‹å¤–ï¼Œçº¢é»‘æ ‘çš„æŒä¹…ç‰ˆæœ¬å¯¹æ¯æ¬¡æ’å…¥æˆ–åˆ é™¤éœ€è¦`O(log n)`çš„ç©ºé—´ã€‚

### ä¸å€ŸåŠ©ä¸´æ—¶å˜é‡ï¼Œè¿›è¡Œä¸¤ä¸ªæ•´æ•°çš„äº¤æ¢

**ä¸¾ä¾‹ï¼š**è¾“å…¥ a = 2, b = 4 è¾“å‡º a = 4, b =2

ã€€ã€€è¿™ç§é—®é¢˜éå¸¸å·§å¦™ï¼Œéœ€è¦å¤§å®¶è·³å‡ºæƒ¯æœ‰çš„æ€ç»´ï¼Œåˆ©ç”¨ a , bè¿›è¡Œç½®æ¢ã€‚

ã€€ã€€ä¸»è¦æ˜¯åˆ©ç”¨ + - å»è¿›è¡Œè¿ç®—ï¼Œç±»ä¼¼ a = a + ( b - a) å®é™…ä¸Šç­‰åŒäºæœ€å çš„ a = b;

[![å¤åˆ¶ä»£ç ](https://common.cnblogs.com/images/copycode.gif)](javascript:void(0);)

```javascript
function swap(a , b) {  
  b = b - a;
  a = a + b;
  b = a - b;
  return [a,b];
}

module.exports = swap;  
```

### ä½¿ç”¨canvasç»˜åˆ¶ä¸€ä¸ªæœ‰é™åº¦çš„æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ›²çº¿

![æ–æ³¢é‚£å¥‘æ•°åˆ—æ›²çº¿](https://images2015.cnblogs.com/blog/738658/201707/738658-20170719222015693-961565046.png)

æ•°åˆ—é•¿åº¦é™å®šåœ¨9.

`æ–æ³¢é‚£å¥‘æ•°åˆ—`ï¼Œåˆç§°é»„é‡‘åˆ†å‰²æ•°åˆ—ï¼ŒæŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š0ã€1ã€1ã€2ã€3ã€5ã€8ã€13ã€21ã€34ã€â€¦â€¦åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—ä¸»è¦è€ƒå¯Ÿé€’å½’çš„è°ƒç”¨ã€‚æˆ‘ä»¬ä¸€èˆ¬éƒ½çŸ¥é“å®šä¹‰

```
fibo[i] = fibo[i-1]+fibo[i-2];  
```

ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°ç»„çš„æ–¹æ³•

```javascript
function getFibonacci(n) {  
  var fibarr = [];
  var i = 0;
  while(i<n) {
    if(i<=1) {
      fibarr.push(i);
    }else{
      fibarr.push(fibarr[i-1] + fibarr[i-2])
    }
    i++;
  }

  return fibarr;
}
```

å‰©ä½™çš„å·¥ä½œå°±æ˜¯åˆ©ç”¨canvas `arc`æ–¹æ³•è¿›è¡Œæ›²çº¿ç»˜åˆ¶äº†ã€‚

### æ‰¾å‡ºæ•°ç»„çš„æœ€å¤§å·®å€¼

**æ¯”å¦‚ï¼š** è¾“å…¥ [10,5,11,7,8,9]  è¾“å‡º 6

è¿™æ˜¯é€šè¿‡ä¸€é“é¢˜ç›®å»æµ‹è¯•å¯¹äºåŸºæœ¬çš„æ•°ç»„çš„æœ€å¤§å€¼çš„æŸ¥æ‰¾ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬çŸ¥é“ï¼Œæœ€å¤§å·®å€¼è‚¯å®šæ˜¯ä¸€ä¸ªæ•°ç»„ä¸­æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®ã€‚

```javascript
function getMaxProfit(arr) {

    var minPrice = arr[0];
    var maxProfit = 0;

    for (var i = 0; i < arr.length; i++) {
        var currentPrice = arr[i];

        minPrice = Math.min(minPrice, currentPrice);

        var potentialProfit = currentPrice - minPrice;

        maxProfit = Math.max(maxProfit, potentialProfit);
    }

    return maxProfit;
}
```

### éšæœºç”ŸæˆæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²

å®ç°ä¸€ä¸ªç®—æ³•ï¼Œéšæœºç”ŸæˆæŒ‡åˆ¶å®šé•¿åº¦çš„å­—ç¬¦çªœã€‚

**æ¯”å¦‚ï¼š**ç»™å®š é•¿åº¦ 8 è¾“å‡º 4ldkfg9j

```javascript
function randomString(n) {  
  let str = 'abcdefghijklmnopqrstuvwxyz9876543210';
  let tmp = '',
      i = 0,
      l = str.length;
  for (i = 0; i < n; i++) {
    tmp += str.charAt(Math.floor(Math.random() * l));
  }
  return tmp;
}

module.exports = randomString;  
```

### å®ç°ç±»ä¼¼getElementsByClassNameçš„åŠŸèƒ½

è‡ªå·±å®ç°ä¸€ä¸ªå‡½æ•°ï¼ŒæŸ¥æ‰¾æŸä¸ªDOMèŠ‚ç‚¹ä¸‹é¢çš„åŒ…å«æŸä¸ªclassçš„æ‰€æœ‰DOMèŠ‚ç‚¹ï¼Ÿä¸å…è®¸ä½¿ç”¨åŸç”Ÿæä¾›çš„ getElementsByClassName querySelectorAll ç­‰åŸç”Ÿæä¾›DOMæŸ¥æ‰¾å‡½æ•°ã€‚

```javascript
function queryClassName(node, name) {  
  var starts = '(^|[ \n\r\t\f])',
       ends = '([ \n\r\t\f]|$)';
  var array = [],
        regex = new RegExp(starts + name + ends),
        elements = node.getElementsByTagName("*"),
        length = elements.length,
        i = 0,
        element;

    while (i < length) {
        element = elements[i];
        if (regex.test(element.className)) {
            array.push(element);
        }

        i += 1;
    }

    return array;
}
```

### ä½¿ç”¨JSå®ç°äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰

ä¸€èˆ¬å«å…¨éƒ¨å†™å®Œçš„æ¦‚ç‡æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯é‡ç‚¹è€ƒå¯Ÿä½ å¯¹å®ƒçš„ç†è§£å’Œä¸€äº›åŸºæœ¬ç‰¹ç‚¹çš„å®ç°ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¹Ÿç§°äºŒå‰æœç´¢æ ‘ã€æœ‰åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šordered binary treeï¼‰æ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š

- ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›
- ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›
- ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›
- æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚äºŒå‰æŸ¥æ‰¾æ ‘ç›¸æ¯”äºå…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ã€æ’å…¥çš„æ—¶é—´å¤æ‚åº¦è¾ƒä½ã€‚ä¸ºO(log n)ã€‚äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯åŸºç¡€æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºæ„å»ºæ›´ä¸ºæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå¦‚é›†åˆã€multisetã€å…³è”æ•°ç»„ç­‰ã€‚

![img](https://images2015.cnblogs.com/blog/738658/201707/738658-20170719222527693-1678554844.png)

 

  åœ¨å†™çš„æ—¶å€™éœ€è¦è¶³å¤Ÿç†è§£äºŒå‰æœç´ æ ‘çš„ç‰¹ç‚¹ï¼Œéœ€è¦å…ˆè®¾å®šå¥½æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®ç»“æ„

```javascript
class Node {  
  constructor(data, left, right) {
    this.data = data;
    this.left = left;
    this.right = right;
  }
}
```

æ ‘æ˜¯æœ‰èŠ‚ç‚¹æ„æˆï¼Œç”±æ ¹èŠ‚ç‚¹é€æ¸å»¶ç”Ÿåˆ°å„ä¸ªå­èŠ‚ç‚¹ï¼Œå› æ­¤å®ƒå…·å¤‡åŸºæœ¬çš„ç»“æ„å°±æ˜¯å…·å¤‡ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå…·å¤‡æ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•.

```javascript
class BinarySearchTree {

  constructor() {
    this.root = null;
  }

  insert(data) {
    let n = new Node(data, null, null);
    if (!this.root) {
      return this.root = n;
    }
    let currentNode = this.root;
    let parent = null;
    while (1) {
      parent = currentNode;
      if (data < currentNode.data) {
        currentNode = currentNode.left;
        if (currentNode === null) {
          parent.left = n;
          break;
        }
      } else {
        currentNode = currentNode.right;
        if (currentNode === null) {
          parent.right = n;
          break;
        }
      }
    }
  }

  remove(data) {
    this.root = this.removeNode(this.root, data)
  }

  removeNode(node, data) {
    if (node == null) {
      return null;
    }

    if (data == node.data) {
      // no children node
      if (node.left == null && node.right == null) {
        return null;
      }
      if (node.left == null) {
        return node.right;
      }
      if (node.right == null) {
        return node.left;
      }

      let getSmallest = function(node) {
        if(node.left === null && node.right == null) {
          return node;
        }
        if(node.left != null) {
          return node.left;
        }
        if(node.right !== null) {
          return getSmallest(node.right);
        }

      }
      let temNode = getSmallest(node.right);
      node.data = temNode.data;
      node.right = this.removeNode(temNode.right,temNode.data);
      return node;

    } else if (data < node.data) {
      node.left = this.removeNode(node.left,data);
      return node;
    } else {
      node.right = this.removeNode(node.right,data);
      return node;
    }
  }

  find(data) {
    var current = this.root;
    while (current != null) {
      if (data == current.data) {
        break;
      }
      if (data < current.data) {
        current = current.left;
      } else {
        current = current.right
      }
    }
    return current.data;
  }

}

module.exports = BinarySearchTree;  
```

## ä¸ƒã€æŸ¯é‡ŒåŒ–

æœ€è¿‘ï¼Œæœ‹å‹T åœ¨å‡†å¤‡é¢è¯•ï¼Œä»–ä¸ºä¸€é“ç¼–ç¨‹é¢˜æ‰€å›°ï¼Œå‘æˆ‘æ±‚åŠ©ã€‚åŸé¢˜å¦‚ä¸‹ï¼š

```javascript
// å†™ä¸€ä¸ª sum æ–¹æ³•ï¼Œå½“ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•è°ƒç”¨æ—¶ï¼Œèƒ½æ­£å¸¸å·¥ä½œ
console.log(sum(2, 3)); // Outputs 5
console.log(sum(2)(3)); // Outputs 5
```

è¿™é“é¢˜è¦è€ƒå¯Ÿçš„ï¼Œå°±æ˜¯å¯¹å‡½æ•°æŸ¯é‡ŒåŒ–çš„ç†è§£ã€‚è®©æˆ‘ä»¬å…ˆæ¥è§£æä¸€ä¸‹é¢˜ç›®çš„è¦æ±‚ï¼š

- å¦‚æœä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬åªéœ€å°†å®ƒä»¬ç›¸åŠ å¹¶è¿”å›ã€‚
- å¦åˆ™ï¼Œæˆ‘ä»¬å‡è®¾å®ƒæ˜¯ä»¥sum(2)(3)çš„å½¢å¼è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒå°†ä¼ é€’ç»™sum()ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º2ï¼‰çš„å‚æ•°å’Œä¼ é€’ç»™åŒ¿åå‡½æ•°çš„å‚æ•°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º3ï¼‰ã€‚

æ‰€ä»¥ï¼Œsum å‡½æ•°å¯ä»¥è¿™æ ·å†™ï¼š

```javascript
function sum (x) {
    if (arguments.length == 2) {
        return arguments[0] + arguments[1];
    }
    
    return function(y) {
        return x + y;
    }
}
```

arguments çš„ç”¨æ³•æŒºçµæ´»çš„ï¼Œåœ¨è¿™é‡Œå®ƒåˆ™ç”¨äºåˆ†å‰²ä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚å½“å‚æ•°åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œè¿›è¡ŒæŸ¯é‡ŒåŒ–çš„å¤„ç†ã€‚

é‚£ä¹ˆï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯å‡½æ•°çš„æŸ¯é‡ŒåŒ–å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»æ¦‚å¿µå‡ºå‘ï¼Œæ¢ç©¶å‡½æ•°æŸ¯é‡ŒåŒ–çš„å®ç°ä¸ç”¨é€”ã€‚

###ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–

æŸ¯é‡ŒåŒ–ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒæ—¢èƒ½å‡å°‘ä»£ç å†—ä½™ï¼Œä¹Ÿèƒ½å¢åŠ å¯è¯»æ€§ã€‚å¦å¤–ï¼Œé™„å¸¦ç€è¿˜èƒ½ç”¨æ¥è£…é€¼ã€‚

å…ˆç»™å‡ºæŸ¯é‡ŒåŒ–çš„å®šä¹‰ï¼šåœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†ä½¿ç”¨å¤šä¸ªå‚æ•°çš„ä¸€ä¸ªå‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ã€‚

æŸ¯é‡ŒåŒ–çš„å®šä¹‰ï¼Œç†è§£èµ·æ¥æœ‰ç‚¹è´¹åŠ²ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œå…ˆçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```javascript
function sum (a, b, c) {
    console.log(a + b + c);
}
sum(1, 2, 3); // 6
```

æ¯«æ— ç–‘é—®ï¼Œsum æ˜¯ä¸ªç®€å•çš„ç´¯åŠ å‡½æ•°ï¼Œæ¥å—3ä¸ªå‚æ•°ï¼Œè¾“å‡ºç´¯åŠ çš„ç»“æœã€‚

å‡è®¾æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œsumçš„å‰2ä¸ªå‚æ•°ä¿æŒä¸å˜ï¼Œæœ€åä¸€ä¸ªå‚æ•°å¯ä»¥éšæ„ã€‚é‚£ä¹ˆå°±ä¼šæƒ³åˆ°ï¼Œåœ¨å‡½æ•°å†…ï¼Œæ˜¯å¦å¯ä»¥æŠŠå‰2ä¸ªå‚æ•°çš„ç›¸åŠ è¿‡ç¨‹ï¼Œç»™æŠ½ç¦»å‡ºæ¥ï¼Œå› ä¸ºå‚æ•°éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½åšè¿ç®—ã€‚

å¦‚æœå…ˆä¸ç®¡å‡½æ•°å†…çš„å…·ä½“å®ç°ï¼Œè°ƒç”¨çš„å†™æ³•å¯ä»¥æ˜¯è¿™æ ·ï¼š `sum(1, 2)(3);` æˆ–è¿™æ · `sum(1, 2)(10);` ã€‚å°±æ˜¯ï¼Œå…ˆæŠŠå‰2ä¸ªå‚æ•°çš„è¿ç®—ç»“æœæ‹¿åˆ°åï¼Œå†ä¸ç¬¬3ä¸ªå‚æ•°ç›¸åŠ ã€‚

è¿™å…¶å®å°±æ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–çš„ç®€å•åº”ç”¨ã€‚

###æŸ¯é‡ŒåŒ–çš„å®ç°

`sum(1, 2)(3);` è¿™æ ·çš„å†™æ³•ï¼Œå¹¶ä¸å¸¸è§ã€‚æ‹†å¼€æ¥çœ‹ï¼Œ`sum(1, 2)` è¿”å›çš„åº”è¯¥è¿˜æ˜¯ä¸ªå‡½æ•°ï¼Œå› ä¸ºåé¢è¿˜æœ‰ `(3)` éœ€è¦æ‰§è¡Œã€‚

é‚£ä¹ˆåè¿‡æ¥ï¼Œä»æœ€åä¸€ä¸ªå‚æ•°ï¼Œä»å³å¾€å·¦çœ‹ï¼Œå®ƒçš„å·¦ä¾§å¿…ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœå‰é¢æœ‰nä¸ª()ï¼Œé‚£å°±æ˜¯æœ‰nä¸ªå‡½æ•°è¿”å›äº†ç»“æœï¼Œåªæ˜¯è¿”å›çš„ç»“æœï¼Œè¿˜æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹é€’å½’çš„æ„æ€ï¼Ÿ

ç½‘ä¸Šæœ‰ä¸€äº›ä¸åŒçš„æŸ¯é‡ŒåŒ–çš„å®ç°æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯ä¸ªäººè§‰å¾—æœ€å®¹æ˜“ç†è§£çš„å†™æ³•ï¼š

```javascript
function curry (fn, currArgs) {
    return function() {
        let args = [].slice.call(arguments);

        // é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œè‹¥æœªæä¾›æœ€åä¸€ä¸ªå‚æ•°currArgsï¼Œåˆ™ä¸ç”¨è¿›è¡Œargsçš„æ‹¼æ¥
        if (currArgs !== undefined) {
            args = args.concat(currArgs);
        }

        // é€’å½’è°ƒç”¨
        if (args.length < fn.length) {
            return curry(fn, args);
        }

        // é€’å½’å‡ºå£
        return fn.apply(null, args);
    }
}
```

è§£æä¸€ä¸‹ curry å‡½æ•°çš„å†™æ³•ï¼š

é¦–å…ˆï¼Œå®ƒæœ‰ 2 ä¸ªå‚æ•°ï¼Œfn æŒ‡çš„å°±æ˜¯æœ¬æ–‡ä¸€å¼€å§‹çš„æºå¤„ç†å‡½æ•° `sum`ã€‚currArgs æ˜¯è°ƒç”¨ curry æ—¶ä¼ å…¥çš„å‚æ•°åˆ—è¡¨ï¼Œæ¯”å¦‚ `(1, 2)(3)` è¿™æ ·çš„ã€‚

å†çœ‹åˆ° curry å‡½æ•°å†…éƒ¨ï¼Œå®ƒä¼šæ•´ä¸ªè¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚

å†æ¥ä¸‹æ¥çš„ `let args = [].slice.call(arguments);`ï¼Œæ„æ€æ˜¯å°† arguments æ•°ç»„åŒ–ã€‚arguments æ˜¯ä¸€ä¸ªç±»æ•°ç»„çš„ç»“æ„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªçœŸçš„æ•°ç»„ï¼Œæ‰€ä»¥æ²¡æ³•ä½¿ç”¨æ•°ç»„çš„æ–¹æ³•ã€‚æˆ‘ä»¬ç”¨äº† call çš„æ–¹æ³•ï¼Œå°±èƒ½æ„‰å¿«åœ°å¯¹ args ä½¿ç”¨æ•°ç»„çš„åŸç”Ÿæ–¹æ³•äº†ã€‚åœ¨è¿™ç¯‡ [ã€Œå¹²è´§ã€ç»†è¯´ callã€apply ä»¥åŠ bind çš„åŒºåˆ«å’Œç”¨æ³•](https://juejin.im/post/5c493086f265da6115111ce4) ä¸­ï¼Œæœ‰å…³äº call æ›´è¯¦ç»†çš„ç”¨æ³•ä»‹ç»ã€‚

`currArgs !== undefined` çš„åˆ¤æ–­ï¼Œæ˜¯ä¸ºäº†è§£å†³é€’å½’è°ƒç”¨æ—¶çš„å‚æ•°æ‹¼æ¥ã€‚

æœ€åï¼Œåˆ¤æ–­ args çš„ä¸ªæ•°ï¼Œæ˜¯å¦ä¸ fn (ä¹Ÿå°±æ˜¯ sum )çš„å‚æ•°ä¸ªæ•°ç›¸ç­‰ï¼Œç›¸ç­‰äº†å°±å¯ä»¥æŠŠå‚æ•°éƒ½ä¼ ç»™ fnï¼Œè¿›è¡Œè¾“å‡ºï¼›å¦åˆ™ï¼Œç»§ç»­é€’å½’è°ƒç”¨ï¼Œç›´åˆ°ä¸¤è€…ç›¸ç­‰ã€‚

æµ‹è¯•ä¸€ä¸‹ï¼š

```javascript
function sum(a, b, c) {
    console.log(a + b + c);
}

const fn = curry(sum);

fn(1, 2, 3); // 6
fn(1, 2)(3); // 6
fn(1)(2, 3); // 6
fn(1)(2)(3); // 6
```

éƒ½èƒ½è¾“å‡º 6 äº†ï¼Œæå®šï¼

###æŸ¯é‡ŒåŒ–çš„ç”¨é€”

ç†è§£äº†æŸ¯é‡ŒåŒ–çš„å®ç°ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®é™…åº”ç”¨ã€‚æŸ¯é‡ŒåŒ–çš„ç›®çš„æ˜¯ï¼Œå‡å°‘ä»£ç å†—ä½™ï¼Œä»¥åŠå¢åŠ ä»£ç çš„å¯è¯»æ€§ã€‚æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```javascript
const persons = [
    { name: 'kevin', age: 4 },
    { name: 'bob', age: 5 }
];

// è¿™é‡Œçš„ curry å‡½æ•°ï¼Œä¹‹å‰å·²å®ç°
const getProp = curry(function (obj, index) {
    const args = [].slice.call(arguments);
    return obj[args[args.length - 1]];
});

const ages = persons.map(getProp('age')); // [4, 5]
const names = persons.map(getProp('name')); // ['kevin', 'bob']
```

åœ¨å®é™…çš„ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¸¸ä¼šé‡åˆ°ç±»ä¼¼çš„åˆ—è¡¨æ•°æ®ã€‚ç”¨ getProp å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ï¼Œå–å‡ºåˆ—è¡¨ä¸­æŸä¸ª key å¯¹åº”çš„å€¼ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`const names = persons.map(getProp('name'));` æ‰§è¡Œè¿™æ¡è¯­å¥æ—¶ getProp çš„å‚æ•°åªæœ‰ä¸€ä¸ª `name`ï¼Œè€Œå®šä¹‰ getProp æ–¹æ³•æ—¶ï¼Œä¼ å…¥ curry çš„å‚æ•°æœ‰2ä¸ªï¼Œ`obj` å’Œ `index`ï¼ˆè¿™é‡Œå¿…é¡»å†™ 2 ä¸ªåŠä»¥ä¸Šçš„å‚æ•°ï¼‰ã€‚

ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼Ÿå…³é”®å°±åœ¨äº `arguments` çš„éšå¼ä¼ å‚ã€‚

```javascript
const getProp = curry(function (obj, index) {
    console.log(arguments);
    // ä¼šè¾“å‡º4ä¸ªç±»æ•°ç»„ï¼Œå–å…¶ä¸­ä¸€ä¸ªæ¥çœ‹
    // {
    //     0: {name: "kevin", age: 4},
    //     1: 0,
    //     2: [
    //         {name: "kevin", age: 4},
    //         {name: "bob", age: 5}
    //     ],
    //     3: "age"
    // }
});
```

map æ˜¯ Array çš„åŸç”Ÿæ–¹æ³•ï¼Œå®ƒçš„ç”¨æ³•å¦‚ä¸‹ï¼š

```javascript
var new_array = arr.map(function callback(currentValue[, index[, array]]) {
    // Return element for new_array
}[, thisArg]);
```

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼ å…¥çš„ `name`ï¼Œå°±æ’åœ¨äº† arguments çš„æœ€åã€‚ä¸ºäº†æ‹¿åˆ° `name` å¯¹åº”çš„å€¼ï¼Œéœ€è¦å¯¹ç±»æ•°ç»„ arguments åšç‚¹è½¬æ¢ï¼Œè®©å®ƒå¯ä»¥ä½¿ç”¨ Array çš„åŸç”Ÿæ–¹æ³•ã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆ getProp æ–¹æ³•å®šä¹‰æˆäº†è¿™æ ·ï¼š

```javascript
const getProp = curry(function (obj, index) {
    const args = [].slice.call(arguments);
    return obj[args[args.length - 1]];
});
```

å½“ç„¶ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§å†™æ³•ï¼Œcurry çš„å®ç°æ›´å¥½ç†è§£ï¼Œä½†æ˜¯è°ƒç”¨çš„ä»£ç å´å˜å¤šäº†ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œå–èˆã€‚

```javascript
const getProp = curry(function (key, obj) {
    return obj[key];
});

const ages = persons.map(item => {
    return getProp(item)('age');
});
const names = persons.map(item => {
    return getProp(item)('name');
});
```

æœ€åï¼Œæ¥çœ‹ä¸€ä¸ª Memoization çš„ä¾‹å­ã€‚å®ƒç”¨äºä¼˜åŒ–æ¯”è¾ƒè€—æ—¶çš„è®¡ç®—ï¼Œé€šè¿‡å°†è®¡ç®—ç»“æœç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å¯¹äºåŒæ ·çš„è¾“å…¥å€¼ï¼Œä¸‹æ¬¡åªéœ€è¦ä¸­å†…å­˜ä¸­è¯»å–ç»“æœã€‚

```javascript
function memoizeFunction(func) {
    const cache = {};
    return function() {
        let key = arguments[0];
        if (cache[key]) {
            return cache[key];
        } else {
            const val = func.apply(null, arguments);
            cache[key] = val;
            return val;
        }
    };
}

const fibonacci = memoizeFunction(function(n) {
    return (n === 0 || n === 1) ? n : fibonacci(n - 1) + fibonacci(n - 2);
});

console.log(fibonacci(100)); // è¾“å‡º354224848179262000000
console.log(fibonacci(100)); // è¾“å‡º354224848179262000000
```

ä»£ç ä¸­ï¼Œç¬¬2æ¬¡è®¡ç®— fibonacci(100) åˆ™åªéœ€è¦åœ¨å†…å­˜ä¸­ç›´æ¥è¯»å–ç»“æœã€‚

###æ€»ç»“

**å‡½æ•°çš„æŸ¯é‡ŒåŒ–ï¼Œæ˜¯ Javascript ä¸­å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒè¿”å›çš„ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ã€‚å…¶å®ç°æ–¹å¼ï¼Œéœ€è¦ä¾èµ–å‚æ•°ä»¥åŠé€’å½’ï¼Œé€šè¿‡æ‹†åˆ†å‚æ•°çš„æ–¹å¼ï¼Œæ¥è°ƒç”¨ä¸€ä¸ªå¤šå‚æ•°çš„å‡½æ•°æ–¹æ³•ï¼Œä»¥è¾¾åˆ°å‡å°‘ä»£ç å†—ä½™ï¼Œå¢åŠ å¯è¯»æ€§çš„ç›®çš„ã€‚**

## å…«ã€Arrayçš„æ–¹æ³•ä»‹ç»

###ES5 ä¸­ Array æ“ä½œ

#### 1ã€forEach

Array æ–¹æ³•ä¸­æœ€åŸºæœ¬çš„ä¸€ä¸ªï¼Œå°±æ˜¯éå†ï¼Œå¾ªç¯ã€‚åŸºæœ¬ç”¨æ³•ï¼š`[].forEach(function(item, index, array) {});`

```javascript
const array = [1, 2, 3];
const result = [];

array.forEach(function(item) {
    result.push(item);
});
console.log(result); // [1, 2, 3]
```

#### 2ã€map

map æ–¹æ³•çš„ä½œç”¨ä¸éš¾ç†è§£ï¼Œâ€œæ˜ å°„â€å˜›ï¼Œä¹Ÿå°±æ˜¯åŸæ•°ç»„è¢« â€œæ˜ å°„â€ æˆå¯¹åº”çš„æ–°æ•°ç»„ã€‚åŸºæœ¬ç”¨æ³•è·Ÿ forEach æ–¹æ³•ç±»ä¼¼ï¼š`[].map(function(item, index, array) {});` ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯æ•°å€¼é¡¹æ±‚å¹³æ–¹ï¼š

```javascript
const data = [1, 2, 3, 4];
const arrayOfSquares = data.map(function (item) {
    return item * item;
});
alert(arrayOfSquares); // 1, 4, 9, 16
```

#### 3ã€filter

filter ä¸º â€œè¿‡æ»¤â€ã€â€œç­›é€‰â€ ä¹‹æ„ã€‚æŒ‡æ•°ç»„ filter åï¼Œè¿”å›è¿‡æ»¤åçš„æ–°æ•°ç»„ã€‚ç”¨æ³•è·Ÿ map æä¸ºç›¸ä¼¼ï¼š`[].filter(function(item, index, array) {});`

filter çš„ callback å‡½æ•°ï¼Œéœ€è¦è¿”å›å¸ƒå°”å€¼ true æˆ– falseã€‚è¿”å›å€¼åªè¦ **å¼±ç­‰äº** Boolean å°±è¡Œï¼Œçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```javascript
const data = [0, 1, 2, 3];
const arrayFilter = data.filter(function(item) {
    return item;
});
console.log(arrayFilter); // [1, 2, 3]
```

#### 4ã€some å’Œ every

some æ„æŒ‡â€œæŸäº›â€ï¼ŒæŒ‡æ˜¯å¦ â€œæŸäº›é¡¹â€ åˆä¹æ¡ä»¶ã€‚ä¹Ÿå°±æ˜¯ **åªè¦æœ‰1å€¼ä¸ªè®© callback è¿”å› true**  å°±è¡Œäº†ã€‚åŸºæœ¬ç”¨æ³•ï¼š`[].som(function(item, index, array) {});`

```javascript
const scores = [5, 8, 3, 10];
const current = 7;

function higherThanCurrent(score) {
    return score > current;
}

if (scores.some(higherThanCurrent)) {
    alert("one more");
}
```

every è·Ÿ some æ˜¯ä¸€å¯¹å¥½åŸºå‹ï¼ŒåŒæ ·æ˜¯è¿”å› Boolean å€¼ã€‚ä½†å¿…é¡»æ»¡è¶³æ¯ 1 ä¸ªå€¼éƒ½è¦è®© callback è¿”å› true æ‰è¡Œã€‚æ”¹åŠ¨ä¸€ä¸‹ä¸Šé¢ some çš„ä¾‹å­ï¼š

```javascript
if (scores.every(higherThanCurrent)) {
    console.log("every is ok!");
} else {
    console.log("oh no!");        
}
```

#### 5ã€concat

concat() æ–¹æ³•ç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•ä¸ä¼šæ”¹å˜ç°æœ‰çš„æ•°ç»„ï¼Œä»…ä¼šè¿”å›è¢«è¿æ¥æ•°ç»„çš„ä¸€ä¸ªå‰¯æœ¬ã€‚

```javascript
const arr1 = [1,2,3];
const arr2 = [4,5];
const arr3 = arr1.concat(arr2);
console.log(arr1); // [1, 2, 3]
console.log(arr3); // [1, 2, 3, 4, 5]
```

#### 6ã€indexOf å’Œ lastIndexOf

indexOf æ–¹æ³•åœ¨å­—ç¬¦ä¸²ä¸­è‡ªå¤å°±æœ‰ï¼Œstring.indexOf(searchString, position)ã€‚æ•°ç»„è¿™é‡Œçš„ indexOf æ–¹æ³•ä¸ä¹‹ç±»ä¼¼ã€‚ è¿”å›æ•´æ•°ç´¢å¼•å€¼ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰ï¼Œè¿”å›-1.

fromIndexå¯é€‰ï¼Œè¡¨ç¤ºä»è¿™ä¸ªä½ç½®å¼€å§‹æœç´¢ï¼Œè‹¥ç¼ºçœæˆ–æ ¼å¼ä¸åˆè¦æ±‚ï¼Œä½¿ç”¨é»˜è®¤å€¼0ã€‚

```javascript
const data = [2, 5, 7, 3, 5];
console.log(data.indexOf(5, "x"));  // 1 ("x"è¢«å¿½ç•¥)
console.log(data.indexOf(5, "3")); // 4 (ä»3å·ä½å¼€å§‹æœç´¢)

console.log(data.indexOf(4));    // -1 (æœªæ‰¾åˆ°)
console.log(data.indexOf("5")); // -1 (æœªæ‰¾åˆ°ï¼Œå› ä¸º5 !== "5")
```

lastIndexOf åˆ™æ˜¯ä»åå¾€å‰æ‰¾ã€‚

```javascript
const numbers = [2, 5, 9, 2];
numbers.lastIndexOf(2);     // 3
numbers.lastIndexOf(7);     // -1
numbers.lastIndexOf(2, 3);  // 3
numbers.lastIndexOf(2, 2);  // 0
numbers.lastIndexOf(2, -2); // 0
numbers.lastIndexOf(2, -1); // 3
```

#### 7ã€reduce å’Œ reduceRight

reduce æ˜¯JavaScript 1.8 ä¸­æ‰å¼•å…¥çš„ï¼Œä¸­æ–‡æ„æ€ä¸ºâ€œå½’çº¦â€ã€‚åŸºæœ¬ç”¨æ³•ï¼š`reduce(callback[, initialValue])`

callback å‡½æ•°æ¥å—4ä¸ªå‚æ•°ï¼šä¹‹å‰å€¼(previousValue)ã€å½“å‰å€¼(currentValue)ã€ç´¢å¼•å€¼(currentIndex)ä»¥åŠæ•°ç»„æœ¬èº«(array)ã€‚

å¯é€‰çš„åˆå§‹å€¼(initialValue)ï¼Œä½œä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨å›è°ƒå‡½æ•°æ—¶ä¼ ç»™previousValueçš„å€¼ã€‚ä¹Ÿå°±æ˜¯ï¼Œä¸ºç´¯åŠ ç­‰æ“ä½œä¼ å…¥èµ·å§‹å€¼ï¼ˆé¢å¤–çš„åŠ å€¼ï¼‰ã€‚

```javascript
var sum = [1, 2, 3, 4].reduce(function (previous, current, index, array) {
    return previous + current;
});
console.log(sum); // 10
```

è§£æï¼š

- å› ä¸ºinitialValueä¸å­˜åœ¨ï¼Œå› æ­¤ä¸€å¼€å§‹çš„previouså€¼ç­‰äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
- ä»è€Œ current å€¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™å°±æ˜¯2
- æœ€åä¸¤ä¸ªå‚æ•°ä¸ºç´¢å¼•å€¼ index ä»¥åŠæ•°ç»„æœ¬èº« array

ä»¥ä¸‹ä¸ºå¾ªç¯æ‰§è¡Œè¿‡ç¨‹ï¼š

```javascript
// åˆå§‹è®¾ç½®
previous = initialValue = 1, current = 2

// ç¬¬ä¸€æ¬¡è¿­ä»£
previous = (1 + 2) =  3, current = 3

// ç¬¬äºŒæ¬¡è¿­ä»£
previous = (3 + 3) =  6, current = 4

// ç¬¬ä¸‰æ¬¡è¿­ä»£
previous = (6 + 4) =  10, current = undefined (é€€å‡º)
```

æœ‰äº†reduceï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å®ç°äºŒç»´æ•°ç»„çš„æ‰å¹³åŒ–ï¼š

```javascript
var matrix = [
  [1, 2],
  [3, 4],
  [5, 6]
];

// äºŒç»´æ•°ç»„æ‰å¹³åŒ–
var flatten = matrix.reduce(function (previous, current) {
    return previous.concat(current);
});
console.log(flatten); // [1, 2, 3, 4, 5, 6]
```

reduceRight è·Ÿ reduce ç›¸æ¯”ï¼Œç”¨æ³•ç±»ä¼¼ã€‚å®ç°ä¸Šå·®å¼‚åœ¨äºreduceRightæ˜¯ä»æ•°ç»„çš„æœ«å°¾å¼€å§‹å®ç°ã€‚

```javascript
const data = [1, 2, 3, 4];
const specialDiff = data.reduceRight(function (previous, current, index) {
    if (index == 0) {
        return previous + current;
    }
    return previous - current;
});
console.log(specialDiff);  // 0
```

#### 8ã€push å’Œ pop

push() æ–¹æ³•å¯å‘æ•°ç»„çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œè¿”å›çš„æ˜¯æ–°çš„æ•°ç»„é•¿åº¦ï¼Œä¼šæ”¹å˜åŸæ•°ç»„ã€‚

```javascript
const a = [2,3,4];
const b = a.push(5);
console.log(a);  // [2,3,4,5]
console.log(b);  // 4
// pushæ–¹æ³•å¯ä»¥ä¸€æ¬¡æ·»åŠ å¤šä¸ªå…ƒç´ push(data1, data2....)
```

pop() æ–¹æ³•ç”¨äºåˆ é™¤å¹¶è¿”å›æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚è¿”å›çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¼šæ”¹å˜åŸæ•°ç»„ã€‚

```javascript
const arr = [2,3,4];
console.log(arr.pop()); // 4
console.log(arr);  // [2,3]
```

#### 9ã€shift å’Œ unshift

shift() æ–¹æ³•ç”¨äºæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä»å…¶ä¸­åˆ é™¤ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ”¹å˜åŸæ•°ç»„ã€‚

```javascript
const arr = [2,3,4];
console.log(arr.shift()); // 2
console.log(arr);  // [3,4]
```

unshift() æ–¹æ³•å¯å‘æ•°ç»„çš„å¼€å¤´æ·»åŠ ä¸€ä¸ªæˆ–æ›´å¤šå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦ã€‚è¿”å›æ–°é•¿åº¦ï¼Œæ”¹å˜åŸæ•°ç»„ã€‚

```javascript
const arr = [2,3,4,5];
console.log(arr.unshift(3,6)); // 6
console.log(arr); // [3, 6, 2, 3, 4, 5]
// tip:è¯¥æ–¹æ³•å¯ä»¥ä¸ä¼ å‚æ•°,ä¸ä¼ å‚æ•°å°±æ˜¯ä¸å¢åŠ å…ƒç´ ã€‚
```

#### 10ã€slice å’Œ splice

slice() è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒåŒ…å«ä» start åˆ° end ï¼ˆä¸åŒ…æ‹¬è¯¥å…ƒç´ ï¼‰çš„ arrayObject ä¸­çš„å…ƒç´ ã€‚è¿”å›é€‰å®šçš„å…ƒç´ ï¼Œè¯¥æ–¹æ³•ä¸ä¼šä¿®æ”¹åŸæ•°ç»„ã€‚

```javascript
const arr = [2,3,4,5];
console.log(arr.slice(1,3));  // [3,4]
console.log(arr);  // [2,3,4,5]
```

splice() å¯åˆ é™¤ä» index å¤„å¼€å§‹çš„é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç”¨å‚æ•°åˆ—è¡¨ä¸­å£°æ˜çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ¥æ›¿æ¢é‚£äº›è¢«åˆ é™¤çš„å…ƒç´ ã€‚å¦‚æœä» arrayObject ä¸­åˆ é™¤äº†å…ƒç´ ï¼Œåˆ™è¿”å›çš„æ˜¯å«æœ‰è¢«åˆ é™¤çš„å…ƒç´ çš„æ•°ç»„ã€‚splice() æ–¹æ³•ä¼šç›´æ¥å¯¹æ•°ç»„è¿›è¡Œä¿®æ”¹ã€‚

```javascript
const a = [5,6,7,8];
console.log(a.splice(1,0,9)); //[]
console.log(a);  // [5, 9, 6, 7, 8]

const b = [5,6,7,8];
console.log(b.splice(1,2,3));  //v[6, 7]
console.log(b); // [5, 3, 8]
```

#### 11ã€sort å’Œ reverse

sort() æŒ‰ç…§ Unicode code ä½ç½®æ’åºï¼Œé»˜è®¤å‡åºã€‚

```javascript
const fruit = ['cherries', 'apples', 'bananas'];
fruit.sort(); // ['apples', 'bananas', 'cherries']

const scores = [1, 10, 21, 2];
scores.sort(); // [1, 10, 2, 21]
```

reverse() æ–¹æ³•ç”¨äºé¢ å€’æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºã€‚è¿”å›çš„æ˜¯é¢ å€’åçš„æ•°ç»„ï¼Œä¼šæ”¹å˜åŸæ•°ç»„ã€‚

```javascript
const arr = [2,3,4];
console.log(arr.reverse()); // [4, 3, 2]
console.log(arr);  // [4, 3, 2]
```

#### 12ã€join

join() æ–¹æ³•ç”¨äºæŠŠæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ”¾å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å…ƒç´ æ˜¯é€šè¿‡æŒ‡å®šçš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”çš„ï¼Œé»˜è®¤ä½¿ç”¨','å·åˆ†å‰²ï¼Œä¸æ”¹å˜åŸæ•°ç»„ã€‚

```javascript
const arr = [2,3,4];
console.log(arr.join());  // 2,3,4
console.log(arr);  // [2, 3, 4]
```

#### 13ã€isArray

Array.isArray() ç”¨äºç¡®å®šä¼ é€’çš„å€¼æ˜¯å¦æ˜¯ä¸€ä¸ª Arrayã€‚ä¸€ä¸ªæ¯”è¾ƒå†·é—¨çš„çŸ¥è¯†ç‚¹ï¼šå…¶å® Array.prototype ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

```javascript
Array.isArray([]); // true
Array.isArray(Array.prototype); // true

Array.isArray(null); // false
Array.isArray(undefined); // false
Array.isArray(18); // false
Array.isArray('Array'); // false
Array.isArray(true); // false
Array.isArray({ __proto__: Array.prototype });
```

åœ¨å…¬ç”¨åº“ä¸­ï¼Œä¸€èˆ¬ä¼šè¿™ä¹ˆåš isArray çš„åˆ¤æ–­ï¼š

```
Object.prototype.toString.call(arg) === '[object Array]';
å¤åˆ¶ä»£ç 
```

###ES6 æ–°å¢çš„ Array æ“ä½œ

#### 1ã€find å’Œ findIndex

find() ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰¾åˆ°æ•°ç»„ä¸­ç¬¦åˆå½“å‰æœç´¢è§„åˆ™çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›è¿™ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç»ˆæ­¢æœç´¢ã€‚

```javascript
const arr = [1, "2", 3, 3, "2"]
console.log(arr.find(n => typeof n === "number")) // 1
```

findIndex() ä¸ find() ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›çš„æ˜¯ï¼Œæ‰¾åˆ°çš„è¿™ä¸ªå…ƒç´ çš„ä¸‹æ ‡ã€‚

```javascript
const arr = [1, "2", 3, 3, "2"]
console.log(arr.findIndex(n => typeof n === "number")) // 0
```

#### 2ã€fill

ç”¨æŒ‡å®šçš„å…ƒç´ å¡«å……æ•°ç»„ï¼Œå…¶å®å°±æ˜¯ç”¨é»˜è®¤å†…å®¹åˆå§‹åŒ–æ•°ç»„ã€‚åŸºæœ¬ç”¨æ³•ï¼š`[].fill(value, start, end)`

è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼šå¡«å……å€¼(value)ï¼Œå¡«å……èµ·å§‹ä½ç½®(startï¼Œå¯ä»¥çœç•¥)ï¼Œå¡«å……ç»“æŸä½ç½®(endï¼Œå¯ä»¥çœç•¥ï¼Œå®é™…ç»“æŸä½ç½®æ˜¯end-1)ã€‚

```javascript
// é‡‡ç”¨ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¡«å……æ•°ç»„
const arr1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
arr1.fill(7);
console.log(arr1); // [7,7,7,7,7,7,7,7,7,7,7]

// åˆ¶å®šå¼€å§‹å’Œç»“æŸä½ç½®å¡«å……ï¼Œå®é™…å¡«å……ç»“æŸä½ç½®æ˜¯å‰ä¸€ä½ã€‚
const arr2 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
arr2.fill(7, 2, 5);
console.log(arr2); // [1,2,7,7,7,6,7,8,9,10,11]

// ç»“æŸä½ç½®çœç•¥ï¼Œä»èµ·å§‹ä½ç½®åˆ°æœ€åã€‚
const arr3 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
arr3.fill(7, 2);
console.log(arr3); // [1,2,7,7,7,7,7,7,7,7,7]
```

#### 3ã€from

å°†ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆarray-like objectï¼‰å’Œå¯éå†ï¼ˆiterableï¼‰çš„å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

```javascript
const set = new Set(1, 2, 3, 3, 4);
Array.from(set)  // [1,2,3,4]

Array.from('foo'); // ["f", "o", "o"]
```

#### 4ã€of

Array.of() æ–¹æ³•åˆ›å»ºä¸€ä¸ªå…·æœ‰å¯å˜æ•°é‡å‚æ•°çš„æ–°æ•°ç»„å®ä¾‹ï¼Œè€Œä¸è€ƒè™‘å‚æ•°çš„æ•°é‡æˆ–ç±»å‹ã€‚

Array.of() å’Œ Array æ„é€ å‡½æ•°ä¹‹é—´çš„åŒºåˆ«åœ¨äºå¤„ç†æ•´æ•°å‚æ•°ï¼šArray.of(7) åˆ›å»ºä¸€ä¸ªå…·æœ‰å•ä¸ªå…ƒç´  7 çš„æ•°ç»„ï¼Œè€Œ Array(7) åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º7çš„ç©ºæ•°ç»„ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯æŒ‡ä¸€ä¸ªæœ‰7ä¸ªç©ºä½çš„æ•°ç»„ï¼Œè€Œä¸æ˜¯ç”±7ä¸ªundefinedç»„æˆçš„æ•°ç»„ï¼‰ã€‚

```javascript
Array.of(7);       // [7] 
Array.of(1, 2, 3); // [1, 2, 3]

Array(7);          // [ , , , , , , ]
Array(1, 2, 3);    // [1, 2, 3]
```

#### 5ã€copyWithin

é€‰æ‹©æ•°ç»„çš„æŸä¸ªä¸‹æ ‡ï¼Œä»è¯¥ä½ç½®å¼€å§‹å¤åˆ¶æ•°ç»„å…ƒç´ ï¼Œé»˜è®¤ä»0å¼€å§‹å¤åˆ¶ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šè¦å¤åˆ¶çš„å…ƒç´ èŒƒå›´ã€‚åŸºæœ¬ç”¨æ³•ï¼š`[].copyWithin(target, start, end)`

```javascript
const arr = [1, 2, 3, 4, 5];
console.log(arr.copyWithin(3));
 // [1,2,3,1,2] ä»ä¸‹æ ‡ä¸º3çš„å…ƒç´ å¼€å§‹ï¼Œå¤åˆ¶æ•°ç»„ï¼Œæ‰€ä»¥4, 5è¢«æ›¿æ¢æˆ1, 2

const arr1 = [1, 2, 3, 4, 5];
console.log(arr1.copyWithin(3, 1)); 
// [1,2,3,2,3] ä»ä¸‹æ ‡ä¸º3çš„å…ƒç´ å¼€å§‹ï¼Œå¤åˆ¶æ•°ç»„ï¼ŒæŒ‡å®šå¤åˆ¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡ä¸º1ï¼Œæ‰€ä»¥4, 5è¢«æ›¿æ¢æˆ2, 3

const arr2 = [1, 2, 3, 4, 5];
console.log(arr2.copyWithin(3, 1, 2));
// [1,2,3,2,5] ä»ä¸‹æ ‡ä¸º3çš„å…ƒç´ å¼€å§‹ï¼Œå¤åˆ¶æ•°ç»„ï¼ŒæŒ‡å®šå¤åˆ¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡ä¸º1ï¼Œç»“æŸä½ç½®ä¸º2ï¼Œæ‰€ä»¥4è¢«æ›¿æ¢æˆ2
```

#### 6ã€includes

åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨è¯¥å…ƒç´ ï¼Œå‚æ•°ï¼šæŸ¥æ‰¾çš„å€¼ã€èµ·å§‹ä½ç½®ï¼Œå¯ä»¥æ›¿æ¢ ES5 æ—¶ä»£çš„ indexOf åˆ¤æ–­æ–¹å¼ã€‚

```javascript
const arr = [1, 2, 3];
arr.includes(2); // true
arr.includes(4); // false
```

å¦å¤–ï¼Œå®ƒè¿˜å¯ä»¥ç”¨äºä¼˜åŒ– || çš„åˆ¤æ–­å†™æ³•ã€‚

```javascript
if (method === 'post' || method === 'put' || method === 'delete') {
    ...
}

// ç”¨ includes ä¼˜åŒ– `||` çš„å†™æ³•
if (['post', 'put', 'delete'].includes(method)) {
    ...
}
```

#### 7ã€entriesã€values å’Œ keys

entries() è¿”å›è¿­ä»£å™¨ï¼šè¿”å›é”®å€¼å¯¹

```javascript
//æ•°ç»„
const arr = ['a', 'b', 'c'];
for(let v of arr.entries()) {
    console.log(v)
}
// [0, 'a'] [1, 'b'] [2, 'c']

//Set
const arr = new Set(['a', 'b', 'c']);
for(let v of arr.entries()) {
    console.log(v)
}
// ['a', 'a'] ['b', 'b'] ['c', 'c']

//Map
const arr = new Map();
arr.set('a', 'a');
arr.set('b', 'b');
for(let v of arr.entries()) {
    console.log(v)
}
// ['a', 'a'] ['b', 'b']
```

values() è¿”å›è¿­ä»£å™¨ï¼šè¿”å›é”®å€¼å¯¹çš„ value

```javascript
//æ•°ç»„
const arr = ['a', 'b', 'c'];
for(let v of arr.values()) {
    console.log(v)
}
//'a' 'b' 'c'

//Set
const arr = new Set(['a', 'b', 'c']);
for(let v of arr.values()) {
    console.log(v)
}
// 'a' 'b' 'c'

//Map
const arr = new Map();
arr.set('a', 'a');
arr.set('b', 'b');
for(let v of arr.values()) {
    console.log(v)
}
// 'a' 'b'
```

keys() è¿”å›è¿­ä»£å™¨ï¼šè¿”å›é”®å€¼å¯¹çš„ key

```javascript
//æ•°ç»„
const arr = ['a', 'b', 'c'];
for(let v of arr.keys()) {
    console.log(v)
}
// 0 1 2

//Set
const arr = new Set(['a', 'b', 'c']);
for(let v of arr.keys()) {
    console.log(v)
}
// 'a' 'b' 'c'

//Map
const arr = new Map();
arr.set('a', 'a');
arr.set('b', 'b');
for(let v of arr.keys()) {
    console.log(v)
}
// 'a' 'b'
```

## ä¹ã€Promiseçš„å®ç°

Promiseæ˜¯å‰ç«¯é¢è¯•ä¸­çš„é«˜é¢‘é—®é¢˜ï¼Œæˆ‘ä½œä¸ºé¢è¯•å®˜çš„æ—¶å€™ï¼Œé—®Promiseçš„æ¦‚ç‡è¶…è¿‡90%ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œå¤§å¤šæ•°å…¬å¸ï¼Œéƒ½ä¼šé—®ä¸€äº›å…³äºPromiseçš„é—®é¢˜ã€‚å¦‚æœä½ èƒ½æ ¹æ®PromiseA+çš„è§„èŒƒï¼Œå†™å‡ºç¬¦åˆè§„èŒƒçš„æºç ï¼Œé‚£ä¹ˆæˆ‘æƒ³ï¼Œå¯¹äºé¢è¯•ä¸­çš„Promiseç›¸å…³çš„é—®é¢˜ï¼Œéƒ½èƒ½å¤Ÿç»™å‡ºæ¯”è¾ƒå®Œç¾çš„ç­”æ¡ˆã€‚

æˆ‘çš„å»ºè®®æ˜¯ï¼Œå¯¹ç…§è§„èŒƒå¤šå†™å‡ æ¬¡å®ç°ï¼Œä¹Ÿè®¸ç¬¬ä¸€éçš„æ—¶å€™ï¼Œæ˜¯æ”¹äº†å¤šæ¬¡ï¼Œæ‰èƒ½é€šè¿‡æµ‹è¯•ï¼Œé‚£ä¹ˆéœ€è¦åå¤çš„å†™ï¼Œæˆ‘å·²ç»å°†Promiseçš„æºç å®ç°å†™äº†ä¸ä¸‹ä¸ƒéã€‚

### Promiseçš„æºç å®ç°

```javascript
/**
 * 1. new Promiseæ—¶ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ª executor æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨ç«‹åˆ»æ‰§è¡Œ
 * 2. executor æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ resolve å’Œ reject
 * 3. promise åªèƒ½ä» pending åˆ° rejected, æˆ–è€…ä» pending åˆ° fulfilled
 * 4. promise çš„çŠ¶æ€ä¸€æ—¦ç¡®è®¤ï¼Œå°±ä¸ä¼šå†æ”¹å˜
 * 5. promise éƒ½æœ‰ then æ–¹æ³•ï¼Œthen æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ promise æˆåŠŸçš„å›è°ƒ onFulfilled, 
 *      å’Œ promise å¤±è´¥çš„å›è°ƒ onRejected
 * 6. å¦‚æœè°ƒç”¨ then æ—¶ï¼Œpromiseå·²ç»æˆåŠŸï¼Œåˆ™æ‰§è¡Œ onFulfilledï¼Œå¹¶å°†promiseçš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ã€‚
 *      å¦‚æœpromiseå·²ç»å¤±è´¥ï¼Œé‚£ä¹ˆæ‰§è¡Œ onRejected, å¹¶å°† promise å¤±è´¥çš„åŸå› ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ã€‚
 *      å¦‚æœpromiseçš„çŠ¶æ€æ˜¯pendingï¼Œéœ€è¦å°†onFulfilledå’ŒonRejectedå‡½æ•°å­˜æ”¾èµ·æ¥ï¼Œç­‰å¾…çŠ¶æ€ç¡®å®šåï¼Œå†ä¾æ¬¡å°†å¯¹åº”çš„å‡½æ•°æ‰§è¡Œ(å‘å¸ƒè®¢é˜…)
 * 7. then çš„å‚æ•° onFulfilled å’Œ onRejected å¯ä»¥ç¼ºçœ
 * 8. promise å¯ä»¥thenå¤šæ¬¡ï¼Œpromise çš„then æ–¹æ³•è¿”å›ä¸€ä¸ª promise
 * 9. å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ªç»“æœï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸ªç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªthençš„æˆåŠŸçš„å›è°ƒ(onFulfilled)
 * 10. å¦‚æœ then ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸ªå¼‚å¸¸ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªthençš„å¤±è´¥çš„å›è°ƒ(onRejected)
 * 11.å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ªpromise,é‚£ä¹ˆéœ€è¦ç­‰è¿™ä¸ªpromiseï¼Œé‚£ä¹ˆä¼šç­‰è¿™ä¸ªpromiseæ‰§è¡Œå®Œï¼Œpromiseå¦‚æœæˆåŠŸï¼Œ
 *   å°±èµ°ä¸‹ä¸€ä¸ªthençš„æˆåŠŸï¼Œå¦‚æœå¤±è´¥ï¼Œå°±èµ°ä¸‹ä¸€ä¸ªthençš„å¤±è´¥
 */

const PENDING = 'pending';
const FULFILLED = 'fulfilled';
const REJECTED = 'rejected';
function Promise(executor) {
    let self = this;
    self.status = PENDING;
    self.onFulfilled = [];//æˆåŠŸçš„å›è°ƒ
    self.onRejected = []; //å¤±è´¥çš„å›è°ƒ
    //PromiseA+ 2.1
    function resolve(value) {
        if (self.status === PENDING) {
            self.status = FULFILLED;
            self.value = value;
            self.onFulfilled.forEach(fn => fn());//PromiseA+ 2.2.6.1
        }
    }

    function reject(reason) {
        if (self.status === PENDING) {
            self.status = REJECTED;
            self.reason = reason;
            self.onRejected.forEach(fn => fn());//PromiseA+ 2.2.6.2
        }
    }

    try {
        executor(resolve, reject);
    } catch (e) {
        reject(e);
    }
}

Promise.prototype.then = function (onFulfilled, onRejected) {
    //PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4
    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value;
    onRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason };
    let self = this;
    //PromiseA+ 2.2.7
    let promise2 = new Promise((resolve, reject) => {
        if (self.status === FULFILLED) {
            //PromiseA+ 2.2.2
            //PromiseA+ 2.2.4 --- setTimeout
            setTimeout(() => {
                try {
                    //PromiseA+ 2.2.7.1
                    let x = onFulfilled(self.value);
                    resolvePromise(promise2, x, resolve, reject);
                } catch (e) {
                    //PromiseA+ 2.2.7.2
                    reject(e);
                }
            });
        } else if (self.status === REJECTED) {
            //PromiseA+ 2.2.3
            setTimeout(() => {
                try {
                    let x = onRejected(self.reason);
                    resolvePromise(promise2, x, resolve, reject);
                } catch (e) {
                    reject(e);
                }
            });
        } else if (self.status === PENDING) {
            self.onFulfilled.push(() => {
                setTimeout(() => {
                    try {
                        let x = onFulfilled(self.value);
                        resolvePromise(promise2, x, resolve, reject);
                    } catch (e) {
                        reject(e);
                    }
                });
            });
            self.onRejected.push(() => {
                setTimeout(() => {
                    try {
                        let x = onRejected(self.reason);
                        resolvePromise(promise2, x, resolve, reject);
                    } catch (e) {
                        reject(e);
                    }
                });
            });
        }
    });
    return promise2;
}

function resolvePromise(promise2, x, resolve, reject) {
    let self = this;
    //PromiseA+ 2.3.1
    if (promise2 === x) {
        reject(new TypeError('Chaining cycle'));
    }
    if (x && typeof x === 'object' || typeof x === 'function') {
        let used; //PromiseA+2.3.3.3.3 åªèƒ½è°ƒç”¨ä¸€æ¬¡
        try {
            let then = x.then;
            if (typeof then === 'function') {
                //PromiseA+2.3.3
                then.call(x, (y) => {
                    //PromiseA+2.3.3.1
                    if (used) return;
                    used = true;
                    resolvePromise(promise2, y, resolve, reject);
                }, (r) => {
                    //PromiseA+2.3.3.2
                    if (used) return;
                    used = true;
                    reject(r);
                });

            }else{
                //PromiseA+2.3.3.4
                if (used) return;
                used = true;
                resolve(x);
            }
        } catch (e) {
            //PromiseA+ 2.3.3.2
            if (used) return;
            used = true;
            reject(e);
        }
    } else {
        //PromiseA+ 2.3.3.4
        resolve(x);
    }
}

module.exports = Promise;
```

æœ‰ä¸“é—¨çš„æµ‹è¯•è„šæœ¬å¯ä»¥æµ‹è¯•æ‰€ç¼–å†™çš„ä»£ç æ˜¯å¦ç¬¦åˆPromiseA+çš„è§„èŒƒã€‚

é¦–å…ˆï¼Œåœ¨promiseå®ç°çš„ä»£ç ä¸­ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç :

```javascript
Promise.defer = Promise.deferred = function () {
    let dfd = {};
    dfd.promise = new Promise((resolve, reject) => {
        dfd.resolve = resolve;
        dfd.reject = reject;
    });
    return dfd;
}
```

å®‰è£…æµ‹è¯•è„šæœ¬:

```bash
npm install -g promises-aplus-tests
```

å¦‚æœå½“å‰çš„promiseæºç çš„æ–‡ä»¶åä¸ºpromise.js

é‚£ä¹ˆåœ¨å¯¹åº”çš„ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```shell
promises-aplus-tests promise.js
```

promises-aplus-testsä¸­å…±æœ‰872æ¡æµ‹è¯•ç”¨ä¾‹ã€‚ä»¥ä¸Šä»£ç ï¼Œå¯ä»¥å®Œç¾é€šè¿‡æ‰€æœ‰ç”¨ä¾‹ã€‚

**å¯¹ä¸Šé¢çš„ä»£ç å®ç°åšä¸€ç‚¹ç®€è¦è¯´æ˜(å…¶å®ƒä¸€äº›å†…å®¹æ³¨é‡Šä¸­å·²ç»å†™å¾—å¾ˆæ¸…æ¥š):**

1. onFulfilled å’Œ onFulfilledçš„è°ƒç”¨éœ€è¦æ”¾åœ¨setTimeoutï¼Œå› ä¸ºè§„èŒƒä¸­è¡¨ç¤º: onFulfilled or onRejected must not be called until the execution context stack contains only platform codeã€‚ä½¿ç”¨setTimeoutåªæ˜¯æ¨¡æ‹Ÿå¼‚æ­¥ï¼ŒåŸç”ŸPromiseå¹¶éæ˜¯è¿™æ ·å®ç°çš„ã€‚
2. åœ¨ resolvePromise çš„å‡½æ•°ä¸­ï¼Œä¸ºä½•éœ€è¦useddè¿™ä¸ªflag,åŒæ ·æ˜¯å› ä¸ºè§„èŒƒä¸­æ˜ç¡®è¡¨ç¤º: If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored. å› æ­¤æˆ‘ä»¬éœ€è¦è¿™æ ·çš„flagæ¥ç¡®ä¿åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚
3. self.onFulfilled å’Œ self.onRejected ä¸­å­˜å‚¨äº†æˆåŠŸçš„å›è°ƒå’Œå¤±è´¥çš„å›è°ƒï¼Œæ ¹æ®è§„èŒƒ2.6æ˜¾ç¤ºï¼Œå½“promiseä»pendingæ€æ”¹å˜çš„æ—¶å€™ï¼Œéœ€è¦æŒ‰ç…§é¡ºåºå»æŒ‡å®šthenå¯¹åº”çš„å›è°ƒã€‚

###PromiseA+çš„è§„èŒƒ(ç¿»è¯‘ç‰ˆ)

PS: ä¸‹é¢æ˜¯æˆ‘ç¿»è¯‘çš„è§„èŒƒï¼Œä¾›å‚è€ƒ

> æœ¯è¯­

1. promise æ˜¯ä¸€ä¸ªæœ‰thenæ–¹æ³•çš„å¯¹è±¡æˆ–è€…æ˜¯å‡½æ•°ï¼Œè¡Œä¸ºéµå¾ªæœ¬è§„èŒƒ
2. thenable æ˜¯ä¸€ä¸ªæœ‰thenæ–¹æ³•çš„å¯¹è±¡æˆ–è€…æ˜¯å‡½æ•°
3. value æ˜¯promiseçŠ¶æ€æˆåŠŸæ—¶çš„å€¼ï¼ŒåŒ…æ‹¬ undefined/thenableæˆ–è€…æ˜¯ promise
4. exception æ˜¯ä¸€ä¸ªä½¿ç”¨throwæŠ›å‡ºçš„å¼‚å¸¸å€¼
5. reason æ˜¯promiseçŠ¶æ€å¤±è´¥æ—¶çš„å€¼

> è¦æ±‚

#### 2.1 Promise States

Promise å¿…é¡»å¤„äºä»¥ä¸‹ä¸‰ä¸ªçŠ¶æ€ä¹‹ä¸€: pending, fulfilled æˆ–è€…æ˜¯ rejected

##### 2.1.1 å¦‚æœpromiseåœ¨pendingçŠ¶æ€

```
2.1.1.1 å¯ä»¥å˜æˆ fulfilled æˆ–è€…æ˜¯ rejected
```

##### 2.1.2 å¦‚æœpromiseåœ¨fulfilledçŠ¶æ€

```
2.1.2.1 ä¸ä¼šå˜æˆå…¶å®ƒçŠ¶æ€

2.1.2.2 å¿…é¡»æœ‰ä¸€ä¸ªvalueå€¼
```

##### 2.1.3 å¦‚æœpromiseåœ¨rejectedçŠ¶æ€

```
2.1.3.1 ä¸ä¼šå˜æˆå…¶å®ƒçŠ¶æ€

2.1.3.2 å¿…é¡»æœ‰ä¸€ä¸ªpromiseè¢«rejectçš„reason
```

æ¦‚æ‹¬å³æ˜¯:promiseçš„çŠ¶æ€åªèƒ½ä»pendingå˜æˆfulfilledï¼Œæˆ–è€…ä»pendingå˜æˆrejected.promiseæˆåŠŸï¼Œæœ‰æˆåŠŸçš„value.promiseå¤±è´¥çš„è¯ï¼Œæœ‰å¤±è´¥çš„åŸå› 

#### 2.2 thenæ–¹æ³•

promiseå¿…é¡»æä¾›ä¸€ä¸ªthenæ–¹æ³•ï¼Œæ¥è®¿é—®æœ€ç»ˆçš„ç»“æœ

promiseçš„thenæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°

```javascript
promise.then(onFulfilled, onRejected)
```

##### 2.2.1 onFulfilled å’Œ onRejected éƒ½æ˜¯å¯é€‰å‚æ•°

```
2.2.1.1 onFulfilled å¿…é¡»æ˜¯å‡½æ•°ç±»å‹

2.2.1.2 onRejected å¿…é¡»æ˜¯å‡½æ•°ç±»å‹
```

##### 2.2.2 å¦‚æœ onFulfilled æ˜¯å‡½æ•°:

```
2.2.2.1 å¿…é¡»åœ¨promiseå˜æˆ fulfilled æ—¶ï¼Œè°ƒç”¨ onFulfilledï¼Œå‚æ•°æ˜¯promiseçš„value
2.2.2.2 åœ¨promiseçš„çŠ¶æ€ä¸æ˜¯ fulfilled ä¹‹å‰ï¼Œä¸èƒ½è°ƒç”¨
2.2.2.3 onFulfilled åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡
```

##### 2.2.3 å¦‚æœ onRejected æ˜¯å‡½æ•°:

```
2.2.3.1 å¿…é¡»åœ¨promiseå˜æˆ rejected æ—¶ï¼Œè°ƒç”¨ onRejectedï¼Œå‚æ•°æ˜¯promiseçš„reason
2.2.3.2 åœ¨promiseçš„çŠ¶æ€ä¸æ˜¯ rejected ä¹‹å‰ï¼Œä¸èƒ½è°ƒç”¨
2.2.3.3 onRejected åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡
```

##### 2.2.4 onFulfilled å’Œ onRejected åº”è¯¥æ˜¯å¾®ä»»åŠ¡

##### 2.2.5 onFulfilled  å’Œ onRejected å¿…é¡»ä½œä¸ºå‡½æ•°è¢«è°ƒç”¨

##### 2.2.6 thenæ–¹æ³•å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨

```
2.2.6.1 å¦‚æœpromiseå˜æˆäº† fulfilledæ€ï¼Œæ‰€æœ‰çš„onFulfilledå›è°ƒéƒ½éœ€è¦æŒ‰ç…§thençš„é¡ºåºæ‰§è¡Œ
2.2.6.2 å¦‚æœpromiseå˜æˆäº† rejectedæ€ï¼Œæ‰€æœ‰çš„onRejectedå›è°ƒéƒ½éœ€è¦æŒ‰ç…§thençš„é¡ºåºæ‰§è¡Œ
```

##### 2.2.7 thenå¿…é¡»è¿”å›ä¸€ä¸ªpromise

```
promise2 = promise1.then(onFulfilled, onRejected);

2.2.7.1 onFulfilled æˆ– onRejected æ‰§è¡Œçš„ç»“æœä¸ºx,è°ƒç”¨ resolvePromise
2.2.7.2 å¦‚æœ onFulfilled æˆ–è€… onRejected æ‰§è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸e,promise2éœ€è¦è¢«reject
2.2.7.3 å¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œpromise2 ä»¥promise1çš„å€¼fulfilled
2.2.7.4 å¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œpromise2 ä»¥promise1çš„reason rejected
```

#### 2.3 resolvePromise

resolvePromise(promise2, x, resolve, reject)

##### 2.3.1 å¦‚æœ promise2 å’Œ x ç›¸ç­‰ï¼Œé‚£ä¹ˆ reject promise with a TypeError

##### 2.3.2 å¦‚æœ x æ˜¯ä¸€ä¸ª promsie

```
2.3.2.1 å¦‚æœxæ˜¯pendingæ€ï¼Œé‚£ä¹ˆpromiseå¿…é¡»è¦åœ¨pending,ç›´åˆ° x å˜æˆ fulfilled or rejected.
2.3.2.2 å¦‚æœ x è¢« fulfilled, fulfill promise with the same value.
2.3.2.3 å¦‚æœ x è¢« rejected, reject promise with the same reason.
```

##### 2.3.3 å¦‚æœ x æ˜¯ä¸€ä¸ª object æˆ–è€… æ˜¯ä¸€ä¸ª function

```
2.3.3.1 let then = x.then.
2.3.3.2 å¦‚æœ x.then è¿™æ­¥å‡ºé”™ï¼Œé‚£ä¹ˆ reject promise with e as the reason..
2.3.3.3 å¦‚æœ then æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œthen.call(x, resolvePromiseFn, rejectPromise)
    2.3.3.3.1 resolvePromiseFn çš„ å…¥å‚æ˜¯ y, æ‰§è¡Œ resolvePromise(promise2, y, resolve, reject);
    2.3.3.3.2 rejectPromise çš„ å…¥å‚æ˜¯ r, reject promise with r.
    2.3.3.3.3 å¦‚æœ resolvePromise å’Œ rejectPromise éƒ½è°ƒç”¨äº†ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªè°ƒç”¨ä¼˜å…ˆï¼Œåé¢çš„è°ƒç”¨å¿½ç•¥ã€‚
    2.3.3.3.4 å¦‚æœè°ƒç”¨thenæŠ›å‡ºå¼‚å¸¸e 
        2.3.3.3.4.1 å¦‚æœ resolvePromise æˆ– rejectPromise å·²ç»è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå¿½ç•¥
        2.3.3.3.4.3 å¦åˆ™ï¼Œreject promise with e as the reason
2.3.3.4 å¦‚æœ then ä¸æ˜¯ä¸€ä¸ªfunction. fulfill promise with x.
```

##### 2.3.4 å¦‚æœ x ä¸æ˜¯ä¸€ä¸ª object æˆ–è€… functionï¼Œfulfill promise with x.

###Promiseçš„å…¶ä»–æ–¹æ³•

è™½ç„¶ä¸Šè¿°çš„promiseæºç å·²ç»ç¬¦åˆPromiseA+çš„è§„èŒƒï¼Œä½†æ˜¯åŸç”Ÿçš„Promiseè¿˜æä¾›äº†ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œå¦‚:

1. Promise.resolve()
2. Promise.reject()
3. Promise.prototype.catch()
4. Promise.prototype.finally()
5. Promise.all()
6. Promise.race()

ä¸‹é¢å…·ä½“è¯´ä¸€ä¸‹æ¯ä¸ªæ–¹æ³•çš„å®ç°:

> ### Promise.resolve

Promise.resolve(value) è¿”å›ä¸€ä¸ªä»¥ç»™å®šå€¼è§£æåçš„Promise å¯¹è±¡.

1. å¦‚æœ value æ˜¯ä¸ª thenable å¯¹è±¡ï¼Œè¿”å›çš„promiseä¼šâ€œè·Ÿéšâ€è¿™ä¸ªthenableçš„å¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€
2. å¦‚æœä¼ å…¥çš„valueæœ¬èº«å°±æ˜¯promiseå¯¹è±¡ï¼Œé‚£ä¹ˆPromise.resolveå°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªpromiseå¯¹è±¡ã€‚
3. å…¶ä»–æƒ…å†µï¼Œç›´æ¥è¿”å›ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€çš„promiseå¯¹è±¡ã€‚

```javascript
Promise.resolve = function (param) {
        if (param instanceof Promise) {
        return param;
    }
    return new Promise((resolve, reject) => {
        if (param && param.then && typeof param.then === 'function') {
            setTimeout(() => {
                param.then(resolve, reject);
            });
        } else {
            resolve(param);
        }
    });
}
```

thenableå¯¹è±¡çš„æ‰§è¡ŒåŠ  setTimeoutçš„åŸå› æ˜¯æ ¹æ®åŸç”ŸPromiseå¯¹è±¡æ‰§è¡Œçš„ç»“æœæ¨æ–­çš„ï¼Œå¦‚ä¸‹çš„æµ‹è¯•ä»£ç ï¼ŒåŸç”Ÿçš„æ‰§è¡Œç»“æœä¸º: 20  400  30;ä¸ºäº†åŒæ ·çš„æ‰§è¡Œé¡ºåºï¼Œå¢åŠ äº†setTimeoutå»¶æ—¶ã€‚

æµ‹è¯•ä»£ç :

```javascript
let p = Promise.resolve(20);
p.then((data) => {
    console.log(data);
});


let p2 = Promise.resolve({
    then: function(resolve, reject) {
        resolve(30);
    }
});

p2.then((data)=> {
    console.log(data)
});

let p3 = Promise.resolve(new Promise((resolve, reject) => {
    resolve(400)
}));
p3.then((data) => {
    console.log(data)
});
```

> ### Promise.reject

Promise.rejectæ–¹æ³•å’ŒPromise.resolveä¸åŒï¼ŒPromise.reject()æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸ºrejectçš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°ã€‚

```javascript
Promise.reject = function (reason) {
    return new Promise((resolve, reject) => {
        reject(reason);
    });
}
```

> ### Promise.prototype.catch

Promise.prototype.catch ç”¨äºæŒ‡å®šå‡ºé”™æ—¶çš„å›è°ƒï¼Œæ˜¯ç‰¹æ®Šçš„thenæ–¹æ³•ï¼Œcatchä¹‹åï¼Œå¯ä»¥ç»§ç»­ .then

```javascript
Promise.prototype.catch = function (onRejected) {
    return this.then(null, onRejected);
}
```

> ### Promise.prototype.finally

ä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šèµ°åˆ°finallyä¸­,å¹¶ä¸”finallyä¹‹åï¼Œè¿˜å¯ä»¥ç»§ç»­thenã€‚å¹¶ä¸”ä¼šå°†å€¼åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™åé¢çš„then.

```javascript
Promise.prototype.finally = function (callback) {
    return this.then((value) => {
        return Promise.resolve(callback()).then(() => {
            return value;
        });
    }, (err) => {
        return Promise.resolve(callback()).then(() => {
            throw err;
        });
    });
}
```

> ### Promise.all

Promise.all(promises) è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡

1. å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤promiseå¯¹è±¡å›è°ƒå®Œæˆ(resolve),åªæœ‰æ­¤æƒ…å†µï¼Œæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå…¶å®ƒéƒ½æ˜¯å¼‚æ­¥è¿”å›çš„ã€‚
2. å¦‚æœä¼ å…¥çš„å‚æ•°ä¸åŒ…å«ä»»ä½• promiseï¼Œåˆ™è¿”å›ä¸€ä¸ªå¼‚æ­¥å®Œæˆ.
3. promises ä¸­æ‰€æœ‰çš„promiseéƒ½promiseéƒ½â€œå®Œæˆâ€æ—¶æˆ–å‚æ•°ä¸­ä¸åŒ…å« promise æ—¶å›è°ƒå®Œæˆã€‚
4. å¦‚æœå‚æ•°ä¸­æœ‰ä¸€ä¸ªpromiseå¤±è´¥ï¼Œé‚£ä¹ˆPromise.allè¿”å›çš„promiseå¯¹è±¡å¤±è´¥
5. åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒPromise.all è¿”å›çš„ promise çš„å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„

```javascript
Promise.all = function (promises) {
    return new Promise((resolve, reject) => {
        let index = 0;
        let result = [];
        if (promises.length === 0) {
            resolve(result);
        } else {
            function processValue(i, data) {
                result[i] = data;
                if (++index === promises.length) {
                    resolve(result);
                }
            }
            for (let i = 0; i < promises.length; i++) {
                  //promises[i] å¯èƒ½æ˜¯æ™®é€šå€¼
                  Promise.resolve(promises[i]).then((data) => {
                    processValue(i, data);
                }, (err) => {
                    reject(err);
                    return;
                });
            }
        }
    });
}
```

æµ‹è¯•ä»£ç :

```javascript
var promise1 = new Promise((resolve, reject) => {
    resolve(3);
})
var promise2 = 42;
var promise3 = new Promise(function(resolve, reject) {
  setTimeout(resolve, 100, 'foo');
});

Promise.all([promise1, promise2, promise3]).then(function(values) {
  console.log(values); //[3, 42, 'foo']
},(err)=>{
    console.log(err)
});

var p = Promise.all([]); // will be immediately resolved
var p2 = Promise.all([1337, "hi"]); // non-promise values will be ignored, but the evaluation will be done asynchronously
console.log(p);
console.log(p2)
setTimeout(function(){
    console.log('the stack is now empty');
    console.log(p2);
});
```

> ### Promise.race

Promise.raceå‡½æ•°è¿”å›ä¸€ä¸ª Promiseï¼Œå®ƒå°†ä¸ç¬¬ä¸€ä¸ªä¼ é€’çš„ promise ç›¸åŒçš„å®Œæˆæ–¹å¼è¢«å®Œæˆã€‚å®ƒå¯ä»¥æ˜¯å®Œæˆï¼ˆ resolvesï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤±è´¥ï¼ˆrejectsï¼‰ï¼Œè¿™è¦å–å†³äºç¬¬ä¸€ä¸ªå®Œæˆçš„æ–¹å¼æ˜¯ä¸¤ä¸ªä¸­çš„å“ªä¸ªã€‚

å¦‚æœä¼ çš„å‚æ•°æ•°ç»„æ˜¯ç©ºï¼Œåˆ™è¿”å›çš„ promise å°†æ°¸è¿œç­‰å¾…ã€‚

å¦‚æœè¿­ä»£åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªéæ‰¿è¯ºå€¼å’Œ/æˆ–å·²è§£å†³/æ‹’ç»çš„æ‰¿è¯ºï¼Œåˆ™ Promise.race å°†è§£æä¸ºè¿­ä»£ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå€¼ã€‚

```javascript
Promise.race = function (promises) {
    return new Promise((resolve, reject) => {
        if (promises.length === 0) {
            return;
        } else {
            for (let i = 0; i < promises.length; i++) {
                Promise.resolve(promises[i]).then((data) => {
                    resolve(data);
                    return;
                }, (err) => {
                    reject(err);
                    return;
                });
            }
        }
    });
}
```

æµ‹è¯•ä»£ç :

```javascript
Promise.race([
    new Promise((resolve, reject) => { setTimeout(() => { resolve(100) }, 1000) }),
    undefined,
    new Promise((resolve, reject) => { setTimeout(() => { reject(100) }, 100) })
]).then((data) => {
    console.log('success ', data);
}, (err) => {
    console.log('err ',err);
});

Promise.race([
    new Promise((resolve, reject) => { setTimeout(() => { resolve(100) }, 1000) }),
    new Promise((resolve, reject) => { setTimeout(() => { resolve(200) }, 200) }),
    new Promise((resolve, reject) => { setTimeout(() => { reject(100) }, 100) })
]).then((data) => {
    console.log(data);
}, (err) => {
    console.log(err);
});
```

## åã€æµè§ˆå™¨çš„Event Loop

### 1. é¢„å¤‡çŸ¥è¯†

> JavaScriptçš„è¿è¡Œæœºåˆ¶:

ï¼ˆ1ï¼‰æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆexecution context stackï¼‰ã€‚

ï¼ˆ2ï¼‰ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨"ä»»åŠ¡é˜Ÿåˆ—"(task queue)ã€‚åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœï¼Œå°±åœ¨"ä»»åŠ¡é˜Ÿåˆ—"ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚

ï¼ˆ3ï¼‰ä¸€æ—¦"æ‰§è¡Œæ ˆ"ä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–"ä»»åŠ¡é˜Ÿåˆ—"ï¼Œçœ‹çœ‹é‡Œé¢æœ‰å“ªäº›äº‹ä»¶ã€‚é‚£äº›å¯¹åº”çš„å¼‚æ­¥ä»»åŠ¡ï¼Œäºæ˜¯ç»“æŸç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ‰§è¡Œæ ˆï¼Œå¼€å§‹æ‰§è¡Œã€‚

ï¼ˆ4ï¼‰ä¸»çº¿ç¨‹ä¸æ–­é‡å¤ä¸Šé¢çš„ç¬¬ä¸‰æ­¥

æ¦‚æ‹¬å³æ˜¯: è°ƒç”¨æ ˆä¸­çš„åŒæ­¥ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆå†…è¢«æ¸…ç©ºäº†ï¼Œå°±ä»£è¡¨ä¸»çº¿ç¨‹ç©ºé—²äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»ä»»åŠ¡é˜Ÿåˆ—ä¸­æŒ‰ç…§é¡ºåºè¯»å–ä¸€ä¸ªä»»åŠ¡æ”¾å…¥åˆ°æ ˆä¸­æ‰§è¡Œã€‚æ¯æ¬¡æ ˆå†…è¢«æ¸…ç©ºï¼Œéƒ½ä¼šå»è¯»å–ä»»åŠ¡é˜Ÿåˆ—æœ‰æ²¡æœ‰ä»»åŠ¡ï¼Œæœ‰å°±è¯»å–æ‰§è¡Œï¼Œä¸€ç›´å¾ªç¯è¯»å–-æ‰§è¡Œçš„æ“ä½œ

> ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æœ‰ä¸€ä¸ªæˆ–è€…æ˜¯å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—

> JavaScriptä¸­æœ‰ä¸¤ç§å¼‚æ­¥ä»»åŠ¡:

1. å®ä»»åŠ¡: scriptï¼ˆæ•´ä½“ä»£ç ï¼‰, setTimeout, setInterval, setImmediate, I/O, UI rendering
2. å¾®ä»»åŠ¡: process.nextTickï¼ˆNodejsï¼‰, Promises, Object.observe, MutationObserver;

### 2. äº‹ä»¶å¾ªç¯(event-loop)æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸»çº¿ç¨‹ä»"ä»»åŠ¡é˜Ÿåˆ—"ä¸­è¯»å–æ‰§è¡Œäº‹ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯ä¸æ–­çš„ï¼Œè¿™ä¸ªæœºåˆ¶è¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯ã€‚æ­¤æœºåˆ¶å…·ä½“å¦‚ä¸‹:ä¸»çº¿ç¨‹ä¼šä¸æ–­ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æŒ‰é¡ºåºå–ä»»åŠ¡æ‰§è¡Œï¼Œæ¯æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡éƒ½ä¼šæ£€æŸ¥microtaské˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼ˆæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡çš„å…·ä½“æ ‡å¿—æ˜¯å‡½æ•°æ‰§è¡Œæ ˆä¸ºç©ºï¼‰ï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™ä¼šä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ‰€æœ‰microtaskã€‚ç„¶åå†è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯å»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚

> #### è¯¦ç»†è¯´æ˜:

1. é€‰æ‹©å½“å‰è¦æ‰§è¡Œçš„å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—çš„å®ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å®ä»»åŠ¡å¯ä»¥é€‰æ‹©ï¼Œåˆ™ä¼šè·³è½¬è‡³microtaskçš„æ‰§è¡Œæ­¥éª¤ã€‚
2. å°†äº‹ä»¶å¾ªç¯çš„å½“å‰è¿è¡Œå®ä»»åŠ¡è®¾ç½®ä¸ºå·²é€‰æ‹©çš„å®ä»»åŠ¡ã€‚
3. è¿è¡Œå®ä»»åŠ¡ã€‚
4. å°†äº‹ä»¶å¾ªç¯çš„å½“å‰è¿è¡Œä»»åŠ¡è®¾ç½®ä¸ºnullã€‚
5. å°†è¿è¡Œå®Œçš„å®ä»»åŠ¡ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚
6. microtasksæ­¥éª¤ï¼šè¿›å…¥microtaskæ£€æŸ¥ç‚¹ã€‚
7. æ›´æ–°ç•Œé¢æ¸²æŸ“ã€‚
8. è¿”å›ç¬¬ä¸€æ­¥ã€‚

**æ‰§è¡Œè¿›å…¥microtaskæ£€æŸ¥çš„çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹:**

1. è®¾ç½®è¿›å…¥microtaskæ£€æŸ¥ç‚¹çš„æ ‡å¿—ä¸ºtrueã€‚
2. å½“äº‹ä»¶å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼šé€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥microtaské˜Ÿåˆ—çš„microtaskï¼›è®¾ç½®äº‹ä»¶å¾ªç¯çš„å½“å‰è¿è¡Œä»»åŠ¡ä¸ºå·²é€‰æ‹©çš„microtaskï¼›è¿è¡Œmicrotaskï¼›è®¾ç½®äº‹ä»¶å¾ªç¯çš„å½“å‰è¿è¡Œä»»åŠ¡ä¸ºnullï¼›å°†è¿è¡Œç»“æŸçš„microtaskä»microtaské˜Ÿåˆ—ä¸­ç§»é™¤ã€‚
3. å¯¹äºç›¸åº”äº‹ä»¶å¾ªç¯çš„æ¯ä¸ªç¯å¢ƒè®¾ç½®å¯¹è±¡ï¼ˆenvironment settings objectï¼‰,é€šçŸ¥å®ƒä»¬å“ªäº›promiseä¸ºrejectedã€‚
4. æ¸…ç†indexedDBçš„äº‹åŠ¡ã€‚
5. è®¾ç½®è¿›å…¥microtaskæ£€æŸ¥ç‚¹çš„æ ‡å¿—ä¸ºfalseã€‚

**éœ€è¦æ³¨æ„çš„æ˜¯:å½“å‰æ‰§è¡Œæ ˆæ‰§è¡Œå®Œæ¯•æ—¶ä¼šç«‹åˆ»å…ˆå¤„ç†æ‰€æœ‰å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„äº‹ä»¶, ç„¶åå†å»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶ã€‚åŒä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¸­, å¾®ä»»åŠ¡æ°¸è¿œåœ¨å®ä»»åŠ¡ä¹‹å‰æ‰§è¡Œã€‚**

å›¾ç¤º:



![event-loop2](https://user-gold-cdn.xitu.io/2019/3/22/169a4038c4e156f0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



### 3. Event-loop æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š

```javascript
setTimeout(()=>{
    console.log("setTimeout1");
    Promise.resolve().then(data => {
        console.log(222);
    });
});
setTimeout(()=>{
    console.log("setTimeout2");
});
Promise.resolve().then(data=>{
    console.log(111);
});
```

æ€è€ƒä¸€ä¸‹, è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

è¿è¡Œç»“æœä¸º:

```
111
setTimeout1
222
setTimeout2
```

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹, JSå¼•æ“æ˜¯å¦‚ä½•æ‰§è¡Œè¿™æ®µä»£ç çš„:

1. ä¸»çº¿ç¨‹ä¸Šæ²¡æœ‰éœ€è¦æ‰§è¡Œçš„ä»£ç 
2. æ¥ç€é‡åˆ°setTimeout 0ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ 0ms åå°†å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­(è¿™ä¸ªä»»åŠ¡åœ¨ä¸‹ä¸€æ¬¡çš„äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œ)ã€‚
3. æ¥ç€é‡åˆ°setTimeout 0ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ 0ms åå°†å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­(è¿™ä¸ªä»»åŠ¡åœ¨å†ä¸‹ä¸€æ¬¡çš„äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œ)ã€‚
4. é¦–å…ˆæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—, å³ microtaské˜Ÿåˆ—ï¼Œå‘ç°æ­¤é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªpromiseçš„thenå›è°ƒï¼Œè¾“å‡º '111'ã€‚
5. æ­¤æ—¶microtaské˜Ÿåˆ—ä¸ºç©ºï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯, æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°æœ‰ setTimeoutçš„å›è°ƒå‡½æ•°ï¼Œç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°è¾“å‡º 'setTimeout1',æ£€æŸ¥microtask é˜Ÿåˆ—ï¼Œå‘ç°é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œæ‰§è¡Œpromiseçš„thenå›è°ƒï¼Œè¾“å‡º'222'ï¼Œmicrotaské˜Ÿåˆ—ä¸ºç©ºï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚
6. æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°æœ‰ setTimeoutçš„å›è°ƒå‡½æ•°, ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°è¾“å‡º'setTimeout2'ã€‚

å†æ€è€ƒä¸€ä¸‹ä¸‹é¢ä»£ç çš„æ‰§è¡Œé¡ºåº:

```javascript
console.log('script start');

setTimeout(function () {
    console.log('setTimeout---0');
}, 0);

setTimeout(function () {
    console.log('setTimeout---200');
    setTimeout(function () {
        console.log('inner-setTimeout---0');
    });
    Promise.resolve().then(function () {
        console.log('promise5');
    });
}, 200);

Promise.resolve().then(function () {
    console.log('promise1');
}).then(function () {
    console.log('promise2');
});
Promise.resolve().then(function () {
    console.log('promise3');
});
console.log('script end');
```

æ€è€ƒä¸€ä¸‹, è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

è¿è¡Œç»“æœä¸º:

```javascript
script start
script end
promise1
promise3
promise2
setTimeout---0
setTimeout---200
promise5
inner-setTimeout---0
```

é‚£ä¹ˆä¸ºä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹, JSå¼•æ“æ˜¯å¦‚ä½•æ‰§è¡Œè¿™æ®µä»£ç çš„:

1. é¦–å…ˆé¡ºåºæ‰§è¡Œå®Œä¸»è¿›ç¨‹ä¸Šçš„åŒæ­¥ä»»åŠ¡ï¼Œç¬¬ä¸€å¥å’Œæœ€åä¸€å¥çš„console.log
2. æ¥ç€é‡åˆ°setTimeout 0ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ 0ms åå°†å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­(è¿™ä¸ªä»»åŠ¡åœ¨ä¸‹ä¸€æ¬¡çš„äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œ)ã€‚
3. æ¥ç€é‡åˆ°setTimeout 200ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ 200ms åå°†å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­(è¿™ä¸ªä»»åŠ¡åœ¨å†ä¸‹ä¸€æ¬¡çš„äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œ)ã€‚
4. åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œé¦–å…ˆæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—, å³ microtaské˜Ÿåˆ—ï¼Œå‘ç°æ­¤é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªpromiseçš„thenå›è°ƒï¼Œè¾“å‡º 'promise1'ï¼Œç„¶åæ‰§è¡Œç¬¬äºŒä¸ªpromiseçš„thenå›è°ƒï¼Œè¾“å‡º'promise3'ï¼Œç”±äºç¬¬ä¸€ä¸ªpromiseçš„.then()çš„è¿”å›ä¾ç„¶æ˜¯promiseï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª.then()ä¼šæ”¾åˆ°microtaské˜Ÿåˆ—ç»§ç»­æ‰§è¡Œï¼Œè¾“å‡º 'promise2';
5. æ­¤æ—¶microtaské˜Ÿåˆ—ä¸ºç©ºï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯, æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°æœ‰ setTimeoutçš„å›è°ƒå‡½æ•°ï¼Œç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°è¾“å‡º 'setTimeout---0',æ£€æŸ¥microtask é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯.
6. æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°æœ‰ setTimeoutçš„å›è°ƒå‡½æ•°, ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°è¾“å‡º'setTimeout---200'.
7. æ¥ç€é‡åˆ°setTimeout 0ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ 0ms åå°†å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå³ microtask é˜Ÿåˆ—ï¼Œå‘ç°æ­¤é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œæ‰§è¡Œpromiseçš„thenå›è°ƒï¼Œè¾“å‡º'promise5'ã€‚
8. æ­¤æ—¶microtaské˜Ÿåˆ—ä¸ºç©ºï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°æœ‰ setTimeout çš„å›è°ƒå‡½æ•°ï¼Œç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°è¾“å‡ºï¼Œè¾“å‡º'inner-setTimeout---0'ã€‚ä»£ç æ‰§è¡Œç»“æŸ.

### 4. ä¸ºä»€ä¹ˆä¼šéœ€è¦event-loop?

å› ä¸º JavaScript æ˜¯å•çº¿ç¨‹çš„ã€‚å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰ä¼šæ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œåä¸€ä¸ªä»»åŠ¡å°±ä¸å¾—ä¸ä¸€ç›´ç­‰ç€ã€‚ä¸ºäº†åè°ƒäº‹ä»¶ï¼ˆeventï¼‰ï¼Œç”¨æˆ·äº¤äº’ï¼ˆuser interactionï¼‰ï¼Œè„šæœ¬ï¼ˆscriptï¼‰ï¼Œæ¸²æŸ“ï¼ˆrenderingï¼‰ï¼Œç½‘ç»œï¼ˆnetworkingï¼‰ç­‰ï¼Œç”¨æˆ·ä»£ç†ï¼ˆuser agentï¼‰å¿…é¡»ä½¿ç”¨äº‹ä»¶å¾ªç¯ï¼ˆevent loopsï¼‰ã€‚

æœ€åæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæœ¬æ–‡ä»‹ç»çš„æ˜¯æµè§ˆå™¨çš„Event-loopï¼Œå› æ­¤åœ¨æµ‹è¯•éªŒè¯æ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨æµè§ˆå™¨ç¯å¢ƒè¿›è¡Œæµ‹è¯•éªŒè¯ï¼Œå¦‚æœä½¿ç”¨äº†nodeç¯å¢ƒï¼Œé‚£ä¹ˆç»“æœä¸ä¸€å®šæ˜¯å¦‚ä¸Šæ‰€è¯´ã€‚

ç±»å‹è½¬æ¢

https://blog.csdn.net/one_and_only4711/article/details/6281581

jsåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹

https://www.cnblogs.com/cxying93/p/6106469.html

ä½œç”¨åŸŸé“¾ï¼Œé—­åŒ…

http://web.jobbole.com/90524/

http://web.jobbole.com/90640/?utm_source=blog.jobbole.com&utm_medium=relatedPosts

https://zhuanlan.zhihu.com/p/25855075

åŸå‹é“¾

http://web.jobbole.com/91207/

thisçš„æŒ‡å‘ï¼Œapplyï¼Œcallï¼Œbind

http://www.cnblogs.com/pssp/p/5216085.html

http://www.cnblogs.com/pssp/p/5787116.html

http://www.cnblogs.com/pssp/p/5781090.html

jsäº‹ä»¶å§”æ‰˜

https://www.cnblogs.com/zhoushengxiu/p/5703095.html

æµè§ˆå™¨äº‹ä»¶å¾ªç¯

https://www.cnblogs.com/rubyxie/articles/9797564.html

vueé¢è¯•é—®é¢˜

http://web.jobbole.com/95479/

asyncï¼Œawaitï¼Œpromise

http://web.jobbole.com/95515/

ES6ï¼š

letï¼Œconst

classï¼Œpromiseï¼Œmoduleï¼Œproxyï¼Œsetï¼Œmapï¼Œ

è§£æ„èµ‹å€¼ï¼Œæ‰©å±•è¿ç®—ç¬¦ï¼ŒObject.assignï¼ˆå¯¹è±¡åˆå¹¶ï¼‰

ES7ï¼š

 asyncï¼Œawait